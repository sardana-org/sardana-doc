

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Macro hooks examples &mdash; sardana 3.0.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="sardana 3.0.2-alpha documentation" href="../../index.html"/>
        <link rel="up" title="Macro examples" href="macro_examples.html"/>
        <link rel="next" title="Macro scans examples" href="macro_scans_examples.html"/>
        <link rel="prev" title="Macro call examples" href="macro_call_examples.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User&#8217;s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer&#8217;s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_macros/index.html">Writing macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_controllers/index.html">Writing controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/api_sardana.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration.html">Migration guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="macro_examples.html">Macro examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_examples.html">Controller examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">sardana</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
      
          <li><a href="../index.html">Developer&#8217;s Guide</a> &raquo;</li>
      
          <li><a href="examples.html">Examples</a> &raquo;</li>
      
          <li><a href="macro_examples.html">Macro examples</a> &raquo;</li>
      
    <li>Macro hooks examples</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/devel/examples/macro_hooks_examples.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="macro-hooks-examples">
<span id="sardana-devel-macro-hooks-examples"></span><h1>Macro hooks examples<a class="headerlink" href="#macro-hooks-examples" title="Permalink to this headline">Â¶</a></h1>
<p>This chapter consists of a series of examples demonstrating how to define
hookable macros and how to programmatically attach hooks to macros.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">##############################################################################</span>
<span class="c1">##</span>
<span class="c1"># This file is part of Sardana</span>
<span class="c1">##</span>
<span class="c1"># http://www.sardana-controls.org/</span>
<span class="c1">##</span>
<span class="c1"># Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">##</span>
<span class="c1"># Sardana is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1"># Sardana is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Sardana.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">##############################################################################</span>

<span class="sd">&quot;&quot;&quot;This module contains macros that demonstrate the usage of hooks&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;captain_hook&quot;</span><span class="p">,</span> <span class="s2">&quot;captain_hook2&quot;</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">,</span> <span class="s2">&quot;hooked_scan&quot;</span><span class="p">,</span>
           <span class="s2">&quot;hooked_dummyscan&quot;</span><span class="p">]</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;restructuredtext&#39;</span>

<span class="kn">from</span> <span class="nn">sardana.macroserver.macro</span> <span class="kn">import</span> <span class="n">Macro</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Hookable</span><span class="p">,</span> <span class="n">ExecMacroHook</span>


<span class="k">class</span> <span class="nc">loop</span><span class="p">(</span><span class="n">Macro</span><span class="p">,</span> <span class="n">Hookable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A macro that executes a for loop. It accepts hooks.</span>
<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">hints</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;allowsHooks&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;pre-move&#39;</span><span class="p">,</span> <span class="s1">&#39;post-move&#39;</span><span class="p">,</span> <span class="s1">&#39;pre-acq&#39;</span><span class="p">,</span> <span class="s1">&#39;post-acq&#39;</span><span class="p">)}</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;start point&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;end point&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting loop&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;At step </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flushOutput</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">hints</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;running hook with hints=&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">hints</span><span class="p">))</span>
                <span class="n">hook</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished loop&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">captain_hook</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A macro that executes a loop macro. A hook was attached so that in each</span>
<span class="sd">    step of the loop this hook is executed.</span>
<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;start point&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;end point&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">loop_macro</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span><span class="s2">&quot;loop&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">loop_macro</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-acq&quot;</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">loop_macro</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">captain_hook2</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A macro that executes a loop macro. A hook was attached so that in each</span>
<span class="sd">    step of the loop this hook is executed.</span>
<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;start point&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;end point&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execMacroStr</span><span class="p">([</span><span class="s2">&quot;lsm&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">loop_macro</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span><span class="s2">&quot;loop&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="c1">#h = self.createExecMacroHook([&quot;lsm&quot;])</span>
        <span class="c1"># it gives the &quot;pre-acq&quot; hint to the hook</span>
        <span class="n">loop_macro</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">loop_macro</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">hooked_scan</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An example on how to attach hooks to the various hook points of a scan.</span>
<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span>      <span class="n">Type</span><span class="o">.</span><span class="n">Moveable</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Scan start position&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;final_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Scan final position&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;nr_interv&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Number of scan intervals&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;integ_time&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Integration time&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">hook1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook1 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook2 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook3 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook4 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook5 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook6 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">):</span>
        <span class="n">ascan</span><span class="p">,</span> <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span>
            <span class="s2">&quot;ascan&quot;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">)</span>
        <span class="n">ascan</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-acq&quot;</span><span class="p">]),</span>
                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook2</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-acq&quot;</span><span class="p">,</span> <span class="s2">&quot;post-acq&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;pre-move&quot;</span><span class="p">,</span> <span class="s2">&quot;post-move&quot;</span><span class="p">,</span> <span class="s2">&quot;aaaa&quot;</span><span class="p">]),</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">hook3</span><span class="p">,</span>
                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook4</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-scan&quot;</span><span class="p">]),</span>
                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook5</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-scan&quot;</span><span class="p">,</span> <span class="s2">&quot;post-scan&quot;</span><span class="p">]),</span>
                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook6</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;post-step&quot;</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">ascan</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">hooked_scan_with_macro</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An example on how to attach macro (in this case without parameters)</span>
<span class="sd">    as a hook to the various hook points of a scan.</span>

<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Moveable</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Scan start position&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;final_pos&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Scan final position&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;nr_interv&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Number of scan intervals&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;integ_time&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Integration time&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Macro</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Macro to be used as hook&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;hook_places&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;hook_place&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Hook place&#39;</span><span class="p">]],</span>
            <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Hook places where macro will be called&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span>
            <span class="n">hook_places</span><span class="p">):</span>
        <span class="n">ascan</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span>
            <span class="s2">&quot;ascan&quot;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">)</span>
        <span class="n">macro_hook</span> <span class="o">=</span> <span class="n">ExecMacroHook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;umv&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;mot01&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">ascan</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">macro_hook</span><span class="p">,</span> <span class="n">hook_places</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">ascan</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">hooked_dummyscan</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An example on how to attach hooks to the various hook points of a scan.</span>
<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Scan start position&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;final_pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Scan final position&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;nr_interv&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Number of scan intervals&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;integ_time&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>   <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Integration time&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">hook1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook1 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook2 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hook3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">hook3 execution&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">):</span>
        <span class="n">dummyscan</span><span class="p">,</span> <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span>
            <span class="s2">&quot;dummyscan&quot;</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">final_pos</span><span class="p">,</span> <span class="n">nr_interv</span><span class="p">,</span> <span class="n">integ_time</span><span class="p">)</span>
        <span class="n">dummyscan</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-scan&quot;</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook2</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pre-acq&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;post-acq&quot;</span><span class="p">,</span> <span class="s2">&quot;pre-move&quot;</span><span class="p">,</span> <span class="s2">&quot;post-move&quot;</span><span class="p">,</span> <span class="s2">&quot;aaaa&quot;</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;post-scan&quot;</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">dummyscan</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="macro_scans_examples.html" class="btn btn-neutral float-right" title="Macro scans examples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="macro_call_examples.html" class="btn btn-neutral" title="Macro call examples" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'3.0.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>