

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding real elements &mdash; sardana 3.0.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="sardana 3.0.2-alpha documentation" href="../index.html"/>
        <link rel="up" title="User’s Guide" href="index.html"/>
        <link rel="next" title="Macro Hooks" href="macro_hooks.html"/>
        <link rel="prev" title="Diffractometer" href="diffractometer.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">User&#8217;s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started/index.html">Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="spock.html">Spock</a></li>
<li class="toctree-l3"><a class="reference internal" href="taurus/index.html">Sardana-Taurus Widgets</a></li>
<li class="toctree-l3"><a class="reference internal" href="scan.html">Scans</a></li>
<li class="toctree-l3"><a class="reference internal" href="motion.html">Motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="acquisition.html">Acquisition</a></li>
<li class="toctree-l3"><a class="reference internal" href="diffractometer.html">Diffractometer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Adding real elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#controllers">Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controller-axes">Controller axes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#motors">Motors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pseudomotors">Pseudomotors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measurement-groups">Measurement groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-elements">Removing elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#useful-lists">Useful lists</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="macro_hooks.html">Macro Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_environment.html">Macro Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_logging_and_reports.html">Macro Logging and Reports</a></li>
<li class="toctree-l3"><a class="reference internal" href="environment_variable_catalog.html">Environment Variable Catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="standard_macro_catalog.html">Standard macro catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="screenshots.html">Screenshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/sardana-org/sardana/issues?q=is:issue+is:open+label:doc:knownbug">Known Problems</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devel/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">sardana</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
      
          <li><a href="index.html">User&#8217;s Guide</a> &raquo;</li>
      
    <li>Adding real elements</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/users/adding_elements.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-real-elements">
<span id="sardana-adding-elements"></span><h1>Adding real elements<a class="headerlink" href="#adding-real-elements" title="Permalink to this headline">¶</a></h1>
<p>For the sake of demonstration, let&#8217;s suppose you want to integrate a slit with
IcePAP-based motors into Sardana.</p>
<p>Before doing anything else you should check the <a class="reference external" href="https://sourceforge.net/p/sardana/controllers.git">controller plugin register</a>.
There&#8217;s a high chance that somebody already wrote the plugin for your hardware.
If not, you can <a class="reference internal" href="../devel/howto_controllers/index.html#sardana-controller-howto"><span class="std std-ref">write the plugin yourself</span></a>.</p>
<div class="section" id="controllers">
<h2>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h2>
<p>The controller is a Sardana object that handles the communication with the
hardware (physical controller) or provides an abstraction layer (pseudo
controller).</p>
<p>Before creating the controller instance you need to load the controller
plugin class into the Sardana. To check if it is already loaded use the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsctrl" title="sardana.macroserver.macros.lists.lsctrl"><code class="xref py py-class docutils literal"><span class="pre">lsctrl</span></code></a> macro. If it is not, you will
need to configure the <a class="reference internal" href="configuration/pool.html#sardana-configuration-pool"><span class="std std-ref">controller plugin discovery path</span></a>
(<code class="docutils literal"><span class="pre">PoolPath</span></code> property) and either restart the Sardana server or call the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.addctrllib" title="sardana.macroserver.macros.expert.addctrllib"><code class="xref py py-class docutils literal"><span class="pre">addctrllib</span></code></a> macro. After that
check again with the list macro if the controller class is present and if
yes let&#8217;s continue...</p>
<p>To create a controller instance you can use
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defctrl" title="sardana.macroserver.macros.expert.defctrl"><code class="xref py py-class docutils literal"><span class="pre">defctrl</span></code></a> macro:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defctrl</span> <span class="o">&lt;</span><span class="n">class</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">roles</span><span class="o">/</span><span class="n">properties</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&lt;class&gt;</span></code> parameter is a class name for your controller to use and
<code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> is the name of the new controller instance. Roles and properties are
used to configure the controller.</p>
<p>For our IcePAP controller we will use two properties: <code class="docutils literal"><span class="pre">Host</span></code> and <code class="docutils literal"><span class="pre">Port</span></code> of
our IcePAP system:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defctrl</span> <span class="n">IcepapController</span> <span class="n">ipap01</span> <span class="n">Host</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.30</span> <span class="n">Port</span> <span class="mi">5000</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">You can use the <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.sar_info" title="sardana.macroserver.macros.expert.sar_info"><code class="xref py py-class docutils literal"><span class="pre">sar_info</span></code></a> macro to
see the roles and properties available for a controller class.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To learn more about controllers see <a class="reference internal" href="../devel/overview/overview_controller.html#sardana-controller-overview"><span class="std std-ref">Controller overview</span></a>.</p>
</div>
</div>
<div class="section" id="controller-axes">
<h2>Controller axes<a class="headerlink" href="#controller-axes" title="Permalink to this headline">¶</a></h2>
<p>Since single motor controller can have multiple axes corresponding to multiple
motors, we will need to create the elements for these axes. This way the controller
will know which motor to move.</p>
<p>With the <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defelem" title="sardana.macroserver.macros.expert.defelem"><code class="xref py py-class docutils literal"><span class="pre">defelem</span></code></a> macro you can
create any type of controller axis, not only motors:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defelem</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">controller</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">axis</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> is the element name, <code class="docutils literal"><span class="pre">&lt;controller&gt;</span></code> is the controller instance on
which the element should be created and <code class="docutils literal"><span class="pre">&lt;axis&gt;</span></code> is the controller axis number.</p>
<p>Let&#8217;s add an axis to our IcePAP controller:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defelem</span> <span class="n">mot01</span> <span class="n">ipap01</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To learn more about different element types see the following sections:</p>
<ul class="last simple">
<li><a class="reference internal" href="../devel/overview/overview_motor.html#sardana-motor-overview"><span class="std std-ref">Motor overview</span></a></li>
<li><a class="reference internal" href="../devel/overview/overview_IOR.html#sardana-ior-overview"><span class="std std-ref">I/O register overview</span></a></li>
<li><a class="reference internal" href="../devel/overview/overview_countertimer.html#sardana-countertimer-overview"><span class="std std-ref">Counter/timer overview</span></a></li>
<li><a class="reference internal" href="../devel/overview/overview_0D.html#sardana-0d-overview"><span class="std std-ref">0D channel overview</span></a></li>
<li><a class="reference internal" href="../devel/overview/overview_1D.html#sardana-1d-overview"><span class="std std-ref">1D channel overview</span></a></li>
<li><a class="reference internal" href="../devel/overview/overview_2D.html#sardana-2d-overview"><span class="std std-ref">2D channel overview</span></a></li>
<li><a class="reference internal" href="../devel/overview/overview_triggergate.html#sardana-triggergate-overview"><span class="std std-ref">Trigger/gate overview</span></a></li>
</ul>
</div>
</div>
<div class="section" id="motors">
<h2>Motors<a class="headerlink" href="#motors" title="Permalink to this headline">¶</a></h2>
<p>For creating motors you can also use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defm" title="sardana.macroserver.macros.expert.defm"><code class="xref py py-class docutils literal"><span class="pre">defm</span></code></a>
macro instead of <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defelem" title="sardana.macroserver.macros.expert.defelem"><code class="xref py py-class docutils literal"><span class="pre">defelem</span></code></a>.
Its invocation is the same, it&#8217;s just a shortcut:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defm</span> <span class="n">mot02</span> <span class="n">ipap01</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="pseudomotors">
<h2>Pseudomotors<a class="headerlink" href="#pseudomotors" title="Permalink to this headline">¶</a></h2>
<p>To use our slit with more abstract interface we can use the <code class="docutils literal"><span class="pre">Slit</span></code> pseudomotor
controller. To use it, just add the <code class="docutils literal"><span class="pre">Slit</span></code> controller with the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defctrl" title="sardana.macroserver.macros.expert.defctrl"><code class="xref py py-class docutils literal"><span class="pre">defctrl</span></code></a> macro:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defctrl</span> <span class="n">Slit</span> <span class="n">s0ctrl</span> <span class="n">sl2t</span><span class="o">=</span><span class="n">mot01</span> <span class="n">sl2b</span><span class="o">=</span><span class="n">mot02</span> <span class="n">Gap</span><span class="o">=</span><span class="n">s0gap</span> <span class="n">Offset</span><span class="o">=</span><span class="n">s0off</span>
</pre></div>
</div>
<p>For the <code class="docutils literal"><span class="pre">Slit</span></code> controller we use roles. There are two types of roles:</p>
<ul class="simple">
<li>physical roles - real motors, elements that already exist in Sardana</li>
<li>pseudo roles - abstract motors that will be created by pseudo controller</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">Slit</span></code> controller defines two physical roles: <code class="docutils literal"><span class="pre">sl2t</span></code> and <code class="docutils literal"><span class="pre">sl2b</span></code>, and
two pseudo roles: <code class="docutils literal"><span class="pre">Gap</span></code> and <code class="docutils literal"><span class="pre">Offset</span></code>. Note the difference in syntax for passing
roles and properties to the <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defctrl" title="sardana.macroserver.macros.expert.defctrl"><code class="xref py py-class docutils literal"><span class="pre">defctrl</span></code></a> macro.</p>
<p>By this point your slit should be accesible from Sardana using real motors as well as
abstract pseudomotor interface.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To learn more about pseudo elements see <a class="reference internal" href="../devel/overview/overview_pseudomotor.html#sardana-pseudomotor-overview"><span class="std std-ref">Pseudo motor overview</span></a> and
<a class="reference internal" href="../devel/overview/overview_pseudocounter.html#sardana-pseudocounter-overview"><span class="std std-ref">Pseudo counter overview</span></a>.</p>
</div>
</div>
<div class="section" id="measurement-groups">
<h2>Measurement groups<a class="headerlink" href="#measurement-groups" title="Permalink to this headline">¶</a></h2>
<p>To create a measurement group use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.defmeas" title="sardana.macroserver.macros.expert.defmeas"><code class="xref py py-class docutils literal"><span class="pre">defmeas</span></code></a>
macro:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defmeas</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">channel_list</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This macro takes the name for the new meaasurement group and the list of
experimetal channels as its arguments. The first channel must be a Sardana internal
channel and at least one of the channels must be a Counter/Timer.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defmeas</span> <span class="n">mntgrp01</span> <span class="n">ct01</span> <span class="n">ct02</span> <span class="n">ct03</span> <span class="n">ct04</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To learn more about measurement groups see <a class="reference internal" href="../devel/overview/overview_measurementgroup.html#sardana-measurementgroup-overview"><span class="std std-ref">Measurement group overview</span></a>.</p>
</div>
</div>
<div class="section" id="removing-elements">
<h2>Removing elements<a class="headerlink" href="#removing-elements" title="Permalink to this headline">¶</a></h2>
<p>Each element can be removed using macro corresponding to the element type.
For controllers use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.udefctrl" title="sardana.macroserver.macros.expert.udefctrl"><code class="xref py py-class docutils literal"><span class="pre">udefctrl</span></code></a>.
For controller axes use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.udefelem" title="sardana.macroserver.macros.expert.udefelem"><code class="xref py py-class docutils literal"><span class="pre">udefelem</span></code></a>.
For measurement groups use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.udefmeas" title="sardana.macroserver.macros.expert.udefmeas"><code class="xref py py-class docutils literal"><span class="pre">udefmeas</span></code></a>.</p>
<p>Each of these macros takes the list of element names as the argument.</p>
<p>Remember that you cannot remove controllers with elements, so you must remove the
elements prior to removing the controller.</p>
</div>
<div class="section" id="useful-lists">
<h2>Useful lists<a class="headerlink" href="#useful-lists" title="Permalink to this headline">¶</a></h2>
<p>To create a controller it&#8217;s useful to know which controller classes are available.
To do this use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsctrllib" title="sardana.macroserver.macros.lists.lsctrllib"><code class="xref py py-class docutils literal"><span class="pre">lsctrllib</span></code></a> macro.
To see the created controllers use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsctrl" title="sardana.macroserver.macros.lists.lsctrl"><code class="xref py py-class docutils literal"><span class="pre">lsctrl</span></code></a>.
For lists of motors and experimental channels use <a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsm" title="sardana.macroserver.macros.lists.lsm"><code class="xref py py-class docutils literal"><span class="pre">lsm</span></code></a>
and <a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsexp" title="sardana.macroserver.macros.lists.lsexp"><code class="xref py py-class docutils literal"><span class="pre">lsexp</span></code></a> respectively.
You can display all measurement groups with <a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsmeas" title="sardana.macroserver.macros.lists.lsmeas"><code class="xref py py-class docutils literal"><span class="pre">lsmeas</span></code></a>
macro.</p>
<p>Each of these macros accepts regexp filter as the optional argument.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The path Sardana uses for loading controller classes can be configured.
See the Configuration section for details.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="macro_hooks.html" class="btn btn-neutral float-right" title="Macro Hooks" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="diffractometer.html" class="btn btn-neutral" title="Diffractometer" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.0.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>