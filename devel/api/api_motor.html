

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Motor API reference &mdash; sardana 3.0.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="sardana 3.0.2-alpha documentation" href="../../index.html"/>
        <link rel="up" title="Sardana API" href="api_sardana.html"/>
        <link rel="next" title="I/O register API reference" href="api_IOR.html"/>
        <link rel="prev" title="Controller API reference" href="api_controller.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User&#8217;s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer&#8217;s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_macros/index.html">Writing macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_controllers/index.html">Writing controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="api_sardana.html">API</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="api_macro.html">Macro API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_controller.html">Controller API</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Motor API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_IOR.html">I/O register</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_countertimer.html">Counter/timer API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_0D.html">0D experiment channel API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_1D.html">1D experiment channel API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_2D.html">2D experiment channel API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_triggergate.html">Trigger/gate API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_pseudomotor.html">Pseudo motor API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_pseudocounter.html">Pseudo counter API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_measurementgroup.html">Measurement group API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_macroserver.html">MacroServer API</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_pool.html">Pool API</a></li>
<li class="toctree-l4"><a class="reference internal" href="sardana/sardana.html">Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="api_test.html">Test API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration.html">Migration guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">sardana</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
      
          <li><a href="../index.html">Developer&#8217;s Guide</a> &raquo;</li>
      
          <li><a href="api_sardana.html">Sardana API</a> &raquo;</li>
      
    <li>Motor API reference</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/devel/api/api_motor.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="motor-api-reference">
<span id="sardana-motor-api"></span><h1>Motor API reference<a class="headerlink" href="#motor-api-reference" title="Permalink to this headline">¶</a></h1>
<p>The motor is one of the most used elements in sardana. A motor represents
anything that can be <em>changed</em> (and can potentially take some time to do it).</p>
<p>This chapter explains the generic motor <a class="reference internal" href="../../glossary.html#term-api"><span class="xref std std-term">API</span></a> in the context of sardana.
In sardana there are, in fact, two Motor <a class="reference internal" href="../../glossary.html#term-api"><span class="xref std std-term">API</span></a>s. To better explain why,
let&#8217;s consider the case were sardana server is running as a Sardana Tango
device server:</p>
<a class="reference internal image-reference" href="../../_images/sardana_server_internal_motor.png"><img alt="../../_images/sardana_server_internal_motor.png" class="align-center" src="../../_images/sardana_server_internal_motor.png" style="width: 680px;" /></a>
<p>Every motor in sardana is represented in the sardana kernel as a
<a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor" title="sardana.pool.poolmotor.PoolMotor"><code class="xref py py-class docutils literal"><span class="pre">PoolMotor</span></code></a>. The <a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor" title="sardana.pool.poolmotor.PoolMotor"><code class="xref py py-class docutils literal"><span class="pre">PoolMotor</span></code></a> <a class="reference internal" href="../../glossary.html#term-api"><span class="xref std std-term">API</span></a> is not directly
accessible from outside the sardana server. This is a low level <a class="reference internal" href="../../glossary.html#term-api"><span class="xref std std-term">API</span></a>
that is only accessbile to someone writing a server extension to sardana. At
the time of writing, the only available sardana server extension is Tango.</p>
<p>The second motor interface consists on the one provided by the server extension,
which is in this case the one provided by the Tango motor device interface:
<a class="reference internal" href="sardana/tango/pool/Motor.html#sardana.tango.pool.Motor.Motor" title="sardana.tango.pool.Motor.Motor"><code class="xref py py-class docutils literal"><span class="pre">Motor</span></code></a>. The Tango motor interface tries to
mimic the as closely as possible the <a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor" title="sardana.pool.poolmotor.PoolMotor"><code class="xref py py-class docutils literal"><span class="pre">PoolMotor</span></code></a> <a class="reference internal" href="../../glossary.html#term-api"><span class="xref std std-term">API</span></a>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../overview/overview_motor.html#sardana-motor-overview"><span class="std std-ref">Motor overview</span></a></dt>
<dd>the motor overview</dd>
<dt><a class="reference internal" href="sardana/tango/pool/Motor.html#sardana.tango.pool.Motor.Motor" title="sardana.tango.pool.Motor.Motor"><code class="xref py py-class docutils literal"><span class="pre">Motor</span></code></a></dt>
<dd>the motor tango device <a class="reference internal" href="../../glossary.html#term-api"><span class="xref std std-term">API</span></a></dd>
</dl>
</div>
<p>A motor will have, at least, a <code class="docutils literal"><span class="pre">state</span></code>, and a <code class="docutils literal"><span class="pre">position</span></code>. The state
indicates at any time if the motor is stopped, in alarm or moving. The
position, indicates the current <a class="reference internal" href="../../glossary.html#term-user-position"><span class="xref std std-term">user position</span></a>. Unless a motor
controller is specifically programmed not to, it&#8217;s motors will also have:</p>
<dl class="docutils">
<dt><strong>limit switches</strong></dt>
<dd><p class="first">the three limit switches (home, upper and lower). Each switch is
represented by a boolean value: False means inactive while True means
active.</p>
<p>low level <a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor" title="sardana.pool.poolmotor.PoolMotor"><code class="xref py py-attr docutils literal"><span class="pre">PoolMotor</span></code></a> API.</p>
<p class="last">high level Tango Motor API: limit_switches tango attribute</p>
</dd>
<dt><strong>acceleration</strong></dt>
<dd><p class="first">motor acceleration (usually acceleration time in seconds, but it&#8217;s up to
the motor controller class to decide)</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.acceleration" title="sardana.pool.poolmotor.PoolMotor.acceleration"><code class="xref py py-attr docutils literal"><span class="pre">acceleration</span></code></a></p>
</dd>
<dt><strong>deceleration</strong></dt>
<dd><p class="first">motor deceleration (usually deceleration time in seconds, but it&#8217;s up to
the motor controller class to decide)</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.deceleration" title="sardana.pool.poolmotor.PoolMotor.deceleration"><code class="xref py py-attr docutils literal"><span class="pre">deceleration</span></code></a></p>
</dd>
<dt><strong>velocity</strong></dt>
<dd><p class="first">top velocity</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.velocity" title="sardana.pool.poolmotor.PoolMotor.velocity"><code class="xref py py-attr docutils literal"><span class="pre">velocity</span></code></a></p>
</dd>
<dt><strong>base rate</strong></dt>
<dd><p class="first">initial velocity</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.base_rate" title="sardana.pool.poolmotor.PoolMotor.base_rate"><code class="xref py py-attr docutils literal"><span class="pre">base_rate</span></code></a></p>
</dd>
<dt><strong>dial position</strong></dt>
<dd><p class="first">the <a class="reference internal" href="../../glossary.html#term-dial-position"><span class="xref std std-term">dial position</span></a></p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.dial_position" title="sardana.pool.poolmotor.PoolMotor.dial_position"><code class="xref py py-attr docutils literal"><span class="pre">dial_position</span></code></a></p>
</dd>
<dt><strong>offset</strong></dt>
<dd><p class="first">the offset to be applied in the motor position computation [default: 0.0]</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.offset" title="sardana.pool.poolmotor.PoolMotor.offset"><code class="xref py py-attr docutils literal"><span class="pre">offset</span></code></a></p>
</dd>
<dt><strong>sign</strong></dt>
<dd><p class="first">the sign to be applied in the motor position computation [default: 1,
possible values are (1, -1)]</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.sign" title="sardana.pool.poolmotor.PoolMotor.sign"><code class="xref py py-attr docutils literal"><span class="pre">sign</span></code></a></p>
</dd>
<dt><strong>steps per unit</strong></dt>
<dd><p class="first">This is the number of motor steps per <a class="reference internal" href="../../glossary.html#term-user-position"><span class="xref std std-term">user position</span></a> [default:
1.0]</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.step_per_unit" title="sardana.pool.poolmotor.PoolMotor.step_per_unit"><code class="xref py py-attr docutils literal"><span class="pre">step_per_unit</span></code></a></p>
</dd>
<dt><strong>backlash</strong></dt>
<dd><p class="first">If this is defined to be something different than 0, the motor will
always stop the motion coming from the same mechanical direction. This
means that it could be possible to ask the motor to go a little bit after
the desired position and then to return to the desired position. The value
is the number of steps the motor will pass the desired position if it
arrives from the &#8220;wrong&#8221; direction. This is a signed value. If the sign is
positive, this means that the authorized direction to stop the motion is
the increasing motor position direction. If the sign is negative, this
means that the authorized direction to stop the motion is the decreasing
motor position direction.</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.backlash" title="sardana.pool.poolmotor.PoolMotor.backlash"><code class="xref py py-attr docutils literal"><span class="pre">backlash</span></code></a></p>
</dd>
<dt><strong>instability time</strong></dt>
<dd><p class="first">This property defines the time in milliseconds that the software
managing a motor movement will wait between it detects the end of the
motion and the last motor position reading. It is typically used for motors
that move mechanics which have an instability time after each motion.</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.instability_time" title="sardana.pool.poolmotor.PoolMotor.instability_time"><code class="xref py py-attr docutils literal"><span class="pre">instability_time</span></code></a></p>
</dd>
</dl>
<p>The available operations are:</p>
<dl class="docutils">
<dt>start move absolute (<a class="reference internal" href="../../glossary.html#term-user-position"><span class="xref std std-term">user position</span></a>)</dt>
<dd><p class="first">starts to move the motor to the given absolute user position</p>
<p class="last"><a class="reference internal" href="sardana/pool/poolmotor.html#sardana.pool.poolmotor.PoolMotor.start_move" title="sardana.pool.poolmotor.PoolMotor.start_move"><code class="xref py py-meth docutils literal"><span class="pre">start_move()</span></code></a></p>
</dd>
<dt>stop</dt>
<dd>stops the motor in an orderly fashion</dd>
<dt>abort</dt>
<dd>stops the motor motion as fast as possible (possibly without
deceleration time and loss of position)</dd>
</dl>
<div class="section" id="motor-state">
<h2>Motor state<a class="headerlink" href="#motor-state" title="Permalink to this headline">¶</a></h2>
<p>On a sardana tango server, the motor state can be obtained by reading the state
attribute or by executing the state command. The diagram shows the internal
sequence of calls.</p>
<a class="reference internal image-reference" href="../../_images/sardana_server_internal_motor_read_state_flow.png"><img alt="../../_images/sardana_server_internal_motor_read_state_flow.png" class="align-center" src="../../_images/sardana_server_internal_motor_read_state_flow.png" style="width: 680px;" /></a>
</div>
<div class="section" id="motor-position">
<span id="sardana-motor-api-position"></span><h2>Motor position<a class="headerlink" href="#motor-position" title="Permalink to this headline">¶</a></h2>
<p>The motor&#8217;s current <a class="reference internal" href="../../glossary.html#term-user-position"><span class="xref std std-term">user position</span></a> can be obtained by reading the
position attribute. The diagram shows the internal sequence of calls.</p>
<a class="reference internal image-reference" href="../../_images/sardana_server_internal_motor_read_position_flow.png"><img alt="../../_images/sardana_server_internal_motor_read_position_flow.png" class="align-center" src="../../_images/sardana_server_internal_motor_read_position_flow.png" style="width: 680px;" /></a>
</div>
<div class="section" id="motion">
<h2>Motion<a class="headerlink" href="#motion" title="Permalink to this headline">¶</a></h2>
<p>The most useful thing to do with a motor is, of course, to move it. To move a
motor to another absolute <a class="reference internal" href="../../glossary.html#term-user-position"><span class="xref std std-term">user position</span></a> you have to write the value
into the position attribute.</p>
<a class="reference internal image-reference" href="../../_images/sardana_server_internal_motor_write_position_flow.png"><img alt="../../_images/sardana_server_internal_motor_write_position_flow.png" class="align-center" src="../../_images/sardana_server_internal_motor_write_position_flow.png" style="width: 680px;" /></a>
<p>Before allowing a movement, some pre-conditions are automatically checked by
tango (not represented in the diagram):</p>
<blockquote>
<div><ul class="simple">
<li>motor is in a proper state;</li>
<li>requested position is within the allowed motor boundaries (if
defined)</li>
</ul>
</div></blockquote>
<p>Then, the <a class="reference internal" href="../../glossary.html#term-dial-position"><span class="xref std std-term">dial position</span></a> is calculated taking into account the <em>offset</em>,
<em>signal</em> as well as a possible <em>backlash</em>.</p>
<p>Afterward, and because the motor may be part of a pseudo motor system, other
pre-conditions are checked:</p>
<blockquote>
<div><ul class="simple">
<li>is the final <a class="reference internal" href="../../glossary.html#term-dial-position"><span class="xref std std-term">dial position</span></a> (including backlash) within the
motor boundaries (if defined)</li>
<li>will the resulting motion end in an allowed position for all the
pseudo motors that depend on this motor</li>
</ul>
</div></blockquote>
<p>After all pre-conditions are checked, the motor will deploy a motion <em>job</em> into
the sardana kernel engine which will trigger a series of calls to the
underlying motor controller.</p>
<p>The motor awaits for the <a class="reference internal" href="sardana/pool/controller.html#sardana.pool.controller.Startable.PreStartOne" title="sardana.pool.controller.Startable.PreStartOne"><code class="xref py py-meth docutils literal"><span class="pre">PreStartOne()</span></code></a>
to signal that the motion will be possible to return successfully from the move
request.</p>
<p>The following diagram shows the motion state machine of a motor. The black state
transitions are the ones which can be triggered by a <em>user</em>.
For simplicity, only the most relevant states involved in a motor
motion are shown. Error states are omitted.</p>
<img src="../../_images/graphviz-aba0ed6920fde3ffcf91942b1707c60b3525ba02.png" alt="Basic motion diagram" />
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api_IOR.html" class="btn btn-neutral float-right" title="I/O register API reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api_controller.html" class="btn btn-neutral" title="Controller API reference" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'3.0.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>