

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Macro call examples &mdash; sardana 3.0.4-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Macro hooks examples" href="macro_hooks_examples.html" />
    <link rel="prev" title="Macro parameter examples" href="macro_parameter_examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User’s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_macros/index.html">Writing macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_controllers/index.html">Writing controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/api_sardana.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration/index.html">Migration guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="macro_examples.html">Macro examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_examples.html">Controller examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sardana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="examples.html">Examples</a> &raquo;</li>
        
          <li><a href="macro_examples.html">Macro examples</a> &raquo;</li>
        
      <li>Macro call examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devel/examples/macro_call_examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="macro-call-examples">
<span id="sardana-devel-macro-call-examples"></span><h1>Macro call examples<a class="headerlink" href="#macro-call-examples" title="Permalink to this headline">¶</a></h1>
<p>This chapter consists of a series of examples demonstrating how to call macros
from inside a macro</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">##############################################################################</span>
<span class="c1">##</span>
<span class="c1"># This file is part of Sardana</span>
<span class="c1">##</span>
<span class="c1"># http://www.sardana-controls.org/</span>
<span class="c1">##</span>
<span class="c1"># Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">##</span>
<span class="c1"># Sardana is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1"># Sardana is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Sardana.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">##############################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A macro package to show examples on how to run a macro from inside another macro</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;call_wa&quot;</span><span class="p">,</span> <span class="s2">&quot;call_wm&quot;</span><span class="p">,</span> <span class="s2">&quot;subsubm&quot;</span><span class="p">,</span> <span class="s2">&quot;subm&quot;</span><span class="p">,</span> <span class="s2">&quot;mainmacro&quot;</span><span class="p">,</span> <span class="s2">&quot;runsubs&quot;</span><span class="p">]</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;restructuredtext&#39;</span>

<span class="kn">from</span> <span class="nn">sardana.macroserver.macro</span> <span class="kn">import</span> <span class="n">Macro</span><span class="p">,</span> <span class="n">Type</span>

<span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
<span class="c1"># First example:</span>
<span class="c1"># A &#39;mainmacro&#39; that executes a &#39;subm&#39; that in turn executes a &#39;subsubm&#39;.</span>
<span class="c1"># The &#39;subsubm&#39; macro itself calls a short ascan macro</span>
<span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~--~-~-</span>


<span class="k">class</span> <span class="nc">call_wa</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">wa</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">call_wm</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;motor_list&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Motor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">]],</span>
         <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;List of motor to show&#39;</span><span class="p">],</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">wm</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">subsubm</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;this macro just calls the &#39;subm&#39; macro</span>
<span class="sd">    This macro is part of the examples package. It was written for demonstration purposes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Starting </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span>
        <span class="n">motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getObjs</span><span class="p">(</span><span class="s1">&#39;.*&#39;</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">Type</span><span class="o">.</span><span class="n">Motor</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">ascan</span><span class="p">(</span><span class="n">motors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Finished </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">subm</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;this macro just calls the &#39;subsubm&#39; macro</span>
<span class="sd">    This macro is part of the examples package. It was written for demonstration purposes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Starting </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">subsubm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Finished </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">mainmacro</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;this macro just calls the &#39;subm&#39; macro</span>
<span class="sd">    This macro is part of the examples package. It was written for demonstration purposes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Starting </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">subm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Finished </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>

<span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
<span class="c1"># Second example:</span>
<span class="c1"># a &#39;runsubs&#39; macro that shows the different ways to call a macro from inside</span>
<span class="c1"># another macro</span>
<span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~--~-~-</span>


<span class="k">class</span> <span class="nc">runsubs</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A macro that calls a ascan macro using the motor given as first parameter.</span>

<span class="sd">    This macro is part of the examples package. It was written for demonstration purposes</span>

<span class="sd">    Call type will allow to choose to format in which the ascan macro is called</span>
<span class="sd">    from this macro:</span>
<span class="sd">    1 - m.ascan(motor.getName(), &#39;0&#39;, &#39;10&#39;, &#39;4&#39;, &#39;0.2&#39;)</span>
<span class="sd">    2 - m.ascan(motor, 0, 10, 4, 0.2)</span>
<span class="sd">    3 - self.execMacro(&#39;ascan&#39;, motor.getName(), &#39;0&#39;, &#39;10&#39;, &#39;4&#39;, &#39;0.2&#39;)</span>
<span class="sd">    4 - self.execMacro([&#39;ascan&#39;, motor, 0, 10, 4, 0.2])</span>
<span class="sd">    5 - params = &#39;ascan&#39;, motor, 0, 10, 4, 0.2</span>
<span class="sd">        self.execMacro(params)</span>
<span class="sd">    6 - self.execMacro(&quot;ascan %s 0 10 4 0.2&quot; % motor.getName())</span>
<span class="sd">    7 - macro, prep = self.createMacro(&quot;ascan %s 0 10 4 0.2&quot; % motor.getName())</span>
<span class="sd">        macro.hooks = [ self.hook ]</span>
<span class="sd">        self.runMacro(macro)</span>
<span class="sd">    8 - macro, prep = self.createMacro(&#39;ascan&#39;, motor, 0, 10, 4, 0.2)</span>
<span class="sd">        macro.hooks = [ self.hook ]</span>
<span class="sd">        self.runMacro(macro)</span>
<span class="sd">    9 - params = &#39;ascan&#39;, motor, 0, 10, 4, 0.2</span>
<span class="sd">        macro, prep = self.createMacro(params)</span>
<span class="sd">        macro.hooks = [ self.hook ]</span>
<span class="sd">        self.runMacro(macro)</span>

<span class="sd">        Options 7,8 and 9 use the lower level macro API in order to be able to</span>
<span class="sd">        attach hooks to the ascan macro.&quot;&quot;&quot;</span>
    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span>      <span class="n">Type</span><span class="o">.</span><span class="n">Motor</span><span class="p">,</span>   <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;call_type&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;type of run to execute internally&#39;</span><span class="p">],</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;executing hook in a step of a scan...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">call_type</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;Using type </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">call_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">ascan</span><span class="p">(</span><span class="n">motor</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;0.2&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">ascan</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="s1">&#39;ascan&#39;</span><span class="p">,</span> <span class="n">motor</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;0.2&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="s1">&#39;ascan&#39;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="s1">&#39;ascan&#39;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="s2">&quot;ascan </span><span class="si">%s</span><span class="s2"> 0 10 4 0.2&quot;</span> <span class="o">%</span> <span class="n">motor</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">macro</span><span class="p">,</span> <span class="n">prep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span><span class="s2">&quot;ascan </span><span class="si">%s</span><span class="s2"> 0 10 4 0.2&quot;</span> <span class="o">%</span>
                                           <span class="n">motor</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="n">macro</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">macro</span><span class="p">,</span> <span class="n">prep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span><span class="s1">&#39;ascan&#39;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="n">macro</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="s1">&#39;ascan&#39;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.2</span>
            <span class="n">macro</span><span class="p">,</span> <span class="n">prep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">macro</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">get_data</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A macro that executes another macro from within it, get its data,</span>
<span class="sd">    and calculates a result using this data.</span>

<span class="sd">    This macro is part of the examples package. It was written for</span>
<span class="sd">    demonstration purposes&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;mot&quot;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Moveable</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;moveable to be moved&quot;</span><span class="p">]]</span>
    <span class="n">result_def</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="s2">&quot;the middle motor position&quot;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mot</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">integtime</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dscan</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createMacro</span><span class="p">(</span><span class="s1">&#39;dscan&#39;</span><span class="p">,</span>
                                    <span class="n">mot</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">intervals</span><span class="p">,</span> <span class="n">integtime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">dscan</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">dscan</span><span class="o">.</span><span class="n">data</span>
        <span class="n">len_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">point_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_data</span><span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">point_nb</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mot</span><span class="o">.</span><span class="n">getName</span><span class="p">()]</span>
            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="n">middle_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">/</span> <span class="n">len_data</span>
        <span class="k">return</span> <span class="n">middle_pos</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="macro_hooks_examples.html" class="btn btn-neutral float-right" title="Macro hooks examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="macro_parameter_examples.html" class="btn btn-neutral float-left" title="Macro parameter examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>