

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to write a 1D controller &mdash; sardana 3.0.4-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to write a 2D controller" href="howto_2dcontroller.html" />
    <link rel="prev" title="How to write a 0D controller" href="howto_0dcontroller.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User’s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_macros/index.html">Writing macros</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Writing controllers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="howto_controller.html">What is a controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_motorcontroller.html">How to write a motor controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_countertimercontroller.html">How to write a counter/timer controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_0dcontroller.html">How to write a 0D controller</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">How to write a 1D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_2dcontroller.html">How to write a 2D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_triggergatecontroller.html">How to write a trigger/gate controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_ioregistercontroller.html">How to write an I/O register controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_pseudomotorcontroller.html">How to write a pseudo motor controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_pseudocountercontroller.html">How to write a pseudo counter controller</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/api_sardana.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration/index.html">Migration guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sardana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">Writing controllers</a> &raquo;</li>
        
      <li>How to write a 1D controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devel/howto_controllers/howto_1dcontroller.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-write-a-1d-controller">
<span id="sardana-1dcontroller-howto-basics"></span><h1><a class="toc-backref" href="#id1">How to write a 1D controller</a><a class="headerlink" href="#how-to-write-a-1d-controller" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-basics">
<h2><a class="toc-backref" href="#id2">The basics</a><a class="headerlink" href="#the-basics" title="Permalink to this headline">¶</a></h2>
<p>This chapter provides the necessary information to write a one dimensional (1D)
experimental channel controller in Sardana.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-write-a-1d-controller" id="id1">How to write a 1D controller</a></p>
<ul>
<li><p><a class="reference internal" href="#the-basics" id="id2">The basics</a></p></li>
<li><p><a class="reference internal" href="#general-guide" id="id3">General guide</a></p>
<ul>
<li><p><a class="reference internal" href="#get-1d-shape" id="id4">Get 1D shape</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#differences-with-counter-timer-controller" id="id5">Differences with counter/timer controller</a></p>
<ul>
<li><p><a class="reference internal" href="#class-definition" id="id6">Class definition</a></p></li>
<li><p><a class="reference internal" href="#get-1d-value" id="id7">Get 1D value</a></p></li>
<li><p><a class="reference internal" href="#get-1d-values" id="id8">Get 1D values</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advanced-topics" id="id9">Advanced topics</a></p>
<ul>
<li><p><a class="reference internal" href="#working-with-value-referencing" id="id10">Working with value referencing</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="general-guide">
<span id="sardana-1dcontroller-general-guide"></span><h2><a class="toc-backref" href="#id3">General guide</a><a class="headerlink" href="#general-guide" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../overview/overview_1D.html#sardana-1d-overview"><span class="std std-ref">1D experimental channels</span></a>
together with <a class="reference internal" href="../overview/overview_2D.html#sardana-2d-overview"><span class="std std-ref">2D experimental channels</span></a>
and <a class="reference internal" href="../overview/overview_countertimer.html#sardana-countertimer-overview"><span class="std std-ref">counter/timers</span></a>
belong to the same family of <em>timerable</em> experimental channels.</p>
<p>To write a 1D controller class you can follow
the <a class="reference internal" href="howto_countertimercontroller.html#sardana-countertimercontroller"><span class="std std-ref">How to write a counter/timer controller</span></a> guide keeping in mind
differences explained in continuation.</p>
<div class="section" id="get-1d-shape">
<span id="sardana-1dcontroller-general-guide-shape"></span><h3><a class="toc-backref" href="#id4">Get 1D shape</a><a class="headerlink" href="#get-1d-shape" title="Permalink to this headline">¶</a></h3>
<p>1D controller should provide a shape of the spectrum which will be produced by
acquisition. The shape can be either static e.g. defined by the detector’s
sensor size or dynamic e.g. depending on the detector’s (or an intermediate
control software layer e.g. <a class="reference external" href="https://lima1.readthedocs.io/en/latest/">LImA</a>) configuration like <a class="reference internal" href="../../glossary.html#term-RoI"><span class="xref std std-term">RoI</span></a> or binning.</p>
<p>In any case you should provide the shape in the format of a one-element sequence
with the length of the spectrum using
the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.GetAxisPar" title="sardana.pool.controller.Controller.GetAxisPar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetAxisPar()</span></code></a> method.</p>
<p>Here is an example of the possible implementation of
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.GetAxisPar" title="sardana.pool.controller.Controller.GetAxisPar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetAxisPar()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldOneDController</span><span class="p">(</span><span class="n">TwoDController</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">GetAxisPar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">par</span> <span class="o">==</span> <span class="s2">&quot;shape&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">getShape</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</pre></div>
</div>
<p>For backwards compatibility, in case of not implementing the <code class="docutils literal notranslate"><span class="pre">shape</span></code> axis
parameter, shape will be determined from the <code class="docutils literal notranslate"><span class="pre">MaxDimSize</span></code> of the <code class="docutils literal notranslate"><span class="pre">Value</span></code>
attribute, currently (4096,).</p>
</div>
</div>
<div class="section" id="differences-with-counter-timer-controller">
<span id="sardana-1dcontroller-differences-countertimer"></span><h2><a class="toc-backref" href="#id5">Differences with counter/timer controller</a><a class="headerlink" href="#differences-with-counter-timer-controller" title="Permalink to this headline">¶</a></h2>
<div class="section" id="class-definition">
<h3><a class="toc-backref" href="#id6">Class definition</a><a class="headerlink" href="#class-definition" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="howto_countertimercontroller.html#sardana-countertimercontroller-howto-basics"><span class="std std-ref">The basics of the counter/timer controller</span></a>
chapter explains how to define the counter/timer controller class.
Here you need to simply inherit from the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.OneDController" title="sardana.pool.controller.OneDController"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OneDController</span></code></a> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sardana.pool.controller</span> <span class="kn">import</span> <span class="n">OneDController</span>

<span class="hll"><span class="k">class</span> <span class="nc">SpringfieldOneDController</span><span class="p">(</span><span class="n">OneDController</span><span class="p">):</span>
</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="get-1d-value">
<span id="sardana-1dcontroller-getvalue"></span><h3><a class="toc-backref" href="#id7">Get 1D value</a><a class="headerlink" href="#get-1d-value" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="howto_countertimercontroller.html#sardana-countertimercontroller-howto-value"><span class="std std-ref">Get counter value</span></a> chapter
explains how to read a counter/timer value
using the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Readable.ReadOne" title="sardana.pool.controller.Readable.ReadOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ReadOne()</span></code></a> method.
Here you need to implement the same method but its return value
must be a one-dimensional <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.20)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.array</span></code></a> (or eventually
a <a class="reference internal" href="../api/sardana/sardanavalue.html#sardana.sardanavalue.SardanaValue" title="sardana.sardanavalue.SardanaValue"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SardanaValue</span></code></a> object) containing the spectrum instead
of a scalar value.</p>
</div>
<div class="section" id="get-1d-values">
<span id="sardana-1dcontroller-getvalues"></span><h3><a class="toc-backref" href="#id8">Get 1D values</a><a class="headerlink" href="#get-1d-values" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="howto_countertimercontroller.html#sardana-countertimercontroller-howto-external-synchronization-get-values"><span class="std std-ref">Get counter values</span></a>
chapter explains how to read counter/timer values
using the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Readable.ReadOne" title="sardana.pool.controller.Readable.ReadOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ReadOne()</span></code></a> method while
acquiring with external (hardware) synchronization.
Here you need to implement the same method but its return value
must be a sequence with one-dimensional <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.20)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.array</span></code></a> objects (or eventually
with <a class="reference internal" href="../api/sardana/sardanavalue.html#sardana.sardanavalue.SardanaValue" title="sardana.sardanavalue.SardanaValue"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SardanaValue</span></code></a> objects) containing spectrums
instead of scalar values.</p>
</div>
</div>
<div class="section" id="advanced-topics">
<h2><a class="toc-backref" href="#id9">Advanced topics</a><a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="working-with-value-referencing">
<span id="sardana-1dcontroller-valuereferencing"></span><h3><a class="toc-backref" href="#id10">Working with value referencing</a><a class="headerlink" href="#working-with-value-referencing" title="Permalink to this headline">¶</a></h3>
<p>1D experimental channels may produce significant arrays of data at high
frame rate. Reading this data and storing it using sardana
is not always optimal. <a class="reference external" href="http://www.sardana-controls.org/sep/?SEP2.md">SEP2</a> introduced data saving duality, optionally,
leaving the data storage at the responsibility of the detector
(or an intermediate software layer e.g. <a class="reference external" href="https://lima1.readthedocs.io/en/latest/">LImA</a>). In this case sardana
just deals with the reference to the data.</p>
<p>Please refer to <a class="reference internal" href="howto_2dcontroller.html#sardana-2dcontroller-valuereferencing"><span class="std std-ref">Working with value referencing</span></a> chapter from
<a class="reference internal" href="howto_2dcontroller.html#sardana-2dcontroller-howto"><span class="std std-ref">How to write a 2D controller</span></a> guide in order to implement this feature for 1D
controller.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="howto_2dcontroller.html" class="btn btn-neutral float-right" title="How to write a 2D controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="howto_0dcontroller.html" class="btn btn-neutral float-left" title="How to write a 0D controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>