

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>What is a controller &mdash; sardana 3.0.4-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to write a motor controller" href="howto_motorcontroller.html" />
    <link rel="prev" title="Writing controllers" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User’s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_macros/index.html">Writing macros</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Writing controllers</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">What is a controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_motorcontroller.html">How to write a motor controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_countertimercontroller.html">How to write a counter/timer controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_0dcontroller.html">How to write a 0D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_1dcontroller.html">How to write a 1D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_2dcontroller.html">How to write a 2D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_triggergatecontroller.html">How to write a trigger/gate controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_ioregistercontroller.html">How to write an I/O register controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_pseudomotorcontroller.html">How to write a pseudo motor controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_pseudocountercontroller.html">How to write a pseudo counter controller</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/api_sardana.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration/index.html">Migration guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sardana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">Writing controllers</a> &raquo;</li>
        
      <li>What is a controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/devel/howto_controllers/howto_controller.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="what-is-a-controller">
<span id="sardana-controller-howto-whatis"></span><h1>What is a controller<a class="headerlink" href="#what-is-a-controller" title="Permalink to this headline">¶</a></h1>
<p>A controller in sardana is a piece of software capable of <em>translating</em>
between the sardana <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a> and a specific hardware <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a>. Sardana
expects a controller to obey a specific <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a> in order to be able to
properly configure and operate with it. The hardware <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a> used by the
controller could connect directly to the hardware via specific libraries or
connect to any standalone server written for example in <a class="reference external" href="http://www.tango-controls.org/">Tango</a>, <a class="reference external" href="http://www.esrf.eu/Infrastructure/Computing/TACO/">Taco</a> or even <a class="reference external" href="http://www.aps.anl.gov/epics/">EPICS</a>. Since Sardana is written in python talking directly to the hardware is
not possible if the hardware libraries do not have a python interface. For
the rest of the cases both solutions are usually valid and is up to the
developers to evaluate and decide which of botho solutions is the most
convenient one.
Having a standalone server could be more convenient for debugging or
testing purporses or for having access to the hardware without the need
of running sardana, but it requires more work in the implementation, since
both standalone server and controller have to be developed. This does not
apply in case the hardware is already integrated or controlled by another
system.</p>
<p>Controllers can only be written in <a class="reference external" href="http://www.python.org/">Python</a> (in future also C++ will be
possible). A controller <strong>must</strong> be a <a class="reference internal" href="../../glossary.html#term-class"><span class="xref std std-term">class</span></a> inheriting from one of the
existing controller types:</p>
<table class="hlist"><tr><td><ul class="simple">
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.MotorController" title="sardana.pool.controller.MotorController"><code class="xref py py-class docutils literal notranslate"><span class="pre">MotorController</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.CounterTimerController" title="sardana.pool.controller.CounterTimerController"><code class="xref py py-class docutils literal notranslate"><span class="pre">CounterTimerController</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.ZeroDController" title="sardana.pool.controller.ZeroDController"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZeroDController</span></code></a></p></li>
</ul>
</td><td><ul class="simple">
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.OneDController" title="sardana.pool.controller.OneDController"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneDController</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.TwoDController" title="sardana.pool.controller.TwoDController"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoDController</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.IORegisterController" title="sardana.pool.controller.IORegisterController"><code class="xref py py-class docutils literal notranslate"><span class="pre">IORegisterController</span></code></a></p></li>
</ul>
</td><td><ul class="simple">
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.TriggerGateController" title="sardana.pool.controller.TriggerGateController"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerGateController</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.PseudoMotorController" title="sardana.pool.controller.PseudoMotorController"><code class="xref py py-class docutils literal notranslate"><span class="pre">PseudoMotorController</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.PseudoCounterController" title="sardana.pool.controller.PseudoCounterController"><code class="xref py py-class docutils literal notranslate"><span class="pre">PseudoCounterController</span></code></a></p></li>
</ul>
</td></tr></table>
<p>A controller is designed to incorporate a set of generic individual elements.
Each element has a corresponding <em>axis</em>. For example, in a motor
controller the elements will be motors, but in a counter/timer controller the
elements will be experimental channels.</p>
<p>Some controller classes are designed to target a specific type of hardware.
Other classes of controllers, the <em>pseudo</em> classes, are designed to provide a
high level view over a set of underlying lower level controller elements.</p>
<p>We will focus first on writing low level hardware controllers since they
share some of the <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a> and after on the <em>pseudo</em> controllers.</p>
<div class="section" id="controller-the-basics">
<span id="sardana-controller-howto-basics"></span><h2>Controller - The basics<a class="headerlink" href="#controller-the-basics" title="Permalink to this headline">¶</a></h2>
<p>The first thing to do is to import the necessary symbols from sardana library.
As you will see, most symbols can be imported through the
<a class="reference internal" href="../api/sardana/pool/controller.html#module-sardana.pool.controller" title="sardana.pool.controller"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sardana.pool.controller</span></code></a> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">springfieldlib</span>

<span class="kn">from</span> <span class="nn">sardana.pool.controller</span> <span class="kn">import</span> <span class="n">MotorController</span>

<span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A motor controller intended for demonstration purposes only&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The common <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a> to all low level controllers includes the set of methods
to:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>construct the controller</p></li>
<li><p>add/delete a controller element <a class="footnote-reference brackets" href="#f1" id="id1">1</a></p></li>
<li><p>obtain the state of controller element(s) <a class="footnote-reference brackets" href="#f2" id="id2">2</a></p></li>
<li><p>define, set and get extra axis attributes</p></li>
<li><p>define, set and get extra controller attributes</p></li>
<li><p>define, set and get extra controller properties</p></li>
</ol>
</div></blockquote>
<p>In the following chapters the examples will be based on a motor controller
scenario.</p>
<p>The examples use a <code class="xref py py-mod docutils literal notranslate"><span class="pre">springfieldlib</span></code> module which emulates a motor hardware
access library.</p>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">springfieldlib</span></code> can be downloaded from
<a class="reference download internal" download="" href="../../_downloads/48cc05f28f359e8a865124c6a58f2f5c/springfieldlib.py"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<p>The Springfield motor controller can be downloaded from
<a class="reference download internal" download="" href="../../_downloads/d560635ad0e87f4ce9f3652bbc9bc02e/sf_motor_ctrl.py"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<div class="section" id="constructor">
<span id="sardana-controller-howto-constructor"></span><h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h3>
<p>The constructor consists of the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> method. This method is
called when you create a new controller of that type and every time the sardana
server is started. It will also be called if the controller code has changed
on the file and the new code is reloaded into sardana.</p>
<p>It is <strong>NOT</strong> mandatory to override the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>
from <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.MotorController" title="sardana.pool.controller.MotorController"><code class="xref py py-class docutils literal notranslate"><span class="pre">MotorController</span></code></a>   . Do it only
if you need to add some initialization code. If you do it, it is <strong>very important</strong>
to follow the two rules:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>use the method signature: <code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">inst,</span> <span class="pre">props,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code></p></li>
<li><p>always call the super class constructor</p></li>
</ol>
</div></blockquote>
<p>The example shows how to implement a constructor for a motor controller:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span>        <span class="nb">super</span><span class="p">(</span><span class="n">SpringfieldMotorController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># initialize hardware communication</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span> <span class="o">=</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">SpringfieldMotorHW</span><span class="p">()</span>

        <span class="c1"># do some initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
<div class="section" id="add-delete-axis">
<span id="sardana-controller-howto-add-delete"></span><h3>Add/Delete axis<a class="headerlink" href="#add-delete-axis" title="Permalink to this headline">¶</a></h3>
<p>Each individual element in a controller is called <em>axis</em>. An axis is represented
by a number. A controller can support one or more axes. Axis numbers don’t need
to be sequencial. For example, at one time you may have created for your motor
controller instance only axis 2 and 5.</p>
<p>Two methods are called when creating or removing an element from a controller.
These methods are <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.AddDevice" title="sardana.pool.controller.Controller.AddDevice"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AddDevice()</span></code></a> and
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.DeleteDevice" title="sardana.pool.controller.Controller.DeleteDevice"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DeleteDevice()</span></code></a>. The
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.AddDevice" title="sardana.pool.controller.Controller.AddDevice"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AddDevice()</span></code></a> method is called when a
new axis belonging to the controller is created in sardana. The
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.DeleteDevice" title="sardana.pool.controller.Controller.DeleteDevice"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DeleteDevice()</span></code></a> method is
called when an axis belonging to the controller is removed from sardana.
These methods are also called when the sardana server is started and if the
controller code has changed on the file and the new code is reloaded into
sardana.</p>
<p>The example shows an example how to implement these methods on a motor
controller:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="nf">AddDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="hll">    <span class="k">def</span> <span class="nf">DeleteDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motor</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="get-axis-state">
<span id="sardana-controller-howto-axis-state"></span><h3>Get axis state<a class="headerlink" href="#get-axis-state" title="Permalink to this headline">¶</a></h3>
<p>To get the state of an axis, sardana calls the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a> method. This method
receives an axis as parameter and should return either:</p>
<blockquote>
<div><ul class="simple">
<li><p>state (<a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a>) or</p></li>
<li><dl class="simple">
<dt>a sequence of two elements:</dt><dd><ul>
<li><p>state (<a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a>)</p></li>
<li><p>status (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>(For motor controller see <a class="reference internal" href="howto_motorcontroller.html#sardana-motorcontroller-howto-axis-state"><span class="std std-ref">get motor state</span></a> ):</p>
<p>The state should be a member of <a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a> (For backward
compatibility reasons, it is also supported to return one of
<code class="xref py py-class docutils literal notranslate"><span class="pre">PyTango.DevState</span></code>). The status could be any string.</p>
<p>If you return a <a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a> object, sardana will compose a
status string with:</p>
<blockquote>
<div><p>&lt;axis name&gt; is in &lt;state name&gt;</p>
</div></blockquote>
<p>Here is an example of the possible implementation of
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sardana</span> <span class="kn">import</span> <span class="n">State</span>

<span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

    <span class="n">StateMap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">1</span> <span class="p">:</span> <span class="n">State</span><span class="o">.</span><span class="n">On</span><span class="p">,</span>
        <span class="mi">2</span> <span class="p">:</span> <span class="n">State</span><span class="o">.</span><span class="n">Moving</span><span class="p">,</span>
        <span class="mi">3</span> <span class="p">:</span> <span class="n">State</span><span class="o">.</span><span class="n">Fault</span><span class="p">,</span>
    <span class="p">}</span>

<span class="hll">    <span class="k">def</span> <span class="nf">StateOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="n">springfield</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StateMap</span><span class="p">[</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getStatus</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="extra-axis-attributes">
<span id="sardana-controller-howto-axis-attributes"></span><h3>Extra axis attributes<a class="headerlink" href="#extra-axis-attributes" title="Permalink to this headline">¶</a></h3>
<p>Each axis is associated a set of standard attributes. These attributes depend
on the type of controller (example, a motor will have velocity, acceleration but
a counter won’t).</p>
<p>Additionally, you can specify an additional set of extra attributes on each axis.</p>
<p>Lets suppose that a Springfield motor controller can do close loop on hardware.
We could define an extra motor attribute on each axis that (de)actives close
loop on demand.</p>
<p>The first thing to do is to specify which are the extra attributes.
This is done through the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.axis_attributes" title="sardana.pool.controller.Controller.axis_attributes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">axis_attributes</span></code></a>.
This is basically a dictionary where the keys are attribute names and the value
is a dictionary describing the folowing properties for each attribute:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 5%" />
<col style="width: 25%" />
<col style="width: 31%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>config. parameter</p></th>
<th class="head"><p>Mandatory</p></th>
<th class="head"><p>Key</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>data type &amp; format</p></td>
<td><p>Yes</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Type" title="sardana.pool.controller.Type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Type</span></code></a></p></td>
<td><p>—</p></td>
<td><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>data access</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Access" title="sardana.pool.controller.Access"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Access</span></code></a></p></td>
<td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadWrite</span></code></p></td>
<td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadOnly</span></code></p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Description" title="sardana.pool.controller.Description"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Description</span></code></a></p></td>
<td><p>“” (empty string)</p></td>
<td><p>“the motor encoder source”</p></td>
</tr>
<tr class="row-odd"><td><p>default value</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.DefaultValue" title="sardana.pool.controller.DefaultValue"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DefaultValue</span></code></a></p></td>
<td><p>—</p></td>
<td><p>12345</p></td>
</tr>
<tr class="row-even"><td><p>getter method name</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.FGet" title="sardana.pool.controller.FGet"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FGet</span></code></a></p></td>
<td><p>“get” + &lt;name&gt;</p></td>
<td><p>“getEncoderSource”</p></td>
</tr>
<tr class="row-odd"><td><p>setter method name</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.FSet" title="sardana.pool.controller.FSet"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FSet</span></code></a></p></td>
<td><p>“set” + &lt;name&gt;</p></td>
<td><p>“setEncoderSource”</p></td>
</tr>
<tr class="row-even"><td><p>memorize value</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Memorize" title="sardana.pool.controller.Memorize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Memorize</span></code></a></p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Memorized" title="sardana.pool.controller.Memorized"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Memorized</span></code></a></p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.NotMemorized" title="sardana.pool.controller.NotMemorized"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NotMemorized</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>max dimension size</p></td>
<td><p>No</p></td>
<td><p><a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.MaxDimSize" title="sardana.pool.controller.MaxDimSize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MaxDimSize</span></code></a></p></td>
<td><p>Scalar: <code class="docutils literal notranslate"><span class="pre">()</span></code>; 1D: <code class="docutils literal notranslate"><span class="pre">(2048,)</span></code>; 2D: <code class="docutils literal notranslate"><span class="pre">(2048,</span> <span class="pre">2048)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(2048,)</span></code></p></td>
</tr>
</tbody>
</table>
<p>Here is an example of how to specify the scalar, boolean, read-write <em>CloseLoop</em>
extra attribute in a Springfield motor controller:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sardana</span> <span class="kn">import</span> <span class="n">DataAccess</span>
<span class="kn">from</span> <span class="nn">sardana.pool.controller</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Description</span><span class="p">,</span> <span class="n">DefaultValue</span><span class="p">,</span> <span class="n">Access</span><span class="p">,</span> <span class="n">FGet</span><span class="p">,</span> <span class="n">FSet</span>

<span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

<span class="hll">    <span class="n">axis_attributes</span> <span class="o">=</span> <span class="p">{</span>
</span>        <span class="s2">&quot;CloseLoop&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="n">Type</span>         <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                <span class="n">Description</span>  <span class="p">:</span> <span class="s2">&quot;(de)activates the motor close loop algorithm&quot;</span><span class="p">,</span>
                <span class="n">DefaultValue</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="p">},</span>
    <span class="p">}</span>

<span class="hll">    <span class="k">def</span> <span class="nf">getCloseLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">isCloseLoopActive</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

<span class="hll">    <span class="k">def</span> <span class="nf">setCloseLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">setCloseLoop</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>When sardana needs to read the close loop value, it will first check if the
controller has the method specified by the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.FGet" title="sardana.pool.controller.FGet"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FGet</span></code></a>
keyword (we didn’t specify it in
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.axis_attributes" title="sardana.pool.controller.Controller.axis_attributes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">axis_attributes</span></code></a> so it defaults to
<em>getCloseLoop</em>). It will then call this controller method which
should return a value compatible with the attribute data type.</p>
<p>As an alternative, to avoid filling the controller code with pairs of get/set
methods, you can choose not to write the getCloseLoop and setCloseLoop methods.
This will trigger sardana to call the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.GetAxisExtraPar" title="sardana.pool.controller.Controller.GetAxisExtraPar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetAxisExtraPar()</span></code></a>
/<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.SetAxisExtraPar" title="sardana.pool.controller.Controller.SetAxisExtraPar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SetAxisExtraPar()</span></code></a> pair of methods.
The disadvantage is you will end up with a forest of <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#if" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">if</span></code></a> …
<a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#elif" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">elif</span></code></a> … <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#else" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">else</span></code></a> statements. Here is the alternative
implementation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sardana</span> <span class="kn">import</span> <span class="n">DataAccess</span>
<span class="kn">from</span> <span class="nn">sardana.pool.controller</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Description</span><span class="p">,</span> <span class="n">DefaultValue</span><span class="p">,</span> <span class="n">Access</span><span class="p">,</span> <span class="n">FGet</span><span class="p">,</span> <span class="n">FSet</span>

<span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

<span class="hll">    <span class="n">axis_attributes</span> <span class="o">=</span> <span class="p">{</span>
</span>        <span class="s2">&quot;CloseLoop&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="n">Type</span>         <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                <span class="n">Description</span>  <span class="p">:</span> <span class="s2">&quot;(de)activates the motor close loop algorithm&quot;</span><span class="p">,</span>
                <span class="n">DefaultValue</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="p">},</span>
    <span class="p">}</span>

<span class="hll">    <span class="k">def</span> <span class="nf">GetAxisExtraPar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
</span>        <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="s1">&#39;CloseLoop&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">isCloseLoopActive</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

<span class="hll">    <span class="k">def</span> <span class="nf">SetAxisExtraPar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span>        <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="s1">&#39;CloseLoop&#39;</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">setCloseLoop</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Sardana gives you the choice: we leave it up to you to decide which is the
better option for your specific case.</p>
</div>
<div class="section" id="extra-controller-attributes">
<span id="sardana-controller-howto-controller-attributes"></span><h3>Extra controller attributes<a class="headerlink" href="#extra-controller-attributes" title="Permalink to this headline">¶</a></h3>
<p>Besides extra attributes per axis, you can also define extra attributes at the
controller level.
In order to do that you have to specify the extra controller attribute(s) within
the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.ctrl_attributes" title="sardana.pool.controller.Controller.ctrl_attributes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ctrl_attributes</span></code></a> member. The
syntax for this dictionary is the same as the one used for
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.axis_attributes" title="sardana.pool.controller.Controller.axis_attributes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">axis_attributes</span></code></a>.</p>
<p>Here is an example on how to specify a read-only float matrix attribute called
<em>ReflectionMatrix</em> at the controller level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

    <span class="n">ctrl_attributes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ReflectionMatrix&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="n">Type</span>         <span class="p">:</span> <span class="p">(</span> <span class="p">(</span><span class="nb">float</span><span class="p">,),</span> <span class="p">),</span>
                <span class="n">Description</span>  <span class="p">:</span> <span class="s2">&quot;The reflection matrix&quot;</span><span class="p">,</span>
                <span class="n">Access</span> <span class="p">:</span> <span class="n">DataAccess</span><span class="o">.</span><span class="n">ReadOnly</span><span class="p">,</span>
            <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">getReflectionMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>Or, similar to what you can do with axis attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

    <span class="n">ctrl_attributes</span> <span class="o">=</span> \
    <span class="p">{</span>
        <span class="s2">&quot;ReflectionMatrix&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="n">Type</span>         <span class="p">:</span> <span class="p">(</span> <span class="p">(</span><span class="nb">float</span><span class="p">,),</span> <span class="p">),</span>
                <span class="n">Description</span>  <span class="p">:</span> <span class="s2">&quot;The reflection matrix&quot;</span><span class="p">,</span>
                <span class="n">Access</span> <span class="p">:</span> <span class="n">DataAccess</span><span class="o">.</span><span class="n">ReadOnly</span><span class="p">,</span>
            <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">GetCtrlPar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ReflectionMatrix&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="extra-controller-properties">
<span id="sardana-controller-howto-controller-properties"></span><h3>Extra controller properties<a class="headerlink" href="#extra-controller-properties" title="Permalink to this headline">¶</a></h3>
<p>A more static form of attributes can be defined at the controller level.
These <em>properties</em> are loaded into the controller at the time of object
construction. They are accessible to your controller at any time but it is
not possible for a user from outside to modify them.
The way to define <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.ctrl_properties" title="sardana.pool.controller.Controller.ctrl_properties"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ctrl_properties</span></code></a> is
very similar to the way you define extra axis attributes or extra controller
attributes.</p>
<p>Here is an example on how to specify a host and port properties:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldMotorController</span><span class="p">(</span><span class="n">MotorController</span><span class="p">):</span>

    <span class="n">ctrl_properties</span> <span class="o">=</span> \
    <span class="p">{</span>
        <span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="n">Type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">Description</span> <span class="p">:</span> <span class="s2">&quot;host name&quot;</span>
            <span class="p">},</span>
        <span class="s2">&quot;port&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="n">Type</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">Description</span> <span class="p">:</span> <span class="s2">&quot;port number&quot;</span><span class="p">,</span>
                <span class="n">DefaultValue</span><span class="p">:</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">SpringfieldMotorHW</span><span class="o">.</span><span class="n">DefaultPort</span>
           <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SpringfieldMotorController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>

        <span class="c1"># initialize hardware communication</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span> <span class="o">=</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">SpringfieldMotorHW</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>

        <span class="c1"># do some initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>As you can see from lines 15 and 16, to access your controller properties
simply use <code class="docutils literal notranslate"><span class="pre">self.&lt;property</span> <span class="pre">name&gt;</span></code>. Sardana assures that every property has a
value. In our case, when a SpringfieldMotorController is created, if port
property is not specified by the user (example: using the <code class="docutils literal notranslate"><span class="pre">defctrl</span></code> macro in
spock), sardana assignes the default value
<code class="docutils literal notranslate"><span class="pre">springfieldlib.SpringfieldMotorHW.DefaultPort</span></code>. On the other hand, since host
has no default value, if it is not specified by the user, sardana will complain
and fail to create and instance of SpringfieldMotorController.</p>
</div>
<div class="section" id="changing-default-interface">
<span id="sardana-controller-howto-change-default-interface"></span><h3>Changing default interface<a class="headerlink" href="#changing-default-interface" title="Permalink to this headline">¶</a></h3>
<p>Elements instantiated from your controller will have a default interface
corresponding to the controller’s type. For example a moveable will have a
<em>position</em> attribute or an experimental channel will have a <em>value</em>
attribute. However this default interface can be changed if necessary.</p>
<p>For example, the default type of a moveable’s <em>position</em> attribute <code class="docutils literal notranslate"><span class="pre">float</span></code>
can be changed to <code class="docutils literal notranslate"><span class="pre">long</span></code> if the given axis only allows discrete positions.
To do that simple override the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.GetAxisAttributes" title="sardana.pool.controller.Controller.GetAxisAttributes"><code class="xref py py-class docutils literal notranslate"><span class="pre">GetAxisAttributes</span></code></a> where you can
apply the necessary changes.</p>
<p>Here is an example of how to change motor’s <em>position</em> attribute to <code class="docutils literal notranslate"><span class="pre">long</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">GetAxisAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="n">axis_attrs</span> <span class="o">=</span> <span class="n">MotorController</span><span class="o">.</span><span class="n">GetAxisAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="n">axis_attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">axis_attrs</span><span class="p">)</span>
    <span class="n">axis_attrs</span><span class="p">[</span><span class="s1">&#39;Position&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="k">return</span> <span class="n">axis_attrs</span>
</pre></div>
</div>
</div>
<div class="section" id="error-handling">
<span id="sardana-controller-howto-error-handling"></span><h3>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>When you write a controller it is important to properly handle errors
(example: motor power overload, hit a limit switch, lost of communication with
the hardware).</p>
<p>These are the two basic sardana rules you should have in mind:</p>
<ol class="arabic simple">
<li><p>The exceptions which are not handled by the controller are handled by sardana,
usually by re-raising the exception (when sardana runs as a <a class="reference external" href="http://www.tango-controls.org/">Tango</a> DS a
translation is done from the <a class="reference external" href="http://www.python.org/">Python</a> exception to a <a class="reference external" href="http://www.tango-controls.org/">Tango</a> exception).
The <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a> method is handled a
little differently: the state is set to <code class="docutils literal notranslate"><span class="pre">Fault</span></code> and the status will contain
the exception information.</p></li>
<li><p>When the methods which are supposed to return a value (like
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.GetAxisPar" title="sardana.pool.controller.Controller.GetAxisPar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GetAxisPar()</span></code></a>) don’t return a value
compatible with the expected data type (including <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>) a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.9)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> exception is thrown.</p></li>
</ol>
<p>In every method you should carefully choose how to do handle the possible
exceptions/errors.</p>
<p>Usually, catch and handle is the best technique since it is the code of your
controller which knows exactly the workings of the hardware. You can
discriminate errors and decide a proper handle for each. Essencially, this
technique consists of:</p>
<ol class="arabic simple">
<li><p>catching the error (if an exception: with <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> … <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a>
clause, if an expected return of a function: with a <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#if" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">if</span></code></a> …
<a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#elif" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">elif</span></code></a> … <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#else" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">else</span></code></a> statement, etc)</p></li>
<li><p>raise a proper exception (could be the same exception that has been catched)
or, if in <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a>, return the
apropriate error state (<code class="docutils literal notranslate"><span class="pre">Fault</span></code>, <code class="docutils literal notranslate"><span class="pre">Alarm</span></code>) and a descriptive status.</p></li>
</ol>
<p>Here is an example: if the documentation of the underlying library says that:</p>
<blockquote>
<div><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">reading</span> <span class="pre">the</span> <span class="pre">motor</span> <span class="pre">closeloop</span> <span class="pre">raises</span> <span class="pre">CommunicationFailed</span> <span class="pre">if</span> <span class="pre">it</span> <span class="pre">is</span> <span class="pre">not</span>
<span class="pre">possible</span> <span class="pre">to</span> <span class="pre">communicate</span> <span class="pre">with</span> <span class="pre">the</span> <span class="pre">Springfield</span> <span class="pre">hardware</span></code></p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">reading</span> <span class="pre">the</span> <span class="pre">motor</span> <span class="pre">state</span> <span class="pre">raises</span> <span class="pre">MotorPowerOverload</span> <span class="pre">if</span> <span class="pre">the</span> <span class="pre">motors</span>
<span class="pre">has</span> <span class="pre">a</span> <span class="pre">power</span> <span class="pre">overload</span> <span class="pre">or</span> <span class="pre">a</span> <span class="pre">MotorTempTooHigh</span> <span class="pre">when</span> <span class="pre">the</span> <span class="pre">motor</span>
<span class="pre">temperature</span> <span class="pre">is</span> <span class="pre">too</span> <span class="pre">high</span></code></p>
</div></blockquote>
<p>then you should handle the exception in the controller and return a proper
state information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getCloseLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="c1"># Here the &quot;proper exception&quot; to raise in case of error is actually the</span>
    <span class="c1"># one that is raised from the springfield library so handling the</span>
    <span class="c1"># exception is transparent. Nice!</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">isCloseLoopActive</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">StateOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="n">springfield</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StateMap</span><span class="p">[</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getStatus</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">MotorPowerOverload</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Fault</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Motor has a power overload&quot;</span>
    <span class="k">except</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">MotorTempTooHigh</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getTemperature</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Alarm</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Motor temperature is too high (</span><span class="si">%f</span><span class="s2"> degrees)&quot;</span> <span class="o">%</span> <span class="n">temp</span>

    <span class="n">limit_switches</span> <span class="o">=</span> <span class="n">MotorController</span><span class="o">.</span><span class="n">NoLimitSwitch</span>
    <span class="n">hw_limit_switches</span> <span class="o">=</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getLimits</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hw_limit_switches</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">limit_switches</span> <span class="o">|=</span> <span class="n">MotorController</span><span class="o">.</span><span class="n">HomeLimitSwitch</span>
    <span class="k">if</span> <span class="n">hw_limit_switches</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">limit_switches</span> <span class="o">|=</span> <span class="n">MotorController</span><span class="o">.</span><span class="n">UpperLimitSwitch</span>
    <span class="k">if</span> <span class="n">hw_limit_switches</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">limit_switches</span> <span class="o">|=</span> <span class="n">MotorController</span><span class="o">.</span><span class="n">LowerLimitSwitch</span>
    <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">limit_switches</span>
</pre></div>
</div>
<p>Hiding the exception is usually a <strong>BAD</strong> technique since it prevents the user
from finding what was the cause of the problem. You should only use it in
extreme cases (example: if there is a bug in sardana which crashes the server
if you try to properly raise an exception, then you can <strong>temporarely</strong> use
this technique until the bug is solved).</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getCloseLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="c1"># BAD error handling technique</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">isCloseLoopActive</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-tango-from-your-controllers">
<span id="sardana-controller-accessing-tango"></span><h3>Accessing Tango from your controllers<a class="headerlink" href="#accessing-tango-from-your-controllers" title="Permalink to this headline">¶</a></h3>
<p>It is a very common pattern that when integrating a new hardware (or
eventually a software component) in Sardana you start from a Tango Device
Server (either already existing one or you develop one as an intermediate
layer). In this case your controller will need to access Tango and there are
two ways of doing that, either with <a class="reference external" href="http://packages.python.org/taurus/">Taurus</a> (using <code class="xref py py-obj docutils literal notranslate"><span class="pre">taurus.Device</span></code>) or
with <a class="reference external" href="http://packages.python.org/PyTango/">PyTango</a> (using <a class="reference external" href="https://pytango.readthedocs.io/en/stable/client_api/device_proxy.html#tango.DeviceProxy" title="(in PyTango v9.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tango.DeviceProxy</span></code></a>). Please consult a similar discussion
<a class="reference internal" href="../howto_macros/macros_general.html#sardana-macro-accessing-tango"><span class="std std-ref">Accessing Tango from your macros</span></a> on which one to use.</p>
<p>For accessing Sardana elements e.g.: motors, experimental channels, etc.
currently there is no Sardana <a class="reference internal" href="../../glossary.html#term-API"><span class="xref std std-term">API</span></a> and you will need to use one of the
above methods.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a very simplified integration of Tango devices in Sardana you may
consider using
<a class="reference external" href="https://github.com/ALBA-Synchrotron/sardana-tango">sardana-tango controllers</a>.</p>
</div>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Pseudo controllers don’t need to manage their individual axis. Therefore,
for pseudos you will not implement these methods</p>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>For pseudo controllers, sardana will calculate the state of each pseudo
axis based on the state of the elements that serve as input to the
pseudo controller. Therefore, for pseudos you will not implement these
methods</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="howto_motorcontroller.html" class="btn btn-neutral float-right" title="How to write a motor controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Writing controllers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>