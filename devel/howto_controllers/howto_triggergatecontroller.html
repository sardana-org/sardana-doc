

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to write a trigger/gate controller &mdash; sardana 3.0.4-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to write an I/O register controller" href="howto_ioregistercontroller.html" />
    <link rel="prev" title="How to write a 2D controller" href="howto_2dcontroller.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">User’s Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_macros/index.html">Writing macros</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Writing controllers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="howto_controller.html">What is a controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_motorcontroller.html">How to write a motor controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_countertimercontroller.html">How to write a counter/timer controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_0dcontroller.html">How to write a 0D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_1dcontroller.html">How to write a 1D controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_2dcontroller.html">How to write a 2D controller</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">How to write a trigger/gate controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_ioregistercontroller.html">How to write an I/O register controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_pseudomotorcontroller.html">How to write a pseudo motor controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto_pseudocountercontroller.html">How to write a pseudo counter controller</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howto_recorders.html">Writing recorders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howto_test/index.html">Sardana Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/api_sardana.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_migration/index.html">Migration guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide_coding.html">Development guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sardana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">Writing controllers</a> &raquo;</li>
        
      <li>How to write a trigger/gate controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/devel/howto_controllers/howto_triggergatecontroller.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-write-a-trigger-gate-controller">
<span id="sardana-triggergatecontroller-howto-basics"></span><h1>How to write a trigger/gate controller<a class="headerlink" href="#how-to-write-a-trigger-gate-controller" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-basics">
<h2>The basics<a class="headerlink" href="#the-basics" title="Permalink to this headline">¶</a></h2>
<p>An example of a hypothetical <em>Springfield</em> trigger/gate controller will be build
incrementally from scratch to aid in the explanation.</p>
<p>By now you should have read <a class="reference internal" href="../api/api_controller.html#sardana-controller-api"><span class="std std-ref">the general controller basics</span></a> chapter. You should
be able to create a TriggerGateController with:</p>
<ul class="simple">
<li><p>a proper constructor</p></li>
<li><p>add and delete axis methods</p></li>
<li><p>get axis state</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">springfieldlib</span>

<span class="kn">from</span> <span class="nn">sardana.pool.controller</span> <span class="kn">import</span> <span class="n">TriggerGateController</span>

<span class="k">class</span> <span class="nc">SpringfieldTriggerGateController</span><span class="p">(</span><span class="n">TriggerGateController</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SpringfieldTriggerGateController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># initialize hardware communication</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span> <span class="o">=</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">SpringfieldTriggerHW</span><span class="p">()</span>

        <span class="c1"># do some initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_triggers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">AddDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_triggers</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">DeleteDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_triggers</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>

    <span class="n">StateMap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">1</span> <span class="p">:</span> <span class="n">State</span><span class="o">.</span><span class="n">On</span><span class="p">,</span>
        <span class="mi">2</span> <span class="p">:</span> <span class="n">State</span><span class="o">.</span><span class="n">Moving</span><span class="p">,</span>
        <span class="mi">3</span> <span class="p">:</span> <span class="n">State</span><span class="o">.</span><span class="n">Fault</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">StateOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">springfield</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StateMap</span><span class="p">[</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getStatus</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">status</span>
</pre></div>
</div>
<p>The examples use a <code class="xref py py-mod docutils literal notranslate"><span class="pre">springfieldlib</span></code> module which emulates a trigger/gate
hardware access library.</p>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">springfieldlib</span></code> can be downloaded from
<a class="reference download internal" download="" href="../../_downloads/48cc05f28f359e8a865124c6a58f2f5c/springfieldlib.py"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<p>The Springfield trigger/gate controller can be downloaded from
<a class="reference download internal" download="" href="../../_downloads/dc74ab79a455b385a298800bbfd4528e/sf_tg_ctrl.py"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<p>The following code describes a minimal <em>Springfield</em> base trigger/gate controller
which is able to return the state of an individual trigger as well as to start
a synchronization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldBaseTriggerGateController</span><span class="p">(</span><span class="n">TriggerGateController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The most basic controller intended from demonstration purposes only.</span>
<span class="sd">    This is the absolute minimum you have to implement to set a proper trigger</span>
<span class="sd">    controller able to get a trigger value, get a trigger state and do an</span>
<span class="sd">    acquisition.</span>

<span class="sd">    This example is so basic that it is not even directly described in the</span>
<span class="sd">    documentation&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SpringfieldBaseTriggerGateController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">inst</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span> <span class="o">=</span> <span class="n">springfieldlib</span><span class="o">.</span><span class="n">SpringfieldTriggerHW</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">StateOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the specified trigger state&quot;&quot;&quot;</span>
        <span class="n">springfield</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">springfield</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">State</span><span class="o">.</span><span class="n">On</span><span class="p">,</span> <span class="s2">&quot;Trigger is stopped&quot;</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">State</span><span class="o">.</span><span class="n">Moving</span><span class="p">,</span> <span class="s2">&quot;Trigger is running&quot;</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">State</span><span class="o">.</span><span class="n">Fault</span><span class="p">,</span> <span class="s2">&quot;Trigger has an error&quot;</span>

    <span class="k">def</span> <span class="nf">StartOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;acquire the specified trigger&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">StartChannel</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">SynchOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">synchronization</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">SynchChannel</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">synchronization</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">StopOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop the specified trigger&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="get-trigger-state">
<span id="sardana-triggergatecontroller-howto-state"></span><h3>Get trigger state<a class="headerlink" href="#get-trigger-state" title="Permalink to this headline">¶</a></h3>
<p>To get the state of a trigger, sardana calls the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a> method. This method
receives an axis as parameter and should return either:</p>
<blockquote>
<div><ul class="simple">
<li><p>state (<a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a>) or</p></li>
<li><dl class="simple">
<dt>a sequence of two elements:</dt><dd><ul>
<li><p>state (<a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a>)</p></li>
<li><p>status (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>The state should be a member of <a class="reference internal" href="../api/sardana/sardanadefs.html#sardana.sardanadefs.State" title="sardana.sardanadefs.State"><code class="xref py py-obj docutils literal notranslate"><span class="pre">State</span></code></a> (For backward
compatibility reasons, it is also supported to return one of
<code class="xref py py-class docutils literal notranslate"><span class="pre">PyTango.DevState</span></code>). The status could be any string.</p>
</div>
<div class="section" id="prepare-for-measurement">
<span id="sardana-triggergatecontroller-howto-prepare"></span><h3>Prepare for measurement<a class="headerlink" href="#prepare-for-measurement" title="Permalink to this headline">¶</a></h3>
<p>To prepare a trigger for a measurement you can use the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.TriggerGateController.PrepareOne" title="sardana.pool.controller.TriggerGateController.PrepareOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PrepareOne()</span></code></a> method which
receives as an argument the number of starts of the whole measurement.
This information may be used to prepare the hardware for generating
multiple events (triggers or gates) in a complex measurement
e.g. <a class="reference internal" href="../howto_macros/scan_framework.html#sardana-macros-scanframework-determscan"><span class="std std-ref">Deterministic scans</span></a>.</p>
</div>
<div class="section" id="load-synchronization-description">
<span id="sardana-triggergatecontroller-howto-load"></span><h3>Load synchronization description<a class="headerlink" href="#load-synchronization-description" title="Permalink to this headline">¶</a></h3>
<p>To load a trigger with the synchronization description
sardana calls the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Synchronizer.SynchOne" title="sardana.pool.controller.Synchronizer.SynchOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SynchOne()</span></code></a> method.
This method receives axis and synchronization parameters.</p>
<p>Here is an example of the possible implementation of
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Synchronizer.SynchOne" title="sardana.pool.controller.Synchronizer.SynchOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SynchOne()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldTriggerGateController</span><span class="p">(</span><span class="n">TriggerGateController</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="nf">SynchOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">synchronization</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">SynchChannel</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">synchronization</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="synchronization-description">
<span id="sardana-triggergatecontroller-howto-synchronization"></span><h4>Synchronization description<a class="headerlink" href="#synchronization-description" title="Permalink to this headline">¶</a></h4>
<p>Synchronization is a data structure following a special convention. It is
composed from the groups of equidistant intervals described by: the initial
point and delay, total and active intervals and the number of repetitions.
These information can be expressed in different synchronization domains if
necessary: time and/or position.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/synchronization_description.png"><img alt="../../_images/synchronization_description.png" src="../../_images/synchronization_description.png" style="width: 680px;" /></a>
<p class="caption"><span class="caption-text">This sketch depicts parameters describing a group.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Sardana defines two enumeration classes to help in manipulations of the
synchronization description. The <a class="reference internal" href="../api/sardana/pool/pooldefs.html#sardana.pool.pooldefs.SynchParam" title="sardana.pool.pooldefs.SynchParam"><code class="xref py py-class docutils literal notranslate"><span class="pre">SynchParam</span></code></a> defines the
parameters used to describe a group. The <a class="reference internal" href="../api/sardana/pool/pooldefs.html#sardana.pool.pooldefs.SynchDomain" title="sardana.pool.pooldefs.SynchDomain"><code class="xref py py-class docutils literal notranslate"><span class="pre">SynchDomain</span></code></a>
defines the possible domains in which a parameter may be expressed.</p>
<p>The following code demonstrates creation of a synchronization description
expressed in time and position domains (moveable’s velocity = 10 units/second
and acceleration time = 0.1 second). It will generate 10 synchronization pulses
of length 0.1 second equally spaced on a distance of 100 units.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sardana.pool</span> <span class="kn">import</span> <span class="n">SynchParam</span><span class="p">,</span> <span class="n">SynchDomain</span>

<span class="n">synchronization</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="n">SynchParam</span><span class="o">.</span><span class="n">Delay</span><span class="p">:</span>   <span class="p">{</span><span class="n">SynchDomain</span><span class="o">.</span><span class="n">Time</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">SynchDomain</span><span class="o">.</span><span class="n">Position</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="n">SynchParam</span><span class="o">.</span><span class="n">Initial</span><span class="p">:</span> <span class="p">{</span><span class="n">SynchDomain</span><span class="o">.</span><span class="n">Time</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="n">SynchDomain</span><span class="o">.</span><span class="n">Position</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="n">SynchParam</span><span class="o">.</span><span class="n">Active</span><span class="p">:</span>  <span class="p">{</span><span class="n">SynchDomain</span><span class="o">.</span><span class="n">Time</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">SynchDomain</span><span class="o">.</span><span class="n">Position</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="n">SynchParam</span><span class="o">.</span><span class="n">Total</span><span class="p">:</span>   <span class="p">{</span><span class="n">SynchDomain</span><span class="o">.</span><span class="n">Time</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SynchDomain</span><span class="o">.</span><span class="n">Position</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="n">SynchParam</span><span class="o">.</span><span class="n">Repeats</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="start-a-trigger">
<span id="sardana-triggergatecontroller-howto-start"></span><h3>Start a trigger<a class="headerlink" href="#start-a-trigger" title="Permalink to this headline">¶</a></h3>
<p>When an order comes for sardana to start a trigger, sardana will call the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Startable.StartOne" title="sardana.pool.controller.Startable.StartOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StartOne()</span></code></a> method. This method receives
an axis as parameter. The controller code should trigger the hardware acquisition.</p>
<p>Here is an example of the possible implementation of
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Startable.StartOne" title="sardana.pool.controller.Startable.StartOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StartOne()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldTriggerGateController</span><span class="p">(</span><span class="n">TriggerGateController</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="nf">StartOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">StartChannel</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</pre></div>
</div>
<p>As soon as <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Startable.StartOne" title="sardana.pool.controller.Startable.StartOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StartOne()</span></code></a> is invoked,
sardana expects the trigger to be running. It enters a high frequency
synchronization loop which asks for the trigger state through calls to
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a>. It will keep the loop
running as long as the controller responds with <code class="docutils literal notranslate"><span class="pre">State.Moving</span></code>.
If <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a> raises an exception
or returns something other than <code class="docutils literal notranslate"><span class="pre">State.Moving</span></code>, sardana will assume the trigger
is stopped and exit the synchronization loop.</p>
<p>For an synchronization to work properly, it is therefore, <strong>very important</strong> that
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Controller.StateOne" title="sardana.pool.controller.Controller.StateOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StateOne()</span></code></a> responds correctly.</p>
</div>
<div class="section" id="stop-a-trigger">
<span id="sardana-triggergatecontroller-howto-stop"></span><h3>Stop a trigger<a class="headerlink" href="#stop-a-trigger" title="Permalink to this headline">¶</a></h3>
<p>It is possible to stop a trigger when it is running. When sardana is ordered to
stop a trigger synchronization, it invokes the
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Stopable.StopOne" title="sardana.pool.controller.Stopable.StopOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StopOne()</span></code></a> method. This method receives
an axis parameter. The controller should make sure the desired trigger is
<em>gracefully</em> stopped.</p>
<p>Here is an example of the possible implementation of
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Stopable.StopOne" title="sardana.pool.controller.Stopable.StopOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StopOne()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldTriggerGateController</span><span class="p">(</span><span class="n">TriggerGateController</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="nf">StopOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">StopChannel</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="abort-a-trigger">
<span id="sardana-triggergatecontroller-howto-abort"></span><h3>Abort a trigger<a class="headerlink" href="#abort-a-trigger" title="Permalink to this headline">¶</a></h3>
<p>In an emergency situation, it is desirable to abort a synchronization
<em>as fast as possible</em>. When sardana is ordered to abort a trigger synchronization,
it invokes the <a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Stopable.AbortOne" title="sardana.pool.controller.Stopable.AbortOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AbortOne()</span></code></a>
method. This method receives an axis parameter. The controller should make
sure the desired trigger is stopped as fast as it can be done.</p>
<p>Here is an example of the possible implementation of
<a class="reference internal" href="../api/sardana/pool/controller.html#sardana.pool.controller.Stopable.AbortOne" title="sardana.pool.controller.Stopable.AbortOne"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AbortOne()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpringfieldTriggerGateController</span><span class="p">(</span><span class="n">TriggerGateController</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="nf">AbortOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">springfield</span><span class="o">.</span><span class="n">AbortChannel</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="howto_ioregistercontroller.html" class="btn btn-neutral float-right" title="How to write an I/O register controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="howto_2dcontroller.html" class="btn btn-neutral float-left" title="How to write a 2D controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>