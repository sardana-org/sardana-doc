

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Diffractometer &mdash; sardana 3.1.1-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding real elements" href="adding_elements.html" />
    <link rel="prev" title="Acquisition" href="acquisition.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">User’s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started/index.html">Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="spock.html">Spock</a></li>
<li class="toctree-l3"><a class="reference internal" href="taurus/index.html">Sardana-Taurus Widgets</a></li>
<li class="toctree-l3"><a class="reference internal" href="scan.html">Scans</a></li>
<li class="toctree-l3"><a class="reference internal" href="motion.html">Motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="acquisition.html">Acquisition</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Diffractometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding_elements.html">Adding real elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_hooks.html">Macro Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_environment.html">Macro Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_logging_and_reports.html">Macro Logging and Reports</a></li>
<li class="toctree-l3"><a class="reference internal" href="environment_variable_catalog.html">Environment Variable Catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="standard_macro_catalog.html">Standard macro catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="screenshots.html">Screenshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/sardana-org/sardana/issues?q=is:issue+is:open+label:doc:knownbug">Known Problems</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devel/index.html">Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../news.html">What's new?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sardana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../docs.html">Sardana 3.1 Documentation</a> &raquo;</li>
        
          <li><a href="index.html">User’s Guide</a> &raquo;</li>
        
      <li>Diffractometer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/users/diffractometer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="diffractometer">
<span id="sardana-diffractometer"></span><h1>Diffractometer<a class="headerlink" href="#diffractometer" title="Permalink to this headline">¶</a></h1>
<p>Sardana implements a full control of different types of diffractometers.
The implementation is completely done inside a controller of the type
PseudoMotor. It requires the hkl library developed by Frederic Picca and
available as Debian package
(<a class="reference external" href="https://packages.debian.org/source/sid/science/hkl">https://packages.debian.org/source/sid/science/hkl</a>). The use of the library
is exclusively done inside of the controller code, so the hkl binding is only
required if a diffractometer controller is going to be created.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use the HklPseudoMotorController you need to install the following Debian
packages: <code class="docutils literal notranslate"><span class="pre">libhkl5</span></code> and <code class="docutils literal notranslate"><span class="pre">gir1.2-hkl-5.0</span></code>.</p>
</div>
<p>The Tango device created inside of the Pool for the diffractometer
controller contains all the commands/attributes for setting the diffractometer,
the movements are done using the real (in real space) and the pseudo (in
reciprocal space) motor devices associated with this controller.</p>
<p>The diffractometer Sardana controller library is called HklPseudoMotorController.
It contains several controller classes depending on the number of real and pseudo
motors needed for each kind of diffractometer. All of them are based on a basic
diffractometer class where the real implementation is done.
Each class cover several diffractometer geometries. A class
property, DiffractometerType, is created for setting the corresponding geometry.
The class properties appear as Tango Device Properties of the device corresponding
to this controller in the Pool. The value of the class properties has to be
assigned when the instance of the diffractometer controller is generated in the Pool.
It is fixed for each diffractometer controller, it can not be changed during
running time.</p>
<p>Up to now the following diffractometer classes are implemented:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Diffrac6C</span> <span class="p">(</span><span class="n">possible</span> <span class="n">DiffractometerType</span> <span class="n">values</span><span class="p">:</span> <span class="s2">&quot;PETRA3 P09 EH2&quot;</span><span class="p">)</span>
<span class="o">-</span> <span class="n">motor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span>
<span class="o">-</span> <span class="n">pseudomotor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span>

<span class="n">DiffracE6C</span> <span class="p">(</span><span class="n">possible</span> <span class="n">DiffractometerType</span> <span class="n">values</span><span class="p">:</span> <span class="s2">&quot;E6C&quot;</span><span class="p">,</span> <span class="s2">&quot;SOLEIL SIXS MED2+2&quot;</span><span class="p">)</span>
<span class="o">-</span> <span class="n">motor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">delta</span>
<span class="o">-</span> <span class="n">pseudomotor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">qper</span><span class="p">,</span> <span class="n">qpar</span>

 <span class="n">DiffracE4C</span> <span class="p">(</span><span class="n">possible</span> <span class="n">DiffractometerType</span> <span class="n">values</span><span class="p">:</span> <span class="s2">&quot;E4CV&quot;</span><span class="p">,</span> <span class="s2">&quot;E4CH&quot;</span><span class="p">,</span> <span class="s2">&quot;SOLEIL MARS&quot;</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">motor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">omega</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">tth</span>
 <span class="o">-</span> <span class="n">pseudomotor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">q</span>

 <span class="n">Diffrac4Cp23</span> <span class="p">(</span><span class="n">possible</span> <span class="n">DiffractometerType</span> <span class="n">values</span><span class="p">:</span> <span class="s2">&quot;PETRA3 P23 4C&quot;</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">motor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">omega_t</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">delta</span>
 <span class="o">-</span> <span class="n">pseudomotor</span> <span class="n">roles</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">qper</span><span class="p">,</span> <span class="n">qpar</span><span class="p">,</span> <span class="n">tth2</span><span class="p">,</span> <span class="n">alpha_tth2</span><span class="p">,</span>
   <span class="n">incidence</span><span class="p">,</span> <span class="n">emergence</span>
</pre></div>
</div>
<p>In order to have the diffractometer in Sardana one has to create a PseudoMotor
controller of any of the above classes, this will generate the controller
device, for setting the diffractometer, and the pseudo motor devices, for
the reciprocal space movements. The real motors have to be included as motors
in Sardana, like the motors associated to any other PseudoMotor.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">defctrl</span> <span class="n">DiffracE6C</span> <span class="n">e6cctrl</span> <span class="n">mu</span><span class="o">=</span><span class="n">mot01</span> <span class="n">omega</span><span class="o">=</span><span class="n">mot02</span> <span class="n">chi</span><span class="o">=</span><span class="n">mot03</span> <span class="n">phi</span><span class="o">=</span><span class="n">mot04</span> \
  <span class="n">gamma</span><span class="o">=</span><span class="n">mot05</span> <span class="n">delta</span><span class="o">=</span><span class="n">mot06</span> <span class="n">h</span><span class="o">=</span><span class="n">e6ch</span> <span class="n">k</span><span class="o">=</span><span class="n">e6ck</span> <span class="n">l</span><span class="o">=</span><span class="n">e6cl</span> <span class="n">psi</span><span class="o">=</span><span class="n">e6cpsi</span> <span class="n">q</span><span class="o">=</span><span class="n">e6cq</span> \
  <span class="n">alpha</span><span class="o">=</span><span class="n">e6calpha</span> <span class="n">qper</span><span class="o">=</span><span class="n">e6cqper1</span> <span class="n">qpar</span><span class="o">=</span><span class="n">e6cqpar</span> <span class="n">DiffractometerType</span> <span class="n">E6C</span>
</pre></div>
</div>
<p>The command above creates the devices corresponding to a diffractometer with E6C
geometry, where <code class="docutils literal notranslate"><span class="pre">motXX</span></code> are the names of the Pool devices
associated to each real motor (already existing Motors in Sardana),
<code class="docutils literal notranslate"><span class="pre">e6cctrl</span></code> is an arbitrary name given to the controller,
and <code class="docutils literal notranslate"><span class="pre">e6ch</span></code>, <code class="docutils literal notranslate"><span class="pre">e6ck</span></code> , <code class="docutils literal notranslate"><span class="pre">e6cl</span></code>, <code class="docutils literal notranslate"><span class="pre">e6cpsi</span></code>, <code class="docutils literal notranslate"><span class="pre">e6cq</span></code>, <code class="docutils literal notranslate"><span class="pre">e6calpha</span></code>, <code class="docutils literal notranslate"><span class="pre">e6cqper1</span></code>
and <code class="docutils literal notranslate"><span class="pre">e6cqpar</span></code> are the arbitrary names given to the motors in reciprocal space
(PseudoMotors in Sardana, created by this call).</p>
<p>The diffractometer controller device contains as attributes (since it is not
possible add extra commands to the controllers) all the commands and settings for
the diffractometer control. The hkl library needs the parameters to be set in
a given order for being inizialized correctly, for that reason the attribute
values are not stored in the tango database. The best practise is to save the
parameters in a file and load it when startup. Example of a startup file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Created</span> <span class="n">at</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">28</span> <span class="mi">01</span><span class="p">:</span><span class="mi">50</span>

<span class="n">DiffractometerType</span> <span class="n">E6C</span>

<span class="n">Crystal</span>    <span class="n">srru2o6</span>

<span class="n">Wavelength</span> <span class="mf">4.36871881607</span>

<span class="n">A</span> <span class="mf">5.97947283834</span> <span class="n">B</span> <span class="mf">5.97062576634</span> <span class="n">C</span> <span class="mf">17.0006259383</span>
<span class="n">Alpha</span> <span class="mf">90.0</span> <span class="n">Beta</span> <span class="mf">90.0</span> <span class="n">Gamma</span> <span class="mf">120.0</span>

<span class="n">R0</span> <span class="mi">0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">3.0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mf">0.0</span> <span class="mf">23.983725</span> <span class="mf">109.768125</span> <span class="mf">286.38645</span> <span class="o">-</span><span class="mf">1.52587888991e-08</span> <span class="mf">45.344725</span>
<span class="n">R1</span> <span class="mi">1</span> <span class="mf">1.0</span> <span class="mf">0.0</span> <span class="mf">4.0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mf">0.0</span> <span class="mf">43.03545</span> <span class="mf">70.0</span> <span class="mf">286.38645</span> <span class="o">-</span><span class="mf">1.52587888991e-08</span> <span class="mf">83.409275</span>

<span class="n">Engine</span> <span class="n">hkl</span>

<span class="n">Mode</span> <span class="n">constant_phi_vertical</span>

<span class="n">PsiRef</span> <span class="ow">not</span> <span class="n">available</span> <span class="ow">in</span> <span class="n">current</span> <span class="n">engine</span> <span class="n">mode</span>

<span class="n">AutoEnergyUpdate</span> <span class="mi">0</span>

<span class="n">U00</span> <span class="o">-</span><span class="mf">1.092</span> <span class="n">U01</span> <span class="o">-</span><span class="mf">0.250</span> <span class="n">U02</span> <span class="mf">0.122</span>
<span class="n">U10</span> <span class="mf">0.410</span> <span class="n">U11</span> <span class="mf">0.180</span> <span class="n">U12</span> <span class="mf">0.348</span>
<span class="n">U20</span> <span class="mf">0.332</span> <span class="n">U21</span> <span class="mf">1.176</span> <span class="n">U22</span> <span class="o">-</span><span class="mf">0.027</span>

<span class="n">Ux</span> <span class="o">-</span><span class="mf">94.4630713237</span> <span class="n">Uy</span> <span class="mf">19.3202405308</span> <span class="n">Uz</span> <span class="o">-</span><span class="mf">162.577336525</span>

<span class="n">SaveDirectory</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">p09user</span><span class="o">/</span><span class="n">crystals</span>
</pre></div>
</div>
<p>The configuration files can be created by the diffractometer controller by
calling the attribute SaveCrystal. They are loaded by the attribute LoadCrystal.
If nothing is loaded the diffractometer will be inizialized with Sample set to
‘default crystal’, lattice, wavelenth and geometry set to the corresponding
hkl library default values (according to the geometry) and engine set to ‘hkl’.</p>
<p>The wavelength used for the diffractometer can be automatically updated setting
the attribute AutoEnergyUpdate to 1 and the name of the Tango Device controlling
the beam energy in the attribute EnergyDevice. The energy is read from the
attribute Position of the EnergyDevice device, in eV, every time motor or
pseudomotor positions are read.</p>
<p>Sardana provides <a class="reference internal" href="standard_macro_catalog.html#sardana-diffractometer-macros"><span class="std std-ref">standard macros for controlling the diffractometer</span></a>.
They need the name of the diffractometer controller device in the Pool to be set
in the macroserver environment variable <a class="reference internal" href="environment_variable_catalog.html#diffracdevice"><span class="std std-ref">DiffracDevice</span></a>.
If the Psi angle (azimuth) will be used, the environment variable Psi has to
be set, with the name corresponding PseudoMotor Pool device.</p>
<p>Running the macro <a class="reference internal" href="../devel/api/sardana/macroserver/macros/demo.html#sardana.macroserver.macros.demo.sar_demo_hkl" title="sardana.macroserver.macros.demo.sar_demo_hkl"><code class="xref py py-class docutils literal notranslate"><span class="pre">sar_demo_hkl</span></code></a> creates
a simulated diffractometer in Sardana.</p>
<p>The diffractometer can be controlled from spock used the implemented dedicated macros,
as described in the <a class="reference internal" href="standard_macro_catalog.html#sardana-standard-macro-catalog"><span class="std std-ref">catalog of macros</span></a>.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="adding_elements.html" class="btn btn-neutral float-right" title="Adding real elements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="acquisition.html" class="btn btn-neutral float-left" title="Acquisition" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>