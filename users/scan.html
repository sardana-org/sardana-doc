

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scans &mdash; sardana 3.0.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="sardana 3.0.2-alpha documentation" href="../index.html"/>
        <link rel="up" title="User’s Guide" href="index.html"/>
        <link rel="next" title="Motion" href="motion.html"/>
        <link rel="prev" title="PoolMotorTV User’s Interface" href="taurus/poolmotortv.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">User&#8217;s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started/index.html">Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="spock.html">Spock</a></li>
<li class="toctree-l3"><a class="reference internal" href="taurus/index.html">Sardana-Taurus Widgets</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Scans</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-scans">Step scans</a></li>
<li class="toctree-l4"><a class="reference internal" href="#continuous-scans">Continuous scans</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scan-snapshots">Scan snapshots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="motion.html">Motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="acquisition.html">Acquisition</a></li>
<li class="toctree-l3"><a class="reference internal" href="diffractometer.html">Diffractometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding_elements.html">Adding real elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_hooks.html">Macro Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_environment.html">Macro Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_logging_and_reports.html">Macro Logging and Reports</a></li>
<li class="toctree-l3"><a class="reference internal" href="environment_variable_catalog.html">Environment Variable Catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="standard_macro_catalog.html">Standard macro catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="screenshots.html">Screenshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/sardana-org/sardana/issues?q=is:issue+is:open+label:doc:knownbug">Known Problems</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devel/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">sardana</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../docs.html">Sardana 3.0 Documentation</a> &raquo;</li>
      
          <li><a href="index.html">User&#8217;s Guide</a> &raquo;</li>
      
    <li>Scans</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/users/scan.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scans">
<span id="sardana-users-scan"></span><h1>Scans<a class="headerlink" href="#scans" title="Permalink to this headline">¶</a></h1>
<p>Perhaps the most used type of macro is the scan macros. In general terms, we
call <em>scan</em> to a macro that moves one or more <a class="reference internal" href="../devel/api/api_motor.html#sardana-motor-api"><span class="std std-ref">motors</span></a>
and acquires data along the path of the motor(s).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sardana provides a <a class="reference internal" href="../devel/howto_macros/scan_framework.html#sardana-macros-scanframework"><span class="std std-ref">Scan Framework</span></a>
for developing scan macros so that the scan macros behave in a consistent way.
Unless otherwise specified, the following discussion applies to scan macros
based on such framework.</p>
</div>
<p>The various scan macros mostly differ in how many motors are moved and the
definition of their paths.</p>
<p>Typically, the selection of which data is going to be acquired depends on the
active <em>measurement group</em> and is <em>not</em> fixed by the macro itself (although
there is no limitation in this sense).</p>
<p>Depending on whether the motors are stopped before acquiring the data or not, we
can classify the scan macros in <em>step</em> scans or <em>continuous</em> scans,
respectively.</p>
<div class="figure align-center" id="id1" style="width: 80%">
<a class="reference internal image-reference" href="../_images/trend_ascanVSascanc.png"><img alt="../_images/trend_ascanVSascanc.png" src="../_images/trend_ascanVSascanc.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text">Trend plot showing a step scan (<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascan" title="sardana.macroserver.macros.scan.ascan"><code class="xref py py-class docutils literal"><span class="pre">ascan</span></code></a> <em>m_cp1_1 0 1000 8 .5</em>)
followed by a continuous scan (<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascanc" title="sardana.macroserver.macros.scan.ascanc"><code class="xref py py-class docutils literal"><span class="pre">ascanc</span></code></a> <em>m_cp1_1 0 1000 .5</em>).
The line corresponds to the motor position and the blue shaded areas
correspond to the intervals in which the data acquisition took place.</span></p>
</div>
<div class="section" id="step-scans">
<span id="sardana-users-scan-step"></span><h2>Step scans<a class="headerlink" href="#step-scans" title="Permalink to this headline">¶</a></h2>
<p>In a step scan, the motors are moved to given points, and once they reach each
point they stop. Then, one or more channels are acquired for a certain amount
of time, and only when the data acquisition is finished, the motors proceed to
the next point.</p>
<p>In this way, the position associated to a data readout is well known and does
not change during the acquisition time.</p>
<p>Some examples of step scan macros are:
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascan" title="sardana.macroserver.macros.scan.ascan"><code class="xref py py-class docutils literal"><span class="pre">ascan</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scan" title="sardana.macroserver.macros.scan.a2scan"><code class="xref py py-class docutils literal"><span class="pre">a2scan</span></code></a>, ...
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.dscan" title="sardana.macroserver.macros.scan.dscan"><code class="xref py py-class docutils literal"><span class="pre">dscan</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.d2scan" title="sardana.macroserver.macros.scan.d2scan"><code class="xref py py-class docutils literal"><span class="pre">d2scan</span></code></a>, ...
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.mesh" title="sardana.macroserver.macros.scan.mesh"><code class="xref py py-class docutils literal"><span class="pre">mesh</span></code></a>.</p>
</div>
<div class="section" id="continuous-scans">
<span id="sardana-users-scan-continuous"></span><h2>Continuous scans<a class="headerlink" href="#continuous-scans" title="Permalink to this headline">¶</a></h2>
<p>In a continuous scan, the motors are not stopped for acquisition, which
therefore takes place while the motors are moving. The most common reason for
using this type of scan is optimizing the acquisition time by not having to
wait for motors to accelerate and decelerate between acquisitions.</p>
<p>The continuous scans introduce some constraints and issues that should be
considered.</p>
<ol class="arabic simple">
<li>If a continuous scan involves moving more than one motor simultaneously
(as it is done, e.g. in <a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scan" title="sardana.macroserver.macros.scan.a2scan"><code class="xref py py-class docutils literal"><span class="pre">a2scan</span></code></a>),
then the movements of the motors should be synchronized so that they all
start their path at the same time and finish it at the same time.</li>
<li>If motors do not maintain a constant velocity along the path of their
movement, the trajectories followed when using more than one motor may not
be linear.</li>
<li>While in step scans it is possible to scan two pseudo-motors that access
the same physical motors (e.g. the <em>gap</em> and <em>offset</em> of a slit, being both
pseudo-motors accessing the same physical motors attached to each blade of
the slit), in a continuous scan the motions cannot be decoupled in a
synchronized way.</li>
<li>Backslash correction is incompatible with continuous scans, so you should
keep in mind that continuous scans should only be done in the backslash-free
direction of the motor (typically, by convention the positive one for a
physical motor).</li>
</ol>
<p>In order to address the first two issues, the
<a class="reference internal" href="../devel/howto_macros/scan_framework.html#sardana-macros-scanframework"><span class="std std-ref">scan framework</span></a> attempts the following:</p>
<ul class="simple">
<li>If the motors support changing their velocity, Sardana will adjust the
velocities of the motors so that they all start and finish the required path
simultaneously. For motors that specify a range of allowed velocities, this
range will be used (for motors that do not specify a maximum allowed
velocity, the current &#8220;top velocity&#8221; will be assumed to be the maximum)</li>
<li>For motors that can maintain a constant velocity after an acceleration phase
(this is the case for most physical motors), Sardana will transparently
extend the user-given path both at the beginning and the end in order to
allow for the motors to move at constant velocity along all the user defined
path (i.e., the motors are allowed time and room to accelerate before
reaching the start of the path and to decelerate after the end of the nominal
path selected by the user)</li>
</ul>
<p>These two actions can be seen in the following plot of the positions of the two
motors involved in a <a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scanc" title="sardana.macroserver.macros.scan.a2scanc"><code class="xref py py-class docutils literal"><span class="pre">a2scanc</span></code></a>.</p>
<div class="figure align-center" id="id2" style="width: 80%">
<a class="reference internal image-reference" href="../_images/trend_a2scanc.png"><img alt="../_images/trend_a2scanc.png" src="../_images/trend_a2scanc.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text">Trend plot showing a two-motor continuous scan
(<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scanc" title="sardana.macroserver.macros.scan.a2scanc"><code class="xref py py-class docutils literal"><span class="pre">a2scanc</span></code></a> <em>m_cp1_1 100 200  m_cp1_2 0 500 .1</em>).
The lines correspond to the motor positions and the blue shaded areas correspond to the intervals in
which the data acquisition took place.</span></p>
</div>
<p>Both motors are capable of same velocity and acceleration, but since the
required scan path for m_cp1_1 is shorter than that for m_cp1_2, its top
velocity has been adjusted (gentler slope for m_cp1_1) so that both motors go
through the user-requested start and stop positions simultaneously.</p>
<p>The same figure also shows how the paths for both motors have been automatically
(and transparently, for the user) extended to guarantee that the user defined
path is followed at constant velocity and that the data acquisition takes place
also while the motors are running at constant velocity.</p>
<p>The synchronization of movement and acquisition can be done via hardware or
via software. Currently Sardana provides two different interfaces for
continuous scans. They can be easily differentiated by the scan name suffix:</p>
<ul class="simple">
<li><em>c</em> - allows only software synchronization</li>
<li><em>ct</em> - allows both software and hardware synchronization (introduced with
<a class="reference external" href="http://www.sardana-controls.org/sep/?SEP6.md">SEP6</a>)</li>
</ul>
<p>In the <em>c</em> type of scans, in order to optimize the acquisition time, Sardana
attempts to perform as many acquisitions as allowed during the scan time. Due
to the uncertainty in the delay times involved, it is not possible to know
beforehand how many acquisitions will be completed. In other words, the number
of acquired points along a continuous scan is not fixed (but it is guaranteed
to be as large as possible). Some examples of continuous scan macros are:
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascanc" title="sardana.macroserver.macros.scan.ascanc"><code class="xref py py-class docutils literal"><span class="pre">ascanc</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scanc" title="sardana.macroserver.macros.scan.a2scanc"><code class="xref py py-class docutils literal"><span class="pre">a2scanc</span></code></a>, ...
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.dscanc" title="sardana.macroserver.macros.scan.dscanc"><code class="xref py py-class docutils literal"><span class="pre">dscanc</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.d2scanc" title="sardana.macroserver.macros.scan.d2scanc"><code class="xref py py-class docutils literal"><span class="pre">d2scanc</span></code></a>, ...
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.meshc" title="sardana.macroserver.macros.scan.meshc"><code class="xref py py-class docutils literal"><span class="pre">meshc</span></code></a>.</p>
<p>In the <em>ct</em> type of scans, Sardana perform the exact number of acquisitions
selected by the user by the means of hardware or software synchronization
configurable on the
<a class="reference internal" href="../devel/overview/overview_measurementgroup.html#sardana-measurementgroup-overview"><span class="std std-ref">measurement group</span></a> level.
The software synchronized channels may not follow the synchronization pace and
some acquisitions may need to be skipped. In order to mitigate this risk an
extra latency time can be spend in between the scan points. Another possibility
is to enable data interpolation in order to fill the gaps in the scan records.
Some examples of continuous scan macros are:
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascanct" title="sardana.macroserver.macros.scan.ascanct"><code class="xref py py-class docutils literal"><span class="pre">ascanct</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scanct" title="sardana.macroserver.macros.scan.a2scanct"><code class="xref py py-class docutils literal"><span class="pre">a2scanct</span></code></a>, ...
<code class="xref py py-class docutils literal"><span class="pre">dscanct</span></code>,
<code class="xref py py-class docutils literal"><span class="pre">d2scanct</span></code>, ...
At the time of writing the <em>ct</em> types of continuous scans
still do not support acquiring neither of: <a class="reference internal" href="../devel/overview/overview_1D.html#sardana-1d-overview"><span class="std std-ref">1D</span></a>,
<a class="reference internal" href="../devel/overview/overview_2D.html#sardana-2d-overview"><span class="std std-ref">2D</span></a>, <a class="reference internal" href="../devel/overview/overview_pseudocounter.html#sardana-pseudocounter-overview"><span class="std std-ref">Pseudo Counter</span></a>
nor external attributes e.g. <a class="reference external" href="http://www.tango-controls.org">Tango</a> however their support is planned in the
near future.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The creation of two different types of continuous scans is just the result
of the iterative development of the <a class="reference internal" href="../devel/howto_macros/scan_framework.html#sardana-macros-scanframework"><span class="std std-ref">Scan Framework</span></a>.
Ideally they will merge into one based on the <em>ct</em> approach. This process
may require backwards incompatible changes (up to and including removal of
the affected scan macros) if deemed necessary by the core developers.</p>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Scans are highly configurable using the environment variables
(on how to use environment variables see environment related macros in
<a class="reference internal" href="standard_macro_catalog.html#sardana-standard-macro-catalog"><span class="std std-ref">Standard macro catalog</span></a>).</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For further information about the available Sardana Environment
Variables, check the
<a class="reference internal" href="environment_variable_catalog.html#environment-variable-catalog"><span class="std std-ref">Environment Variable Catalog</span></a></p>
</div>
</div>
<div class="section" id="scan-snapshots">
<span id="sardana-users-scan-snapshot"></span><h2>Scan snapshots<a class="headerlink" href="#scan-snapshots" title="Permalink to this headline">¶</a></h2>
<p>Snapshots are used for saving data (or metadata) from elements and devices not
necessarily related to the scan itself. A scan saves only the values of the involved
elements, that is positions of motors being moved, and values read from experiment
channels in the active measurement group. If you want your scans to include
something more you can use the snapshot.</p>
<p>Snapshot group can be configured via <a class="reference internal" href="taurus/experimentconfiguration.html#expconf-ui-snapshot-group"><span class="std std-ref">Experiment Configuration widget</span></a>
and <a class="reference internal" href="environment_variable_catalog.html#prescansnapshot"><span class="std std-ref">PreScanSnapshot</span></a> environment variable. It can include both Sardana
elements as well as external (Tango) data sources.</p>
<p>The snapshot is saved only once during a scan, on the very beginning. The exact
way the snapshot data is saved depends on the <a class="reference internal" href="../devel/howto_recorders.html#sardana-writing-recorders"><span class="std std-ref">recorder</span></a>
and scan file format being used.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="motion.html" class="btn btn-neutral float-right" title="Motion" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="taurus/poolmotortv.html" class="btn btn-neutral" title="PoolMotorTV User’s Interface" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.0.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>