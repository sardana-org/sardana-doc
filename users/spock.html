

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Spock &mdash; sardana 3.1.1-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sardana-Taurus Extension widgets" href="taurus/index.html" />
    <link rel="prev" title="Running the client" href="getting_started/running_cli.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../docs.html">Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">User’s Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started/index.html">Getting started</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Spock</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#starting-spock-from-the-command-line">Starting spock from the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#starting-spock-with-a-custom-profile">Starting spock with a custom profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spock-ipython-primer">Spock IPython Primer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#executing-macros">Executing macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stopping-macros">Stopping macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exiting-spock">Exiting spock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-help">Getting help</a></li>
<li class="toctree-l4"><a class="reference internal" href="#moving-motors">Moving motors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#counting">Counting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scanning">Scanning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#accessing-macro-data">Accessing macro data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#changing-appearance-with-view-options">Changing appearance with View Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#editing-macros">Editing macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging-problems">Debugging problems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spock-syntax">Spock syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-spock-as-a-python-console">Using spock as a Python console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-spock-as-a-tango-console">Using spock as a Tango console</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="taurus/index.html">Sardana-Taurus Widgets</a></li>
<li class="toctree-l3"><a class="reference internal" href="scan.html">Scans</a></li>
<li class="toctree-l3"><a class="reference internal" href="motion.html">Motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="acquisition.html">Acquisition</a></li>
<li class="toctree-l3"><a class="reference internal" href="diffractometer.html">Diffractometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding_elements.html">Adding real elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_hooks.html">Macro Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_environment.html">Macro Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_logging_and_reports.html">Macro Logging and Reports</a></li>
<li class="toctree-l3"><a class="reference internal" href="environment_variable_catalog.html">Environment Variable Catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="standard_macro_catalog.html">Standard macro catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="screenshots.html">Screenshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/sardana-org/sardana/issues?q=is:issue+is:open+label:doc:knownbug">Known Problems</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devel/index.html">Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sep/index.html">Sardana Enhancement Proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../news.html">What's new?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_versions.html">Docs for other Sardana versions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana-plugins">Plugins Catalogue</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sardana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../docs.html">Sardana 3.1 Documentation</a> &raquo;</li>
        
          <li><a href="index.html">User’s Guide</a> &raquo;</li>
        
      <li>Spock</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/users/spock.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spock">
<span id="sardana-spock"></span><h1>Spock<a class="headerlink" href="#spock" title="Permalink to this headline">¶</a></h1>
<p><em>Spock</em> is the prefered <a class="reference internal" href="../glossary.html#term-CLI"><span class="xref std std-term">CLI</span></a> for sardana. It is based on <a class="reference external" href="http://ipython.org/">IPython</a>. Spock
automatically loads other <a class="reference external" href="http://ipython.org/">IPython</a> extensions like the ones for <a class="reference external" href="http://packages.python.org/PyTango/">PyTango</a> and
<em>pylab</em>. It as been extended in sardana to provide a customized interface for
executing macros and automatic access to sardana elements.</p>
<p>Spock tries to mimic <a class="reference external" href="http://www.certif.com/">SPEC</a>’s command line interface. Most <a class="reference external" href="http://www.certif.com/">SPEC</a> commands are
available from spock console.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/spock_snapshot01.png"><img alt="../_images/spock_snapshot01.png" src="../_images/spock_snapshot01.png" style="height: 600px;" /></a>
<p class="caption"><span class="caption-text">Spock <a class="reference internal" href="../glossary.html#term-CLI"><span class="xref std std-term">CLI</span></a> in action</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="starting-spock-from-the-command-line">
<h2>Starting spock from the command line<a class="headerlink" href="#starting-spock-from-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>To start spock just type in the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>marge@machine02:~$ spock
</pre></div>
</div>
<p>This will start spock with a “default profile” for the user your are logged
with. There may be many sardana servers running on your system so the first
time you start spock, it will ask you to which sardana system you want to
connect to by asking to which of the existing doors you want to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>marge@machine02:~$ spock
Profile &#39;spockdoor&#39; does not exist. Do you want to create one now ([y]/n)?
Available Door devices from homer:10000 :
On Sardana LAB-01:
    LAB-01-D01 (running)
    LAB-01-D02 (running)
On Sardana LAB-02:
    LAB-02-D01
Please select a Door from the list? LAB-01-D01
Storing ipy_profile_spockdoor.py in /home/marge/.ipython... [DONE]
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If only one Door exists in the entire system, spock will automatically
connect to that door thus avoiding the previous questions.</p>
</div>
<p>Afterward, spock <a class="reference internal" href="../glossary.html#term-CLI"><span class="xref std std-term">CLI</span></a> will start normally:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="go">Spock 7.2.1 -- An interactive sardana client.</span>

<span class="go">help      -&gt; Spock&#39;s help system.</span>
<span class="go">object?   -&gt; Details about &#39;object&#39;. ?object also works, ?? prints more.</span>

<span class="go">Spock&#39;s sardana extension 1.0 loaded with profile: spockdoor (linked to door &#39;LAB-01-D01&#39;)</span>

<span class="go">LAB-01-D01 [1]:</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to connect to another gate you need to create a new spock profile.</p>
</div>
</div>
<div class="section" id="starting-spock-with-a-custom-profile">
<h2>Starting spock with a custom profile<a class="headerlink" href="#starting-spock-with-a-custom-profile" title="Permalink to this headline">¶</a></h2>
<p>spock allows each user to start a spock session with different configurations
(known in spock as <em>profiles</em>). All you have to do is start spock with
the profile name as an option.</p>
<p>If you use ipython version &gt; 0.10 you can do it using <strong>–profile</strong> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spock</span> <span class="o">--</span><span class="n">profile</span><span class="o">=&lt;</span><span class="n">profile</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>marge@machine02:~$ spock --profile=D1
</pre></div>
</div>
<p>Otherwise (ipython version 0.10) you can do it using <strong>-p</strong> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spock</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">profile</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>marge@machine02:~$ spock -p D1
</pre></div>
</div>
<p>The first time a certain profile is used you will be asked to which door you
want to connect to (see previous chapter).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Spock profiles are stored by default in <code class="docutils literal notranslate"><span class="pre">~/.ipython/profile_&lt;profile_name&gt;</span></code>
directory. For more information please refer to the
<a class="reference external" href="http://ipython.readthedocs.io/en/stable/config/intro.html#profiles">IPython documentation</a>.</p>
</div>
</div>
<div class="section" id="spock-ipython-primer">
<h2>Spock <a class="reference external" href="http://ipython.org/">IPython</a> Primer<a class="headerlink" href="#spock-ipython-primer" title="Permalink to this headline">¶</a></h2>
<p>As mentioned before, spock console is based on <a class="reference external" href="http://ipython.org/">IPython</a>. Everything you can do
in IPython is available in spock. The <a class="reference external" href="http://ipython.org/">IPython</a> documentation provides excelent
tutorials, tips &amp; tricks, cookbooks, videos, presentations and reference guide.
For comodity we summarize some of the most interesting <a class="reference external" href="http://ipython.org/">IPython</a> chapters here:</p>
<table class="hlist"><tr><td><ul class="simple">
<li><p><a class="reference external" href="http://ipython.org/">IPython web page</a></p></li>
<li><p><a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/tutorial.html#tutorial" title="(in IPython v3.2.1)"><span>Introducing IPython</span></a></p></li>
</ul>
</td><td><ul class="simple">
<li><p><a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/tips.html#tips" title="(in IPython v3.2.1)"><span>IPython Tips &amp; Tricks</span></a></p></li>
<li><p><a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/reference.html#command-line-options" title="(in IPython v3.2.1)"><span>Command-line usage</span></a></p></li>
</ul>
</td></tr></table>
</div>
<div class="section" id="executing-macros">
<h2>Executing macros<a class="headerlink" href="#executing-macros" title="Permalink to this headline">¶</a></h2>
<p>Executing sardana macros in spock is the most useful feature of spock. It is
very simple to execute a macro: just type the macro name followed by a space
separated list of parameters (if the macro has any parameters). For example,
one of the most used macros is the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.wa" title="sardana.macroserver.macros.standard.wa"><code class="xref py py-class docutils literal notranslate"><span class="pre">wa</span></code></a> (stands for “where all”) that
shows all current motor positions. To execute it just type:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">wa</span>

<span class="go">Current Positions  (user, dial)</span>

<span class="go">   Energy       Gap    Offset</span>
<span class="go"> 100.0000   43.0000  100.0000</span>
<span class="go"> 100.0000   43.0000  100.0000</span>
</pre></div>
</div>
<p>(<a class="reference internal" href="../glossary.html#term-user"><span class="xref std std-term">user</span></a> for <a class="reference internal" href="../glossary.html#term-user-position"><span class="xref std std-term">user position</span></a> (number above); <a class="reference internal" href="../glossary.html#term-dial"><span class="xref std std-term">dial</span></a> for
<a class="reference internal" href="../glossary.html#term-dial-position"><span class="xref std std-term">dial position</span></a> (number below).)</p>
<p>A similar macro exists that only shows the desired motor positions
(<a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.wm" title="sardana.macroserver.macros.standard.wm"><code class="xref py py-class docutils literal notranslate"><span class="pre">wm</span></code></a>):</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">wm</span> <span class="n">gap</span> <span class="n">offset</span>
<span class="go">                Gap     Offset</span>
<span class="go">User</span>
<span class="go"> High         500.0      100.0</span>
<span class="go"> Current      100.0       43.0</span>
<span class="go"> Low            5.0     -100.0</span>
<span class="go">Dial</span>
<span class="go"> High         500.0      100.0</span>
<span class="go"> Current      100.0       43.0</span>
<span class="go"> Low            5.0     -100.0</span>
</pre></div>
</div>
<p>To get the list of all existing macros use
<code class="xref py py-class docutils literal notranslate"><span class="pre">lsmac</span></code>:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">lsdef</span>
<span class="go">               Name        Module                                            Brief Description</span>
<span class="go">------------------- ------------- ------------------------------------------------------------</span>
<span class="go">             a2scan         scans two-motor scan.     a2scan scans two motors, as specifi[...]</span>
<span class="go">             a2scan         scans three-motor scan .     a3scan scans three motors, as sp[...]</span>
<span class="go">              ascan         scans Do an absolute scan of the specified motor.     ascan s[...]</span>
<span class="go">            defmeas        expert                               Create a new measurement group</span>
<span class="go">              fscan         scans N-dimensional scan along user defined paths.     The mo[...]</span>
<span class="go">                lsa         lists                                   Lists all existing objects</span>
<span class="go">                lsm         lists                                             Lists all motors</span>
<span class="go">              lsmac        expert                                            Lists all macros.</span>
<span class="go">                 mv      standard                   Move motor(s) to the specified position(s)</span>
<span class="go">                mvr      standard            Move motor(s) relative to the current position(s)</span>
<span class="go">                 wa      standard                                     Show all motor position.</span>
<span class="go">                 wm      standard                   Show the position of the specified motors.</span>
<span class="go">&lt;...&gt;</span>
</pre></div>
</div>
<div class="section" id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsm" title="sardana.macroserver.macros.lists.lsm"><code class="xref py py-class docutils literal notranslate"><span class="pre">lsm</span></code></a> shows the list of
motors.</p></li>
<li><p><a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsct" title="sardana.macroserver.macros.lists.lsct"><code class="xref py py-class docutils literal notranslate"><span class="pre">lsct</span></code></a> shows the list of
counters.</p></li>
<li><p><a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsmeas" title="sardana.macroserver.macros.lists.lsmeas"><code class="xref py py-class docutils literal notranslate"><span class="pre">lsmeas</span></code></a> shows the list of
measurement groups</p></li>
<li><p><a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsctrl" title="sardana.macroserver.macros.lists.lsctrl"><code class="xref py py-class docutils literal notranslate"><span class="pre">lsctrl</span></code></a> shows the list of
controllers</p></li>
<li><p><a class="reference internal" href="../devel/api/sardana/macroserver/macros/expert.html#sardana.macroserver.macros.expert.sar_info" title="sardana.macroserver.macros.expert.sar_info"><code class="xref py py-class docutils literal notranslate"><span class="pre">sar_info</span></code></a> <em>object</em>
displays detailed information about an element</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="stopping-macros">
<span id="sardana-spock-stopping"></span><h2>Stopping macros<a class="headerlink" href="#stopping-macros" title="Permalink to this headline">¶</a></h2>
<p>Some macros may take a long time to execute. To stop a macro in the middle of
its execution type <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Control</kbd>+<kbd class="kbd docutils literal notranslate">c</kbd></kbd>. If the stopping process last too long,
you may trigger the aborting process with a second <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Control</kbd>+<kbd class="kbd docutils literal notranslate">c</kbd></kbd>.
Here be patient, further issuing of <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Control</kbd>+<kbd class="kbd docutils literal notranslate">c</kbd></kbd> may leave your macro
in an uncontrolled way. Use them only if you are sure that the aborting
process will not bring your system to a safe state.</p>
<p>Macros that move motors or acquire data from sensors will automatically stop all
motion and/or all acquisition.</p>
<p>While stopping and aborting macros Spock reports you what happens behind the
scene with informative messages:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">ascan</span> <span class="n">mot01</span> <span class="mi">0</span> <span class="mi">10</span> <span class="mi">100</span> <span class="mf">0.1</span>
<span class="go">Operation will be saved in /tmp/test.h5 (HDF5::NXscan from NXscanH5_FileRecorder)</span>
<span class="go">Scan #342 started at Wed Sep  9 23:01:14 2020. It will take at least 0:00:10.174246</span>
<span class="go">                                       tg_test</span>
<span class="go"> #Pt No    mot01      ct01     gct01    double_scalar     dt</span>
<span class="go">   0         0        0.1     2.98023e-08      243.47     0.0967791</span>
<span class="go">   1        0.1       0.1     5.91929e-08      243.47     0.239136</span>
<span class="go">   2        0.2       0.1     1.1595e-07      243.47     0.384191</span>
<span class="go">^C</span>
<span class="go">Ctrl-C received: Stopping...</span>
<span class="go">Stopping Motion([&#39;mot01&#39;]) reserved by ascan</span>
<span class="go">Motion([&#39;mot01&#39;]) stopped</span>
<span class="go">Stopping mntgrp_expconf reserved by ascan</span>
<span class="go">mntgrp_expconf stopped</span>
<span class="go">Stopping /monitor reserved by ascan</span>
<span class="go">Stopping /mirror reserved by ascan</span>
<span class="go">Stopping /slit reserved by ascan</span>
<span class="go">Operation saved in /tmp/test.h5 (HDF5::NXscan)</span>
<span class="go">Scan #342 ended at Wed Sep  9 23:01:15 2020, taking 0:00:01.055814. Dead time 33.7% (motion dead time 12.8%)</span>
<span class="go">Executing ascan.on_stop method...</span>
<span class="go">Stopping done!</span>
</pre></div>
</div>
</div>
<div class="section" id="exiting-spock">
<h2>Exiting spock<a class="headerlink" href="#exiting-spock" title="Permalink to this headline">¶</a></h2>
<p>To exit spock type <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Control</kbd>+<kbd class="kbd docutils literal notranslate">d</kbd></kbd> or <code class="samp docutils literal notranslate"><span class="pre">exit()</span></code> inside a spock console.</p>
</div>
<div class="section" id="getting-help">
<span id="sardana-spock-gettinghelp"></span><h2>Getting help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h2>
<p>spock not only knows all the macros the sardana server can run but it also
information about each macro parameters, result and documentation. Therefore it
can give you precise help on each macro. To get help about a certain macro just
type the macro name directly followed by a question mark(‘?’):</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">ascan</span><span class="err">?</span>

<span class="go">Syntax:</span>
<span class="go">        ascan &lt;motor&gt; &lt;start_pos&gt; &lt;final_pos&gt; &lt;nr_interv&gt; &lt;integ_time&gt;</span>

<span class="go">Do an absolute scan of the specified motor.</span>
<span class="go">    ascan scans one motor, as specified by motor. The motor starts at the</span>
<span class="go">    position given by start_pos and ends at the position given by final_pos.</span>
<span class="go">    The step size is (start_pos-final_pos)/nr_interv. The number of data points collected</span>
<span class="go">    will be nr_interv+1. Count time is given by time which if positive,</span>
<span class="go">    specifies seconds and if negative, specifies monitor counts.</span>

<span class="go">Parameters:</span>
<span class="go">        motor : (Motor) Motor to move</span>
<span class="go">        start_pos : (Float) Scan start position</span>
<span class="go">        final_pos : (Float) Scan final position</span>
<span class="go">        nr_interv : (Integer) Number of scan intervals</span>
<span class="go">        integ_time : (Float) Integration time</span>
</pre></div>
</div>
</div>
<div class="section" id="moving-motors">
<h2>Moving motors<a class="headerlink" href="#moving-motors" title="Permalink to this headline">¶</a></h2>
<p>A single motor may be moved using the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.mv" title="sardana.macroserver.macros.standard.mv"><code class="xref py py-class docutils literal notranslate"><span class="pre">mv</span></code></a> <em>motor</em> <em>position</em> macro.
Example:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">mv</span> <span class="n">gap</span> <span class="mi">50</span>
</pre></div>
</div>
<p>will move the <em>gap</em> motor to 50. The prompt only comes back after the motion as
finished.</p>
<p>Alternatively, you can have the motor position displayed on the screen as it is
moving by using the <a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.umv" title="sardana.macroserver.macros.standard.umv"><code class="xref py py-class docutils literal notranslate"><span class="pre">umv</span></code></a> macro
instead. To stop the motor(s) before they have finished moving, type
<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Control</kbd>+<kbd class="kbd docutils literal notranslate">c</kbd></kbd>.</p>
<p>You can use the <a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.mvr" title="sardana.macroserver.macros.standard.mvr"><code class="xref py py-class docutils literal notranslate"><span class="pre">mvr</span></code></a> <em>motor</em>
<em>relative_position</em> macro to move a motor relative to its current position:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">mvr</span> <span class="n">gap</span> <span class="mi">2</span>
</pre></div>
</div>
<p>will move <em>gap</em> by two user units.</p>
</div>
<div class="section" id="counting">
<h2>Counting<a class="headerlink" href="#counting" title="Permalink to this headline">¶</a></h2>
<p>You can count using the <a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.ct" title="sardana.macroserver.macros.standard.ct"><code class="xref py py-class docutils literal notranslate"><span class="pre">ct</span></code></a> <em>value</em>
macro. Without arguments, this macro counts for one second using the active
measurement group set by the environment variable <em>ActiveMntGrp</em>.</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_lab-01_1 [1]: </span><span class="n">ct</span> <span class="mf">1.6</span>

<span class="go">Wed Jul 11 11:47:55 2012</span>

<span class="go">  ct01  =         1.6</span>
<span class="go">  ct02  =         3.2</span>
<span class="go">  ct03  =         4.8</span>
<span class="go">  ct04  =         6.4</span>
</pre></div>
</div>
<p>To see the list of available measurement groups type
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/lists.html#sardana.macroserver.macros.lists.lsmeas" title="sardana.macroserver.macros.lists.lsmeas"><code class="xref py py-class docutils literal notranslate"><span class="pre">lsmeas</span></code></a>. The active measuremnt group
is marked with an asterisk (*):</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_lab-01_1 [1]: </span><span class="n">lsmeas</span>

<span class="go">  Active        Name   Timer Experim. channels</span>
<span class="go"> -------- ---------- ------- -----------------------------------------------------------</span>
<span class="go">    *       mntgrp01    ct01 ct01, ct02, ct03, ct04</span>
<span class="go">            mntgrp21    ct04 ct04, pcII0, pcII02</span>
<span class="go">            mntgrp24    ct04 ct04, pcII0</span>
</pre></div>
</div>
<p>to switch active measurement groups type
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/env.html#sardana.macroserver.macros.env.senv" title="sardana.macroserver.macros.env.senv"><code class="xref py py-class docutils literal notranslate"><span class="pre">senv</span></code></a> <strong>ActiveMntGrp</strong> <em>mg_name</em>.</p>
<p>You can also create, modify and select measurement groups using the
<a class="reference internal" href="taurus/experimentconfiguration.html#expconf-ui"><span class="std std-ref">expconf</span></a> command</p>
</div>
<div class="section" id="scanning">
<h2>Scanning<a class="headerlink" href="#scanning" title="Permalink to this headline">¶</a></h2>
<p>Sardana provides a catalog of different standard scan macros. Absolute-position
motor scans such as <a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascan" title="sardana.macroserver.macros.scan.ascan"><code class="xref py py-class docutils literal notranslate"><span class="pre">ascan</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a2scan" title="sardana.macroserver.macros.scan.a2scan"><code class="xref py py-class docutils literal notranslate"><span class="pre">a2scan</span></code></a> and
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.a3scan" title="sardana.macroserver.macros.scan.a3scan"><code class="xref py py-class docutils literal notranslate"><span class="pre">a3scan</span></code></a> move one, two or three motors
at a time. Relative-position motor scans are
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.dscan" title="sardana.macroserver.macros.scan.dscan"><code class="xref py py-class docutils literal notranslate"><span class="pre">dscan</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.d2scan" title="sardana.macroserver.macros.scan.d2scan"><code class="xref py py-class docutils literal notranslate"><span class="pre">d2scan</span></code></a> and
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.d3scan" title="sardana.macroserver.macros.scan.d3scan"><code class="xref py py-class docutils literal notranslate"><span class="pre">d3scan</span></code></a>. The relative-position scans
all return the motors to their starting positions after the last point. Two
motors can be scanned over a grid of points using the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.mesh" title="sardana.macroserver.macros.scan.mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">mesh</span></code></a> scan.</p>
<p><em>Continuous</em> versions exist of many of the standard scan macros (e.g.
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascanc" title="sardana.macroserver.macros.scan.ascanc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ascanc</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.d3scanc" title="sardana.macroserver.macros.scan.d3scanc"><code class="xref py py-class docutils literal notranslate"><span class="pre">d3scanc</span></code></a>,
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.meshc" title="sardana.macroserver.macros.scan.meshc"><code class="xref py py-class docutils literal notranslate"><span class="pre">meshc</span></code></a>,…). The continuous scans
differ from their standard counterparts (also known as <em>step</em> scans) in that
the data acquisition is done without stopping the motors. Continuous scans are
generally faster but less precise than step scans, and some details must be
considered (see <a class="reference internal" href="scan.html#sardana-users-scan"><span class="std std-ref">Scans</span></a>).</p>
<p>As it happens with <a class="reference internal" href="../devel/api/sardana/macroserver/macros/standard.html#sardana.macroserver.macros.standard.ct" title="sardana.macroserver.macros.standard.ct"><code class="xref py py-class docutils literal notranslate"><span class="pre">ct</span></code></a>, the scan
macros will also use the active measurement group to decide which experiment
channels will be involved in the operation.</p>
<p>Here is the output of performing an
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.ascan" title="sardana.macroserver.macros.scan.ascan"><code class="xref py py-class docutils literal notranslate"><span class="pre">ascan</span></code></a> of the gap in a slit:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">ascan</span> <span class="n">gap</span> <span class="mf">0.9</span> <span class="mf">1.1</span> <span class="mi">20</span> <span class="mi">1</span>
<span class="go">ScanDir is not defined. This operation will not be stored persistently. Use &quot;senv ScanDir &lt;abs directory&gt;&quot; to enable it</span>
<span class="go">Scan #4 started at Wed Jul 11 12:56:47 2012. It will take at least 0:00:21</span>
<span class="go"> #Pt No    gap       ct01      ct02      ct03</span>
<span class="go">  0        0.9          1       4604      8939</span>
<span class="go">  1       0.91          1       5822      8820</span>
<span class="go">  2       0.92          1       7254      9544</span>
<span class="go">  3       0.93          1       9254      8789</span>
<span class="go">  4       0.94          1      11265      8804</span>
<span class="go">  5       0.95          1      13583      8909</span>
<span class="go">  6       0.96          1      15938      8821</span>
<span class="go">  7       0.97          1      18076      9110</span>
<span class="go">  8       0.98          1      19638      8839</span>
<span class="go">  9       0.99          1      20825      8950</span>
<span class="go"> 10          1          1      21135      8917</span>
<span class="go"> 11       1.01          1      20765      9013</span>
<span class="go"> 12       1.02          1      19687      9135</span>
<span class="go"> 13       1.03          1      18034      8836</span>
<span class="go"> 14       1.04          1      15876      8901</span>
<span class="go"> 15       1.05          1      13576      8933</span>
<span class="go"> 16       1.06          1      11328      9022</span>
<span class="go"> 17       1.07          1       9244      9205</span>
<span class="go"> 18       1.08          1       7348      8957</span>
<span class="go"> 19       1.09          1       5738      8801</span>
<span class="go"> 20        1.1          1       4575      8975</span>
<span class="go">Scan #4 ended at Wed Jul 11 12:57:18 2012, taking 0:00:31.656980 (dead time was 33.7%)</span>
</pre></div>
</div>
<div class="section" id="scan-storage">
<h3>Scan storage<a class="headerlink" href="#scan-storage" title="Permalink to this headline">¶</a></h3>
<p>As you can see, by default, the scan is not recorded into any file. To store
your scans in a file, you must set the environment variables <strong>ScanDir</strong> and
<strong>ScanFile</strong>:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">senv</span> <span class="n">ScanDir</span> <span class="o">/</span><span class="n">tmp</span>
<span class="go">ScanDir = /tmp</span>

<span class="gp">LAB-01-D01 [2]: </span><span class="n">senv</span> <span class="n">ScanFile</span> <span class="n">scans</span><span class="o">.</span><span class="n">h5</span>
<span class="go">ScanFile = scans.h5</span>
</pre></div>
</div>
<p>Sardana will activate a proper recorder to store the scans persistently
(currently, <em>.h5</em> will store in <a class="reference external" href="http://www.nexusformat.org/">NeXus</a> format. All other extensions are
interpreted as <a class="reference external" href="http://www.certif.com/">SPEC</a> format).</p>
<p>You can also store in multiples files by assigning the <strong>ScanFile</strong> with a list
of files:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [2]: </span><span class="n">senv</span> <span class="n">ScanFile</span> <span class="s2">&quot;[&#39;scans.h5&#39;, &#39;scans.dat&#39;]&quot;</span>
<span class="go">ScanFile = [&#39;scans.h5&#39;, &#39;scans.dat&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="viewing-scan-data">
<span id="sardana-spock-showscan"></span><h3>Viewing scan data<a class="headerlink" href="#viewing-scan-data" title="Permalink to this headline">¶</a></h3>
<p>You can show plots for the current scan (i.e. plotting the scan <em>online</em>) by
launching the <a class="reference internal" href="../devel/api/sardana/spock/magic.html#sardana.spock.magic.showscan" title="sardana.spock.magic.showscan"><code class="xref py py-func docutils literal notranslate"><span class="pre">showscan</span> <span class="pre">online</span></code></a> command.</p>
<p>Sardana provides also a scan data viewer for scans which were stored in a <a class="reference external" href="http://www.nexusformat.org/">NeXus</a>
file: <a class="reference internal" href="taurus/showscan.html#showscan-ui"><span class="std std-ref">Showscan</span></a>. It can be launched using <a class="reference internal" href="../devel/api/sardana/spock/magic.html#sardana.spock.magic.showscan" title="sardana.spock.magic.showscan"><code class="xref py py-func docutils literal notranslate"><span class="pre">showscan</span></code></a>
spock command. It accepts scan number as an argument, and will show the last scan
when invoked without arguments.</p>
<p>The history of scans is available through the
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/scan.html#sardana.macroserver.macros.scan.scanhist" title="sardana.macroserver.macros.scan.scanhist"><code class="xref py py-class docutils literal notranslate"><span class="pre">scanhist</span></code></a> macro:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">scanhist</span>
<span class="go">   #                           Title            Start time              End time        Stored</span>
<span class="go"> --- ------------------------------- --------------------- --------------------- -------------</span>
<span class="go">   1    dscan mot01 20.0 30.0 10 0.1   2012-07-03 10:35:30   2012-07-03 10:35:30   Not stored!</span>
<span class="go">   3    dscan mot01 20.0 30.0 10 0.1   2012-07-03 10:36:38   2012-07-03 10:36:43   Not stored!</span>
<span class="go">   4   ascan gap01 10.0 100.0 20 1.0              12:56:47              12:57:18   Not stored!</span>
<span class="go">   5     ascan gap01 1.0 10.0 20 0.1              13:19:05              13:19:13      scans.h5</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="accessing-macro-data">
<h2>Accessing macro data<a class="headerlink" href="#accessing-macro-data" title="Permalink to this headline">¶</a></h2>
<p>The command <code class="xref py py-class docutils literal notranslate"><span class="pre">macrodata</span></code>  allows to retrieve the data of the last macro run in spock.
If this macro does not provide any data an error message is thrown.
Example accesing scan data:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_1 [9]: </span><span class="n">ascan</span> <span class="n">mot17</span> <span class="mi">1</span> <span class="mi">10</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="go">ScanDir is not defined. This operation will not be stored persistently. Use &quot;expconf&quot; (or &quot;senv ScanDir &lt;abs directory&gt;&quot;) to enable it</span>
<span class="go">Scan #2 started at Tue Feb 13 11:16:18 2018. It will take at least 0:00:05.048528</span>
<span class="go">0         1         1         3         4      0.865325</span>
<span class="go">1        5.5        1         3         4      2.51148</span>
<span class="go">2         10        1         3         4      4.16662</span>
<span class="go">Scan #2 ended at Tue Feb 13 11:16:24 2018, taking 0:00:05.201949. Dead time 42.3% (motion dead time 40.5%)</span>
<span class="c">#Pt No    mot17      ct17      ct19      ct20       dt</span>
<span class="gp">Door_1 [10]: </span><span class="n">r</span> <span class="o">=</span> <span class="o">%</span><span class="n">macrodata</span>
<span class="gp">Door_1 [11]: </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">Result [11]:</span>
<span class="go">[&#39;point_nb&#39;,</span>
<span class="go">&#39;timestamp&#39;,</span>
<span class="go">&#39;mot17&#39;,</span>
<span class="go">&#39;haso111n:10000/expchan/ctctrl05/4&#39;,</span>
<span class="go">&#39;haso111n:10000/expchan/ctctrl05/1&#39;,</span>
<span class="go">&#39;haso111n:10000/expchan/ctctrl05/3&#39;]</span>
<span class="gp">Door_1 [12]: </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;point_nb&#39;</span><span class="p">]</span>
<span class="gp">Result [12]: </span><span class="mi">0</span>
<span class="gp">Door_1 [13]: </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mot17&#39;</span><span class="p">]</span>
<span class="gp">Result [13]: </span><span class="mf">1.0</span>
<span class="gp">Door_1 [16]: </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;haso111n:10000/expchan/ctctrl05/1&#39;</span><span class="p">]</span>
<span class="gp">Result [16]: </span><span class="mf">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-appearance-with-view-options">
<span id="sardana-spock-viewoptions"></span><h2>Changing appearance with View Options<a class="headerlink" href="#changing-appearance-with-view-options" title="Permalink to this headline">¶</a></h2>
<p>The <em>View Options</em> allow the users to customize the output displayed by certain
macros. They are set by the macro <a class="reference internal" href="../devel/api/sardana/macroserver/macros/env.html#sardana.macroserver.macros.env.setvo" title="sardana.macroserver.macros.env.setvo"><code class="xref py py-class docutils literal notranslate"><span class="pre">setvo</span></code></a>.
The macro <a class="reference internal" href="../devel/api/sardana/macroserver/macros/env.html#sardana.macroserver.macros.env.usetvo" title="sardana.macroserver.macros.env.usetvo"><code class="xref py py-class docutils literal notranslate"><span class="pre">usetvo</span></code></a> returns the
<em>View Options</em> to the default value. And the macro
<a class="reference internal" href="../devel/api/sardana/macroserver/macros/env.html#sardana.macroserver.macros.env.lsvo" title="sardana.macroserver.macros.env.lsvo"><code class="xref py py-class docutils literal notranslate"><span class="pre">lsvo</span></code></a> lists the current values.</p>
<p>Available <em>View Options</em>:</p>
<ul class="simple">
<li><p><strong>ShowDial</strong>: Select if the <a class="reference internal" href="../glossary.html#term-dial"><span class="xref std std-term">dial</span></a> information of the motor should be
displayed. <br> Default value <code class="docutils literal notranslate"><span class="pre">False</span></code> (no <a class="reference internal" href="../glossary.html#term-dial"><span class="xref std std-term">dial</span></a> but only
<a class="reference internal" href="../glossary.html#term-user"><span class="xref std std-term">user</span></a> information).</p></li>
<li><p><strong>ShowCtrlAxis</strong>: Select if the name of the controller the motor belongs to
should be displayed. Default value <code class="docutils literal notranslate"><span class="pre">False</span></code> (no controller name).</p></li>
<li><p><strong>PosFormat</strong>: Set the number of decimal digits displayed in the motor
position/limits. <br> Default value <code class="docutils literal notranslate"><span class="pre">-1</span></code> (all digits).</p></li>
<li><p><strong>OutputBlock</strong>: Set if the line information during scans is appended to the
output or updated. <br> Default value <code class="docutils literal notranslate"><span class="pre">False</span></code> (lines are appended to the
displayed output during the scan).</p></li>
<li><p><strong>DescriptionLength</strong>: Length (number of characters) of the macro
description printed by <code class="docutils literal notranslate"><span class="pre">lsdef</span></code> macro. <br> Default value <code class="docutils literal notranslate"><span class="pre">60</span></code>.</p></li>
</ul>
</div>
<div class="section" id="editing-macros">
<h2>Editing macros<a class="headerlink" href="#editing-macros" title="Permalink to this headline">¶</a></h2>
<p>The command <a class="reference internal" href="../devel/api/sardana/spock/magic.html#sardana.spock.magic.edmac" title="sardana.spock.magic.edmac"><code class="xref py py-class docutils literal notranslate"><span class="pre">edmac</span></code></a> allows to edit the macros
directly from spock. See <a class="reference internal" href="../devel/howto_macros/macros_general.html#sardana-macros-howto"><span class="std std-ref">Writing macros</span></a> section.</p>
</div>
<div class="section" id="debugging-problems">
<h2>Debugging problems<a class="headerlink" href="#debugging-problems" title="Permalink to this headline">¶</a></h2>
<p>Spock provides some commands that help to debug or recognize the errors in
case a macro fails when being executed.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">www</span></code> prints the error message from the
last macro execution</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">debug</span></code> used with <code class="docutils literal notranslate"><span class="pre">on</span></code> as parameter
activates the print out of the debug messages during macro execution.
Set it to <code class="docutils literal notranslate"><span class="pre">off</span></code> to deactivate it.</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">post_mortem</span></code> prints the current logger
messages. If no argument is specified it reads the <code class="docutils literal notranslate"><span class="pre">debug</span></code> stream.
Valid values are <code class="docutils literal notranslate"><span class="pre">output</span></code>, <code class="docutils literal notranslate"><span class="pre">critical</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, <code class="docutils literal notranslate"><span class="pre">warning</span></code>,
<code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">debug</span></code> and <code class="docutils literal notranslate"><span class="pre">result</span></code>.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="spock-syntax">
<span id="sardana-spock-syntax"></span><h2>Spock syntax<a class="headerlink" href="#spock-syntax" title="Permalink to this headline">¶</a></h2>
<p><em>Spock syntax</em> is used to execute macros. It is based on space
separated list of parameter values. If the string parameter values contain
spaces itself these <strong>must</strong> be enclosed in quotes, either single quotes
<code class="docutils literal notranslate"><span class="pre">''</span></code> or double quotes <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<p>The spock syntax was extended with the use of square brackets <code class="docutils literal notranslate"><span class="pre">[]</span></code> for
macros which define
<a class="reference internal" href="../devel/howto_macros/macros_general.html#sardana-macro-repeat-parameters"><span class="std std-ref">repeat parameters</span></a> as arguments.
Repeat parameter values must be enclosed in square brackets. If the repeat
parameter is composed from more than one internal parameter its every
repetition must be enclosed in another square brackets as well.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">move_with_timeout</span></code> macro:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">move_with_timeout</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Execute move with a timeout&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;m_p_pair&#39;</span><span class="p">,</span>
         <span class="p">[[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Motor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Position to move to&#39;</span><span class="p">]],</span>
         <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;List of motor/position pairs&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Timeout value&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Must use the square brackets for the <code class="docutils literal notranslate"><span class="pre">m_p_pair</span></code> parameter and its
repeats:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_1 [1]: </span><span class="n">move_with_timeout</span> <span class="p">[[</span><span class="n">th</span> <span class="mf">8.4</span><span class="p">]</span> <span class="p">[</span><span class="n">tth</span> <span class="mf">16.8</span><span class="p">]]</span> <span class="mi">50</span>
</pre></div>
</div>
<p>However for the commodity reasons the square brackets may be skipped. The
following examples explain in which cases.</p>
<div class="section" id="repeat-parameter-is-the-last-one">
<h3>Repeat parameter is the last one<a class="headerlink" href="#repeat-parameter-is-the-last-one" title="Permalink to this headline">¶</a></h3>
<p>When the repeat parameter is the last one in the parameters definition
both square brackets (for the repeat parameter and for the repetition) may
be skipped.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">move</span></code> macro:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">move</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Execute move&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;m_p_pair&#39;</span><span class="p">,</span>
         <span class="p">[[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Motor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Motor to move&#39;</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span>  <span class="n">Type</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Position to move to&#39;</span><span class="p">]],</span>
         <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;List of motor/position pairs&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>May skip the square brackets for the <code class="docutils literal notranslate"><span class="pre">m_p_pair</span></code> parameter and its
repeats:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_1 [1]: </span><span class="n">move</span> <span class="n">th</span> <span class="mf">8.4</span> <span class="n">tth</span> <span class="mf">16.8</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_1 [1]: </span><span class="n">move</span> <span class="p">[[</span><span class="n">th</span> <span class="mf">8.4</span><span class="p">]</span> <span class="p">[</span><span class="n">tth</span> <span class="mf">16.8</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="repeat-parameter-has-only-one-internal-parameter">
<h3>Repeat parameter has only one internal parameter<a class="headerlink" href="#repeat-parameter-has-only-one-internal-parameter" title="Permalink to this headline">¶</a></h3>
<p>When the repeat parameter contains only one internal parameter the square
brackets for the repetition <strong>must</strong> be skipped.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">power_motor</span></code> macro:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">power_motor</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power on/off motor(s)&quot;&quot;&quot;</span>

    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;motor_list&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Motor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;motor name&#39;</span><span class="p">]],</span>
            <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;List of motors&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;power_on&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;motor power state&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Must use the square brackets for the <code class="docutils literal notranslate"><span class="pre">motor_list</span></code> parameter but not for
its repeats:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_1 [1]: </span><span class="n">power_motor</span> <span class="p">[</span><span class="n">th</span> <span class="n">tth</span><span class="p">]</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="repeat-parameter-has-only-one-internal-parameter-and-only-one-repetition-value">
<h3>Repeat parameter has only one internal parameter and only one repetition value<a class="headerlink" href="#repeat-parameter-has-only-one-internal-parameter-and-only-one-repetition-value" title="Permalink to this headline">¶</a></h3>
<p>When the repeat parameter contains only one internal parameter and you
would like to pass only one repetition value then the square brackets for
the repeat parameter may be skipped as well resulting in no square brackets
being used.</p>
<p>This assumes the <code class="docutils literal notranslate"><span class="pre">power_motor</span></code> macro from the previous example.
The following two macro executions are equivalent:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">Door_1 [1]: </span><span class="n">power_motor</span> <span class="n">th</span> <span class="bp">True</span>
<span class="gp">Door_1 [2]: </span><span class="n">power_motor</span> <span class="p">[</span><span class="n">th</span><span class="p">]</span> <span class="bp">True</span>
</pre></div>
</div>
<p>A set of macro examples defining complex repeat parameters can be found in
<a class="reference internal" href="../devel/examples/macro_parameter_examples.html#sardana-devel-macro-parameter-examples"><span class="std std-ref">Macro parameter examples</span></a>.
You can see the invocation example for each of these macros in its docstring.</p>
</div>
</div>
<div class="section" id="using-spock-as-a-python-console">
<h2>Using spock as a <a class="reference external" href="http://www.python.org/">Python</a> console<a class="headerlink" href="#using-spock-as-a-python-console" title="Permalink to this headline">¶</a></h2>
<p>You can write any <a class="reference external" href="http://www.python.org/">Python</a> code inside a spock console since spock uses <a class="reference external" href="http://ipython.org/">IPython</a>
as a command line interpreter. For example, the following will work inside a
spock console:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="go">           ...:     print(&quot;Hello, World!&quot;)</span>
<span class="go">           ...:</span>
<span class="go">           ...:</span>

<span class="gp">LAB-01-D01 [2]: </span><span class="n">f</span><span class="p">()</span>
<span class="go">Hello, World!</span>
</pre></div>
</div>
</div>
<div class="section" id="using-spock-as-a-tango-console">
<h2>Using spock as a <a class="reference external" href="http://www.tango-controls.org/">Tango</a> console<a class="headerlink" href="#using-spock-as-a-tango-console" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in the beginning of this chapter, the sardana spock automatically
activates the <a class="reference external" href="http://packages.python.org/PyTango/">PyTango</a> ‘s ipython console extension <a class="footnote-reference brackets" href="#id2" id="id1">1</a>. Therefore all <a class="reference external" href="http://www.tango-controls.org/">Tango</a>
features are automatically available on the sardana spock console. For example,
creating a <a class="reference external" href="https://pytango.readthedocs.io/en/stable/client_api/device_proxy.html#tango.DeviceProxy" title="(in PyTango v9.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tango.DeviceProxy</span></code></a> will work inside the sardana spock
console:</p>
<div class="highlight-spock notranslate"><div class="highlight"><pre><span></span><span class="gp">LAB-01-D01 [1]: </span><span class="n">tgtest</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="s2">&quot;sys/tg_test/1&quot;</span><span class="p">)</span>

<span class="gp">LAB-01-D01 [2]: </span><span class="k">print</span><span class="p">(</span><span class="n">tgtest</span><span class="o">.</span><span class="n">state</span><span class="p">())</span>
<span class="go">RUNNING</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>The <a class="reference external" href="http://packages.python.org/PyTango/">PyTango</a> ipython documentation can be found here: <a class="reference external" href="https://pythonhosted.org/itango/">ITango</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="taurus/index.html" class="btn btn-neutral float-right" title="Sardana-Taurus Extension widgets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="getting_started/running_cli.html" class="btn btn-neutral float-left" title="Running the client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>