

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sardana.macroserver.macro &mdash; sardana 2.7.3-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="sardana 2.7.3-alpha documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> sardana
          

          
            
            <img src="../../../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference external" href="http://www.sardana-controls.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sardana-org/sardana">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/sardana">Download from PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/sardana-org/sardana/wiki">Wiki</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">sardana</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>sardana.macroserver.macro</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for sardana.macroserver.macro</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1">##############################################################################</span>
<span class="c1">##</span>
<span class="c1"># This file is part of Sardana</span>
<span class="c1">##</span>
<span class="c1"># http://www.sardana-controls.org/</span>
<span class="c1">##</span>
<span class="c1"># Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">##</span>
<span class="c1"># Sardana is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1"># Sardana is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Sardana.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">##############################################################################</span>

<span class="sd">&quot;&quot;&quot;This module contains the class definition for the MacroServer generic</span>
<span class="sd">scan&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">with_statement</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OverloadPrint&quot;</span><span class="p">,</span> <span class="s2">&quot;PauseEvent&quot;</span><span class="p">,</span> <span class="s2">&quot;Hookable&quot;</span><span class="p">,</span> <span class="s2">&quot;ExecMacroHook&quot;</span><span class="p">,</span>
           <span class="s2">&quot;MacroFinder&quot;</span><span class="p">,</span> <span class="s2">&quot;Macro&quot;</span><span class="p">,</span> <span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="s2">&quot;iMacro&quot;</span><span class="p">,</span> <span class="s2">&quot;imacro&quot;</span><span class="p">,</span>
           <span class="s2">&quot;MacroFunc&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;ParamRepeat&quot;</span><span class="p">,</span> <span class="s2">&quot;Table&quot;</span><span class="p">,</span> <span class="s2">&quot;List&quot;</span><span class="p">,</span> <span class="s2">&quot;ViewOption&quot;</span><span class="p">,</span>
           <span class="s2">&quot;LibraryError&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional&quot;</span><span class="p">]</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;restructuredtext&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">taurus.core.util.log</span> <span class="k">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">taurus.core.util.prop</span> <span class="k">import</span> <span class="n">propertx</span>
<span class="kn">from</span> <span class="nn">taurus.console.table</span> <span class="k">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">taurus.console.list</span> <span class="k">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">sardana.sardanadefs</span> <span class="k">import</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">sardana.util.wrap</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">sardana.macroserver.msparameter</span> <span class="k">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">ParamType</span><span class="p">,</span> <span class="n">ParamRepeat</span><span class="p">,</span> \
    <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">sardana.macroserver.msexception</span> <span class="k">import</span> <span class="n">StopException</span><span class="p">,</span> <span class="n">AbortException</span><span class="p">,</span> \
    <span class="n">MacroWrongParameterType</span><span class="p">,</span> <span class="n">UnknownEnv</span><span class="p">,</span> <span class="n">UnknownMacro</span><span class="p">,</span> <span class="n">LibraryError</span>
<span class="kn">from</span> <span class="nn">sardana.macroserver.msoptions</span> <span class="k">import</span> <span class="n">ViewOption</span>

<span class="kn">from</span> <span class="nn">sardana.taurus.core.tango.sardana.pool</span> <span class="k">import</span> <span class="n">PoolElement</span>

<span class="n">asyncexc</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyThreadState_SetAsyncExc</span>
<span class="c1"># first define the async exception function args. This is</span>
<span class="c1"># absolutely necessary for 64 bits machines.</span>
<span class="n">asyncexc</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">OverloadPrint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accum</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accum</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="c1"># while there is no new line, just accumulate the buffer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accum</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># take the &#39;\n&#39; because the output is a list of strings, each to be</span>
        <span class="c1"># interpreted as a separate line in the client</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accum</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


<span class="k">class</span> <span class="nc">PauseEvent</span><span class="p">(</span><span class="n">Logger</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_obj</span><span class="p">,</span> <span class="n">abort_timeout</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_cb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resume_cb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_obj_wr</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">macro_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_name</span> <span class="o">=</span> <span class="n">macro_obj</span><span class="o">.</span><span class="n">_getName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_exception</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_timeout</span> <span class="o">=</span> <span class="n">abort_timeout</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro_</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_macro_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">))</span>
        <span class="c1"># we create an event object that is automatically set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">macro_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_obj_wr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[START] Pause&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_cb</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[ END ] Pause&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[START] Resume&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resume_cb</span> <span class="o">=</span> <span class="n">cb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[ END ] Resume&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resumeForAbort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[RESUME] (Abort)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_exception</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">pauseit</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">isSet</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pauseit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pause_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macro_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="c1"># if an event is set because an abort has been issued during a paused</span>
        <span class="c1"># macro wait for the ashyncronous AbortException to arrive at this</span>
        <span class="c1"># thread</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_exception</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_timeout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Abort exception did not occured in pause for </span><span class="si">%s</span><span class="s1">s.&#39;</span>
                       <span class="s1">&#39;Performing a Forced Abort.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_abort_timeout</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AbortException</span><span class="p">(</span><span class="s2">&quot;Forced&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pauseit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resume_cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resume_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macro_obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isPaused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">isSet</span><span class="p">()</span>


<div class="viewcode-block" id="Hookable"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Hookable">[docs]</a><span class="k">class</span> <span class="nc">Hookable</span><span class="p">(</span><span class="n">Logger</span><span class="p">):</span>

    <span class="c1"># avoid creating an __init__</span>

    <span class="k">def</span> <span class="nf">_getHooks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span>

    <span class="k">def</span> <span class="nf">_getHookHintsDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_ALL_&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;_NOHINTS_&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span>

<div class="viewcode-block" id="Hookable.getAllowedHookHints"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Hookable.getAllowedHookHints">[docs]</a>    <span class="k">def</span> <span class="nf">getAllowedHookHints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">hints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allowsHooks&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hookable.getHints"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Hookable.getHints">[docs]</a>    <span class="k">def</span> <span class="nf">getHints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getHookHintsDict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="Hookable.getHooks"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Hookable.getHooks">[docs]</a>    <span class="k">def</span> <span class="nf">getHooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This will return a list of hooks that have the given hint. Two reserved</span>
<span class="sd">        hints are always valid:</span>

<span class="sd">        - &quot;_ALL_&quot;: which contains all the hooks</span>
<span class="sd">        - &quot;_NOHINTS_&quot;: which contains the hooks that don&#39;t provide any hint</span>

<span class="sd">        :param hint: (str) a hint. If None is passed, it returns a list of</span>
<span class="sd">                     (hook,hints) tuples</span>

<span class="sd">        :return: (list) an ordered list of hooks that have the given hint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getHooks</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getHookHintsDict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hint</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="Hookable.appendHook"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Hookable.appendHook">[docs]</a>    <span class="k">def</span> <span class="nf">appendHook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append a hook according to the hook information</span>

<span class="sd">        :param hook_info: sequence of two elements, the first one is the hook</span>
<span class="sd">            and its optional parameters/arguments, the second one is the list</span>
<span class="sd">            of hints e.g. hook places</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getHooks</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook_info</span><span class="p">)</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="n">hook_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hints</span> <span class="o">=</span> <span class="n">hook_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">allowed_hookhints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllowedHookHints</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getHookHintsDict</span><span class="p">()[</span><span class="s1">&#39;_ALL_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span><span class="p">[</span><span class="s1">&#39;_NOHINTS_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">hint</span> <span class="ow">in</span> <span class="n">hints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hint</span> <span class="ow">in</span> <span class="n">allowed_hookhints</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_getHookHintsDict</span><span class="p">()[</span><span class="s1">&#39;_ALL_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">for</span> <span class="n">hint</span> <span class="ow">in</span> <span class="n">hints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hint</span> <span class="ow">in</span> <span class="n">allowed_hookhints</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span><span class="p">[</span><span class="n">hint</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span><span class="p">[</span><span class="n">hint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">hook</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hooks (callables) attached to the macro object together with the</span>
<span class="sd">        hook places (places where they will be called).</span>

<span class="sd">        :getter: Return all hooks attached to the macro object (including</span>
<span class="sd">            general hooks).</span>
<span class="sd">        :setter: Set hooks to the object. **This may override eventual</span>
<span class="sd">            general hooks.**</span>
<span class="sd">            Use :meth:`~sardana.macroserver.macro.Hookable.appendHook`</span>
<span class="sd">            if the general hooks want to be kept. For backwards compatibility</span>
<span class="sd">            accepts hook in the :obj:`list`\&lt;callable\&gt; format.</span>
<span class="sd">        :type: :obj:`list`\&lt;:obj:`tuple`\&gt; where each tuple has two</span>
<span class="sd">            elements: callable and :obj:`list`\&lt;:obj:`str`\&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getHooks</span><span class="p">()</span>

    <span class="nd">@hooks</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets hooks. Internally two variables instance members are created:</span>

<span class="sd">        - _hooks (list&lt;callable,list&lt;str&gt;&gt;) (will be a tuple regardless of</span>
<span class="sd">          what was passed)</span>
<span class="sd">        - _hookHintsDict (dict&lt;str,list&gt;) a dict of key=hint and value=list</span>
<span class="sd">          of hooks with that hint. _hookHintsDict also stores two special</span>
<span class="sd">          keys: &quot;_ALL_&quot;: which contains all the hooks &quot;_NOHINTS_&quot;: which</span>
<span class="sd">          contains the hooks that don&#39;t provide hints</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hooks</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;the hooks must be passed as a list&lt;callable,list&lt;str&gt;&gt;&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;This macro defines its own hooks. Previously defined &quot;</span>
                   <span class="s2">&quot;hooks, including the general ones, would be only called &quot;</span>
                   <span class="s2">&quot;if these own hooks were added using the appendHook &quot;</span>
                   <span class="s2">&quot;method or appended to the self.hooks.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># store self._hooks, making sure it is of type:</span>
        <span class="c1"># list&lt;callable,list&lt;str&gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># we assume that hooks is a list&lt;callable&gt;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="p">[]))</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Deprecation warning: hooks should be set with a&quot;</span>
                       <span class="s2">&quot; list of hints. See Hookable API docs&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># delete _hookHintsDict to force its recreation on the next access</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_hookHintsDict&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span>
        <span class="c1"># create _hookHintsDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getHookHintsDict</span><span class="p">()[</span><span class="s1">&#39;_ALL_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nohints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span><span class="p">[</span><span class="s1">&#39;_NOHINTS_&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">hints</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nohints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">hint</span> <span class="ow">in</span> <span class="n">hints</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span><span class="p">[</span><span class="n">hint</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_hookHintsDict</span><span class="p">[</span><span class="n">hint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">hook</span><span class="p">]</span></div>


<span class="k">class</span> <span class="nc">ExecMacroHook</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A speciallized callable hook for executing a sub macro inside another</span>
<span class="sd">    macro as a hook.</span>

<span class="sd">    In order to attach macro with parameters pass all of them in form of</span>
<span class="sd">    a list (repeat parameters are allowed) e.g.</span>
<span class="sd">    - ExecMacroHook(self, &quot;ct&quot;, 0.1)</span>
<span class="sd">    - ExecMacroHook(self, [&quot;ct&quot;, 0.1])</span>
<span class="sd">    - ExecMacroHook(self, &quot;mv&quot;, &quot;mot01&quot;, 0, &quot;mot02&quot;, 0)</span>
<span class="sd">    - ExecMacroHook(self, &quot;mv&quot;, [[&quot;mot01&quot;, 0], [&quot;mot02&quot;, 0]])</span>
<span class="sd">    - ExecMacroHook(self, [&quot;mv&quot;, [[&quot;mot01&quot;, 0], [&quot;mot02&quot;, 0]]])</span>
<span class="sd">    The API basically follows the :meth:`Macro.execMacro`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_macro</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_obj_wr</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent_macro</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pars</span> <span class="o">=</span> <span class="n">pars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_opts</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">macro_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_obj_wr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macro_obj</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_pars</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_opts</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MacroFinder</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_obj_wr</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">macro_obj</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">macro_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_obj_wr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">p_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_obj</span>
            <span class="n">p_m</span><span class="o">.</span><span class="n">syncLog</span><span class="p">()</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parent_macro&#39;</span><span class="p">:</span> <span class="n">p_m</span><span class="p">,</span>
                    <span class="s1">&#39;executor&#39;</span><span class="p">:</span> <span class="n">p_m</span><span class="o">.</span><span class="n">executor</span><span class="p">}</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
            <span class="n">eargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">eargs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">p_m</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="o">*</span><span class="n">eargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span>


<span class="k">def</span> <span class="nf">mAPI</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wraps the given Macro method as being protected by the stop procedure.</span>
<span class="sd">    To be used by the :class:`Macro` as a decorator for all methods.</span>
<span class="sd">    :param: macro method</span>
<span class="sd">    :return: wrapped macro method&quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingStop</span><span class="p">():</span>
            <span class="n">is_macro_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_thread</span> <span class="o">==</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shouldRaiseStopException</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">is_macro_th</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setProcessingStop</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">_waitStopDone</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">StopException</span><span class="p">(</span><span class="s2">&quot;stopped before calling </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingStop</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shouldRaiseStopException</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">is_macro_th</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setProcessingStop</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">_waitStopDone</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">StopException</span><span class="p">(</span><span class="s2">&quot;stopped after calling </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">return</span> <span class="n">new_fn</span>


<div class="viewcode-block" id="macro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.macro">[docs]</a><span class="k">class</span> <span class="nc">macro</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class designed to decorate a python function to transform it into a</span>
<span class="sd">    macro. Examples::</span>

<span class="sd">        @macro()</span>
<span class="sd">        def my_macro1(self):</span>
<span class="sd">            self.output(&quot;Executing %s&quot;, self.getName())</span>

<span class="sd">        @macro([ [&quot;moveable&quot;, Type.Moveable, None, &quot;motor to watch&quot;] ])</span>
<span class="sd">        def where_moveable(self, moveable):</span>
<span class="sd">            self.output(&quot;Moveable %s is at %s&quot;, moveable.getName(), moveable.getPosition())&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_def</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result_def</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">interactive</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_def</span> <span class="o">=</span> <span class="n">param_def</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_def</span> <span class="o">=</span> <span class="n">result_def</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="n">hints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="n">interactive</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">macro_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">param_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_def</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">result_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_def</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span>
        <span class="n">fn</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span>
        <span class="k">return</span> <span class="n">fn</span></div>


<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="n">imacro</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">macro</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="Macro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro">[docs]</a><span class="k">class</span> <span class="nc">Macro</span><span class="p">(</span><span class="n">Logger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The Macro base class. All macros should inherit directly or indirectly</span>
<span class="sd">    from this class.&quot;&quot;&quot;</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Init</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Init</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Running</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Running</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Pause</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Standby</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Stop</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Standby</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Fault</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Fault</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Finished</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">On</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Ready</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">On</span>

    <span class="c1">#: internal variable</span>
    <span class="n">Abort</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">On</span>

    <span class="c1">#: internal variable</span>
    <span class="ne">Exception</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">Alarm</span>

    <span class="c1">#: Constant used to specify all elements in a parameter</span>
    <span class="n">All</span> <span class="o">=</span> <span class="n">ParamType</span><span class="o">.</span><span class="n">All</span>

    <span class="c1">#: internal variable</span>
    <span class="n">BlockStart</span> <span class="o">=</span> <span class="s1">&#39;&lt;BLOCK&gt;&#39;</span>

    <span class="c1">#: internal variable</span>
    <span class="n">BlockFinish</span> <span class="o">=</span> <span class="s1">&#39;&lt;/BLOCK&gt;&#39;</span>

    <span class="c1">#: This property holds the macro parameter description.</span>
    <span class="c1">#: It consists of a sequence of parameter information objects.</span>
    <span class="c1">#: A parameter information object is either:</span>
    <span class="c1">#:</span>
    <span class="c1">#:    #. a simple parameter object</span>
    <span class="c1">#:    #. a parameter repetition object</span>
    <span class="c1">#:</span>
    <span class="c1">#: A simple parameter object is a sequence of:</span>
    <span class="c1">#:</span>
    <span class="c1">#:    #. a string representing the parameter name</span>
    <span class="c1">#:    #. a member of :obj:`Macro.Type` representing the parameter data type</span>
    <span class="c1">#:    #. a default value for the parameter or None if there is no default value</span>
    <span class="c1">#:    #. a string with the parameter description</span>
    <span class="c1">#:</span>
    <span class="c1">#: Example::</span>
    <span class="c1">#:</span>
    <span class="c1">#:     param_def = ( (&#39;value&#39;, Type.Float, None, &#39;a float parameter&#39; ) )</span>
    <span class="c1">#:</span>
    <span class="c1">#: A parameter repetition object is a sequence of:</span>
    <span class="c1">#:</span>
    <span class="c1">#:    #. a string representing the parameter repetition name</span>
    <span class="c1">#:    #. a sequence of parameter information objects</span>
    <span class="c1">#:    #. a dictionary representing the parameter repetition semantics or None</span>
    <span class="c1">#:       to use the default parameter repetition semantics. Dictionary keys are:</span>
    <span class="c1">#:</span>
    <span class="c1">#:           * *min* - integer representing minimum number of repetitions or None</span>
    <span class="c1">#:             for no minimum.</span>
    <span class="c1">#:           * *max* - integer representing maximum number of repetitions or None</span>
    <span class="c1">#:             for no maximum.</span>
    <span class="c1">#:</span>
    <span class="c1">#:       Default parameter repetition semantics is ``{ &#39;min&#39;: 1, &#39;max&#39; : None }``</span>
    <span class="c1">#:       (in other words, &quot;at least one repetition&quot; semantics)</span>
    <span class="c1">#:</span>
    <span class="c1">#: Example::</span>
    <span class="c1">#:</span>
    <span class="c1">#:     param_def = (</span>
    <span class="c1">#:         ( &#39;motor_list&#39;, ( ( &#39;motor&#39;, Type.Motor, None, &#39;motor name&#39;) ), None, &#39;List of motors&#39;)</span>
    <span class="c1">#:     )</span>
    <span class="n">param_def</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#: This property holds the macro result description.</span>
    <span class="c1">#: It a single parameter information object.</span>
    <span class="c1">#:</span>
    <span class="c1">#: .. seealso:: :obj:`~sardana.macroserver.macro.Macro.param_def`</span>
    <span class="n">result_def</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#: Hints to give a client to perform special tasks.</span>
    <span class="c1">#: Example: scan macros give hints on the types of hooks they support. A</span>
    <span class="c1">#: :term:`GUI` can use this information to allow a scan to have sub-macros</span>
    <span class="c1">#: executed as hooks.</span>
    <span class="n">hints</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#: a set of mandatory environment variable names without which your macro</span>
    <span class="c1">#: cannot run</span>
    <span class="n">env</span> <span class="o">=</span> <span class="p">()</span>

    <span class="c1">#: decide if the macro should be able to receive input from the user</span>
    <span class="c1">#: [default: False]. A macro which asks input but has this flag set to False</span>
    <span class="c1">#: will print a warning message each time it is executed</span>
    <span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;as&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_pars</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_pars</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stopped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processingStop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_macro</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent_macro&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;executor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_line</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;macro_line&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interactive&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span> <span class="o">=</span> <span class="s2">&quot;Macro &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span>
                              <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">),</span>
                              <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span> <span class="o">=</span> <span class="n">PauseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">log_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_macro</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">log_parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reserveObjs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="c1"># @name Official Macro API</span>
    <span class="c1">#  This list contains the set of methods that are part of the official macro</span>
    <span class="c1">#  API. This means that they can be safely used inside any macro.</span>
    <span class="c1">#@{</span>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Methods to be implemented by the actual macros</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

<div class="viewcode-block" id="Macro.run"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Runs the macro. **Overwrite MANDATORY!** Default implementation</span>
<span class="sd">        raises RuntimeError.</span>

<span class="sd">        :raises: RuntimeError&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Macro </span><span class="si">%s</span><span class="s2"> does not implement run method&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span></div>

<div class="viewcode-block" id="Macro.prepare"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Prepare phase. Overwrite as necessary.</span>
<span class="sd">        Default implementation does nothing&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Macro.on_abort"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.on_abort">[docs]</a>    <span class="k">def</span> <span class="nf">on_abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Hook executed when an abort occurs.</span>
<span class="sd">        Overwrite as necessary. Default implementation does nothing&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Macro.on_pause"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.on_pause">[docs]</a>    <span class="k">def</span> <span class="nf">on_pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Hook executed when a pause occurs.</span>
<span class="sd">        Overwrite as necessary. Default implementation does nothing&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Macro.on_stop"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.on_stop">[docs]</a>    <span class="k">def</span> <span class="nf">on_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Hook executed when a stop occurs.</span>
<span class="sd">        Overwrite as necessary. Default implementation calls</span>
<span class="sd">        :meth:`~Macro.on_abort`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_abort</span><span class="p">()</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># API</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.checkPoint"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.checkPoint">[docs]</a>    <span class="k">def</span> <span class="nf">checkPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Empty method that just performs a checkpoint. This can be used</span>
<span class="sd">        to check for the stop. Usually you won&#39;t need to call this method&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.pausePoint"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.pausePoint">[docs]</a>    <span class="k">def</span> <span class="nf">pausePoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Will establish a pause point where called. If an external source as</span>
<span class="sd">        invoked a pause then, when this this method is called, it will be block</span>
<span class="sd">        until the external source calls resume.</span>
<span class="sd">        You may want to call this method if your macro takes a considerable time</span>
<span class="sd">        to execute and you may whish to pause it at some time. Example::</span>

<span class="sd">            for i in range(10000):</span>
<span class="sd">                time.sleep(0.1)</span>
<span class="sd">                self.output(&quot;At step %d/10000&quot;, i)</span>
<span class="sd">                self.pausePoint()</span>

<span class="sd">        :param timeout:</span>
<span class="sd">            timeout in seconds [default: None, meaning wait forever]</span>
<span class="sd">        :type timeout: :obj:`float`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pausePoint</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">macros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        An object that contains all macro classes as members. With</span>
<span class="sd">        the returning object you can invoke other macros. Example::</span>

<span class="sd">            m = self.macros.ascan(&#39;th&#39;, &#39;0&#39;, &#39;90&#39;, &#39;10&#39;, &#39;2&#39;)</span>
<span class="sd">            scan_data = m.data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkPoint</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_macros&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_macros</span> <span class="o">=</span> <span class="n">MacroFinder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macros</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroStatus"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroStatus">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the current macro status. Macro status is a :obj:`dict` where</span>
<span class="sd">        keys are the strings:</span>

<span class="sd">            * *id* - macro ID (internal usage only)</span>
<span class="sd">            * *range* - the full progress range of a macro (usually a</span>
<span class="sd">              :obj:`tuple` of two numbers (0, 100))</span>
<span class="sd">            * *state* - the current macro state, a string which can have values</span>
<span class="sd">              *start*, *step*, *stop* and *abort*</span>
<span class="sd">            * *step* - the current step in macro. Should be a value inside the</span>
<span class="sd">              allowed macro range</span>

<span class="sd">        :return: the macro status</span>
<span class="sd">        :rtype: :obj:`dict`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_status</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getName"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns this macro name</span>

<span class="sd">        :return: the macro name</span>
<span class="sd">        :rtype: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getID"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getID">[docs]</a>    <span class="k">def</span> <span class="nf">getID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns this macro id</span>

<span class="sd">        :return: the macro id</span>
<span class="sd">        :rtype: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getParentMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getParentMacro">[docs]</a>    <span class="k">def</span> <span class="nf">getParentMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the parent macro reference.</span>

<span class="sd">        :return: the parent macro reference or None if there is no parent macro</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.macro.Macro`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_macro</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getDescription"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns a string description of the macro.</span>

<span class="sd">        :return: the string description of the macro</span>
<span class="sd">        :rtype:  :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getParameters"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns a the macro parameters. It returns a list containning the</span>
<span class="sd">        parameters with which the macro was executed</span>

<span class="sd">        :return: the macro parameters</span>
<span class="sd">        :rtype: :obj:`list`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_pars</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getExecutor"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getExecutor">[docs]</a>    <span class="k">def</span> <span class="nf">getExecutor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the reference to the object that invoked this macro. Usually</span>
<span class="sd">        is a MacroExecutor object.</span>

<span class="sd">        :return: the reference to the object that invoked this macro</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.macromanager.MacroExecutor`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getDoorObj"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getDoorObj">[docs]</a>    <span class="k">def</span> <span class="nf">getDoorObj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the reference to the Door that invoked this macro.</span>

<span class="sd">        :return: the reference to the Door that invoked this macro.</span>
<span class="sd">        :rype: :class:`~sardana.macroserver.door.Door`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">getDoor</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getManager"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getManager">[docs]</a>    <span class="k">def</span> <span class="nf">getManager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the manager for this macro (usually a MacroServer)</span>

<span class="sd">        :return: the MacroServer</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.macroserver.MacroServer`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">manager</span></div>

    <span class="n">manager</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getManager</span><span class="p">)</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroServer"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroServer">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroServer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the MacroServer for this macro</span>

<span class="sd">        :return: the MacroServer</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.macroserver.MacroServer`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">macro_server</span></div>

    <span class="n">macro_server</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getMacroServer</span><span class="p">)</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getDoorName"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getDoorName">[docs]</a>    <span class="k">def</span> <span class="nf">getDoorName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the string with the name of the Door that invoked this macro.</span>

<span class="sd">        :return: the string with the name of the Door that invoked this macro.</span>
<span class="sd">        :rtype: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">name</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getCommand"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getCommand">[docs]</a>    <span class="k">def</span> <span class="nf">getCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the string used to execute the macro.</span>
<span class="sd">        Ex.: &#39;ascan M1 0 1000 100 0.8&#39;</span>

<span class="sd">        :return: the macro command.</span>
<span class="sd">        :rtype: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_pars</span><span class="p">]))</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getDateString"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getDateString">[docs]</a>    <span class="k">def</span> <span class="nf">getDateString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%a %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Helper method. Returns the current date in a string.</span>

<span class="sd">        :param time_format: the format in which the date should be</span>
<span class="sd">                            returned (optional, default value is</span>
<span class="sd">                            &#39;%a %b %d %H:%M:%S %Y&#39;</span>
<span class="sd">        :type time_format: :obj:`str`</span>
<span class="sd">        :return: the current date</span>
<span class="sd">        :rtype: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.outputDate"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.outputDate">[docs]</a>    <span class="k">def</span> <span class="nf">outputDate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%a %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Helper method. Outputs the current date into the output buffer</span>

<span class="sd">        :param time_format: (str) the format in which the date should be</span>
<span class="sd">                            returned (optional, default value is</span>
<span class="sd">                            &#39;%a %b %d %H:%M:%S %Y&#39;</span>
<span class="sd">        :type time_format: :obj:`str`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDateString</span><span class="p">(</span><span class="n">time_format</span><span class="o">=</span><span class="n">time_format</span><span class="p">))</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.sendRecordData"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.sendRecordData">[docs]</a>    <span class="k">def</span> <span class="nf">sendRecordData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Sends the given data to the RecordData attribute of the Door</span>

<span class="sd">        :param data: (sequence) the data to be sent&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sendRecordData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">codec</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_sendRecordData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">sendRecordData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="n">codec</span><span class="p">)</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.plot"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Sends the plot command to the client using the &#39;RecordData&#39; DevEncoded</span>
<span class="sd">        attribute. The data is encoded using the pickle -&gt; BZ2 codec.</span>

<span class="sd">        :param args: the plotting args</span>
<span class="sd">        :param kwargs: the plotting keyword args&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<span class="c1">#        data = dict(args=args, kwargs=kwargs)</span>
<span class="c1">#        self.sendRecordData(data, codec=&#39;bz2_pickle_plot&#39;)</span>

    <span class="nd">@property</span>
    <span class="nd">@mAPI</span>
    <span class="k">def</span> <span class="nf">pylab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pylab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pylab</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pylab</span> <span class="o">=</span> <span class="n">pylab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">pylab</span>
        <span class="k">return</span> <span class="n">pylab</span>

    <span class="nd">@property</span>
    <span class="nd">@mAPI</span>
    <span class="k">def</span> <span class="nf">pyplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pyplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyplot</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pyplot</span> <span class="o">=</span> <span class="n">pyplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">pyplot</span>
        <span class="k">return</span> <span class="n">pyplot</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getData"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the data produced by the macro.</span>

<span class="sd">        :raises: Exception if no data has been set before on this macro</span>

<span class="sd">        :return: the data produced by the macro</span>
<span class="sd">        :rtype: object&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_data&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Macro &#39;</span><span class="si">%s</span><span class="s2">&#39; does not produce any data&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.setData"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setData">[docs]</a>    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Sets the data for this macro</span>

<span class="sd">        :param object data: new data to be associated with this macro&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span></div>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getData</span><span class="p">,</span> <span class="n">setData</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;macro data&quot;</span><span class="p">)</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.print"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.print">[docs]</a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Prints a message. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :func:`print`. Example::</span>

<span class="sd">            self.print(&quot;this is a print for macro&quot;, self.getName())</span>

<span class="sd">        .. note::</span>
<span class="sd">            you will need python &gt;= 3.0. If you have python 2.x then you must</span>
<span class="sd">            include at the top of your file the statement::</span>

<span class="sd">                from __future__ import print_function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fd</span> <span class="ow">in</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.input"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.input">[docs]</a>    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        If args is present, it is written to standard output without a trailing</span>
<span class="sd">        newline. The function then reads a line from input, converts it to a</span>
<span class="sd">        string (stripping a trailing newline), and returns that.</span>

<span class="sd">        Depending on which type of application you are running, some of the</span>
<span class="sd">        keywords may have no effect (ex.: spock ignores decimals when a number</span>
<span class="sd">        is asked).</span>

<span class="sd">        Recognized kwargs:</span>

<span class="sd">            - data_type : [default: Type.String] specific input type. Can also</span>
<span class="sd">              specify a sequence of strings with possible values (use</span>
<span class="sd">              allow_multiple=True to say multiple values can be selected)</span>
<span class="sd">            - key : [default: no default] variable/label to assign to this input</span>
<span class="sd">            - unit: [default: no default] units (useful for GUIs)</span>
<span class="sd">            - timeout : [default: None, meaning wait forever for input]</span>
<span class="sd">            - default_value : [default: None, meaning no default value]</span>
<span class="sd">              When given, it must be compatible with data_type</span>
<span class="sd">            - allow_multiple : [default: False] in case data_type is a</span>
<span class="sd">              sequence of values, allow multiple selection</span>
<span class="sd">            - minimum : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>
<span class="sd">            - maximum : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>
<span class="sd">            - step : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>
<span class="sd">            - decimals : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>

<span class="sd">        Examples::</span>

<span class="sd">            device_name = self.input(&quot;Which device name (%s)?&quot;, &quot;tab separated&quot;)</span>

<span class="sd">            point_nb = self.input(&quot;How many points?&quot;, data_type=Type.Integer)</span>

<span class="sd">            calc_mode = self.input(&quot;Which algorithm?&quot;, data_type=[&quot;Average&quot;, &quot;Integral&quot;, &quot;Sum&quot;],</span>
<span class="sd">                                   default_value=&quot;Average&quot;, allow_multiple=False)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Non interactive macro &#39;</span><span class="si">%s</span><span class="s2">&#39; is asking for input &quot;</span>
                         <span class="s2">&quot;(please set this macro interactive to True)&quot;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_mode</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_multiple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allow_multiple&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;macro_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;macro_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;macro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDoorObj</span><span class="p">()</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;default_value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;key&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> running in non attended mode was asked &quot;</span>
                                 <span class="s2">&quot;for input without default value or key. &quot;</span>
                                 <span class="s2">&quot;Returning None&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnv</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;default_value&#39;</span><span class="p">]</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.output"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.output">[docs]</a>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record a log message in this object&#39;s output. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.log`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.output(&quot;this is a print for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.log"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record a log message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.log`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.debug(logging.INFO, &quot;this is a info log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param level: the record level</span>
<span class="sd">        :type level: :obj:`int`</span>
<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.debug"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record a debug message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.debug`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.debug(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kw: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.info"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record an info message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.info`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.info(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.warning"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.warning">[docs]</a>    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record a warning message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.warning`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.warning(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.error"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record an error message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.error`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.error(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.critical"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.critical">[docs]</a>    <span class="k">def</span> <span class="nf">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record a critical message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.critical`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.critical(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.trace"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Record a trace message in this object&#39;s logger.</span>

<span class="sd">        :param msg: (str) the message to be recorded</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kw: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.traceback"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.traceback">[docs]</a>    <span class="k">def</span> <span class="nf">traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Logs the traceback with level TRACE on the macro logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.stack"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.stack">[docs]</a>    <span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Logs the stack with level TRACE on the macro logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.report"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Record a log message in the sardana report (if enabled) with default</span>
<span class="sd">        level **INFO**. The msg is the message format string, and the args are</span>
<span class="sd">        the arguments which are merged into msg using the string formatting</span>
<span class="sd">        operator. (Note that this means that you can use keywords in the</span>
<span class="sd">        format string, together with a single dictionary argument.)</span>

<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.debug` plus an optional</span>
<span class="sd">        level kwargs which has default value **INFO**</span>

<span class="sd">        Example::</span>

<span class="sd">            self.report(&quot;this is an official report of macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDoorObj</span><span class="p">()</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.flushOutput"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.flushOutput">[docs]</a>    <span class="k">def</span> <span class="nf">flushOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Flushes the output buffer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">flushOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroThread"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroThread">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroThread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the python thread where this macro is running</span>

<span class="sd">        :return: the python thread where this macro is running</span>
<span class="sd">        :rtype: threading.Thread&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_thread</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroThreadID"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroThreadID">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroThreadID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Returns the python thread id where this macro is running</span>

<span class="sd">        :return: the python thread id where this macro is running</span>
<span class="sd">        :rtype: :obj:`int`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMacroThread</span><span class="p">()</span><span class="o">.</span><span class="n">ident</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Hook helper API</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.createExecMacroHook"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.createExecMacroHook">[docs]</a>    <span class="k">def</span> <span class="nf">createExecMacroHook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_str_sequence</span><span class="p">,</span> <span class="n">parent_macro</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**.</span>
<span class="sd">        Creates a hook that executes the macro given as a sequence of strings</span>
<span class="sd">        where the first string is macro name and the following strings the</span>
<span class="sd">        macro parameters</span>

<span class="sd">        :param par_str_sequence: the macro parameters</span>
<span class="sd">        :param parent_macro:</span>
<span class="sd">            the parent macro object. If None is given (default) then the</span>
<span class="sd">            parent macro is this macro</span>

<span class="sd">        :return: a ExecMacroHook object (which is a callable object)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ExecMacroHook</span><span class="p">(</span><span class="n">parent_macro</span> <span class="ow">or</span> <span class="bp">self</span><span class="p">,</span> <span class="n">par_str_sequence</span><span class="p">)</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Handle child macro execution</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.createMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.createMacro">[docs]</a>    <span class="k">def</span> <span class="nf">createMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Create a new macro and prepare it for execution</span>
<span class="sd">        Several different parameter formats are supported::</span>

<span class="sd">            # several parameters:</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;, &#39;1.0&#39;)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[motor.getName(), &#39;0&#39;]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, motor.getName(), &#39;0&#39;) # backwards compatibility - see note</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, &#39;th&#39;, 0, 100, 10, 1.0)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[motor.getName(), 0]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, motor.getName(), 0) # backwards compatibility - see note</span>
<span class="sd">            th = self.getObj(&#39;th&#39;)</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, th, 0, 100, 10, 1.0)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[th, 0]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, th, 0) # backwards compatibility - see note</span>

<span class="sd">            # a sequence of parameters:</span>
<span class="sd">            self.execMacro([&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;, &#39;1.0&#39;)</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[motor.getName(), &#39;0&#39;]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, motor.getName(), &#39;0&#39;]) # backwards compatibility - see note</span>
<span class="sd">            self.execMacro((&#39;ascan&#39;, &#39;th&#39;, 0, 100, 10, 1.0))</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[motor.getName(), 0]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, motor.getName(), 0]) # backwards compatibility - see note</span>
<span class="sd">            th = self.getObj(&#39;th&#39;)</span>
<span class="sd">            self.execMacro([&#39;ascan&#39;, th, 0, 100, 10, 1.0])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[th, 0]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, th, 0]) # backwards compatibility - see note</span>


<span class="sd">            # a space separated string of parameters (this is not compatible</span>
<span class="sd">            # with multiple or nested repeat parameters, furthermore the repeat</span>
<span class="sd">            # parameter must be the last one):</span>
<span class="sd">            self.execMacro(&#39;ascan th 0 100 10 1.0&#39;)</span>
<span class="sd">            self.execMacro(&#39;mv %s 0&#39; % motor.getName())</span>

<span class="sd">        .. note:: From Sardana 2.0 the repeat parameter values must be passed</span>
<span class="sd">            as lists of items. An item of a repeat parameter containing more</span>
<span class="sd">            than one member is a list. In case when a macro defines only one</span>
<span class="sd">            repeat parameter and it is the last parameter, for the backwards</span>
<span class="sd">            compatibility reasons, the plain list of items&#39; members is allowed.</span>


<span class="sd">        :param pars: the command parameters as explained above</span>
<span class="sd">        :return:</span>
<span class="sd">            a sequence of two elements: the macro object and the result of</span>
<span class="sd">            preparing the macro</span>
<span class="sd">        :rtype: :obj:`tuple`\&lt;:class:`~sardana.macroserver.macro.Macro`\, seq&lt;obj&gt;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareMacro</span><span class="p">(</span><span class="o">*</span><span class="n">pars</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.prepareMacroObj"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.prepareMacroObj">[docs]</a>    <span class="k">def</span> <span class="nf">prepareMacroObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_name_or_klass</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Prepare a new macro for execution</span>

<span class="sd">        :param macro_name_or_klass name: name of the macro to be prepared or</span>
<span class="sd">                                         the macro class itself</span>
<span class="sd">        :param pars: list of parameter objects</span>
<span class="sd">        :param init_opts: keyword parameters for the macro constructor</span>
<span class="sd">        :param prepare_opts: keyword parameters for the macro prepare</span>

<span class="sd">        :return:</span>
<span class="sd">            a sequence of two elements: the macro object and the result of</span>
<span class="sd">            preparing the macro&quot;&quot;&quot;</span>
        <span class="c1"># sync our log before calling the child macro prepare in order to avoid</span>
        <span class="c1"># mixed outputs between this macro and the child macro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syncLog</span><span class="p">()</span>
        <span class="n">init_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parent_macro&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">prepareMacroObj</span><span class="p">(</span><span class="n">macro_name_or_klass</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span>
                                             <span class="n">init_opts</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.prepareMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.prepareMacro">[docs]</a>    <span class="k">def</span> <span class="nf">prepareMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Prepare a new macro for execution</span>
<span class="sd">        Several different parameter formats are supported::</span>

<span class="sd">            # several parameters:</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;, &#39;1.0&#39;)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[motor.getName(), &#39;0&#39;]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, motor.getName(), &#39;0&#39;) # backwards compatibility - see note</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, &#39;th&#39;, 0, 100, 10, 1.0)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[motor.getName(), 0]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, motor.getName(), 0) # backwards compatibility - see note</span>
<span class="sd">            th = self.getObj(&#39;th&#39;)</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, th, 0, 100, 10, 1.0)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[th, 0]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, th, 0) # backwards compatibility - see note</span>

<span class="sd">            # a sequence of parameters:</span>
<span class="sd">            self.execMacro([&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;, &#39;1.0&#39;])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[motor.getName(), &#39;0&#39;]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, motor.getName(), &#39;0&#39;]) # backwards compatibility - see note</span>
<span class="sd">            self.execMacro((&#39;ascan&#39;, &#39;th&#39;, 0, 100, 10, 1.0))</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[motor.getName(), 0]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, motor.getName(), 0]) # backwards compatibility - see note</span>
<span class="sd">            th = self.getObj(&#39;th&#39;)</span>
<span class="sd">            self.execMacro([&#39;ascan&#39;, th, 0, 100, 10, 1.0])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[th, 0]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, th, 0]) # backwards compatibility - see note</span>

<span class="sd">            # a space separated string of parameters (this is not compatible</span>
<span class="sd">            # with multiple or nested repeat parameters, furthermore the repeat</span>
<span class="sd">            # parameter must be the last one):</span>
<span class="sd">            self.execMacro(&#39;ascan th 0 100 10 1.0&#39;)</span>
<span class="sd">            self.execMacro(&#39;mv %s 0&#39; % motor.getName())</span>

<span class="sd">        .. note:: From Sardana 2.0 the repeat parameter values must be passed</span>
<span class="sd">            as lists of items. An item of a repeat parameter containing more</span>
<span class="sd">            than one member is a list. In case when a macro defines only one</span>
<span class="sd">            repeat parameter and it is the last parameter, for the backwards</span>
<span class="sd">            compatibility reasons, the plain list of items&#39; members is allowed.</span>

<span class="sd">        :param args: the command parameters as explained above</span>
<span class="sd">        :param kwargs: keyword optional parameters for prepare</span>
<span class="sd">        :return:</span>
<span class="sd">            a sequence of two elements: the macro object and the result of</span>
<span class="sd">            preparing the macro</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sync our log before calling the child macro prepare in order to avoid</span>
        <span class="c1"># mixed outputs between this macro and the child macro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syncLog</span><span class="p">()</span>
        <span class="n">init_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parent_macro&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">prepareMacro</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">init_opts</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.runMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.runMacro">[docs]</a>    <span class="k">def</span> <span class="nf">runMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Runs the macro. This the lower level version of</span>
<span class="sd">        :meth:`~sardana.macroserver.macro.Macro.execMacro`. The method only</span>
<span class="sd">        returns after the macro is completed or an exception is thrown.</span>
<span class="sd">        It should be used instead of execMacro when some operation needs to</span>
<span class="sd">        be done between the macro preparation and the macro execution.</span>
<span class="sd">        Example::</span>

<span class="sd">            macro = self.prepareMacro(&quot;mymacro&quot;, &quot;myparam&quot;)</span>
<span class="sd">            self.do_my_stuff_with_macro(macro)</span>
<span class="sd">            self.runMacro(macro)</span>

<span class="sd">        :param macro_obj: macro object</span>
<span class="sd">        :return: macro result&quot;&quot;&quot;</span>
        <span class="c1"># sync our log before calling the child macro prepare in order to avoid</span>
        <span class="c1"># mixed outputs between this macro and the child macro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syncLog</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macro_obj</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.execMacroObj"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.execMacroObj">[docs]</a>    <span class="k">def</span> <span class="nf">execMacroObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Execute a macro in this macro. The method only returns</span>
<span class="sd">        after the macro is completed or an exception is thrown. This is a</span>
<span class="sd">        higher level version of runMacro method. It is the same as::</span>

<span class="sd">            macro = self.prepareMacroObjs(name, *args, **kwargs)</span>
<span class="sd">            self.runMacro(macro)</span>
<span class="sd">            return macro</span>

<span class="sd">        :param name: name of the macro to be prepared</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param args: list of parameter objects</span>
<span class="sd">        :param kwargs: list of keyword parameters</span>

<span class="sd">        :return: a macro object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing macro: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">macro_obj</span><span class="p">,</span> <span class="n">prepare_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareMacroObj</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macro_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">macro_obj</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.execMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.execMacro">[docs]</a>    <span class="k">def</span> <span class="nf">execMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Execute a macro in this macro. The method only</span>
<span class="sd">        returns after the macro is completed or an exception is thrown. Several</span>
<span class="sd">        different parameter formats are supported::</span>

<span class="sd">            # several parameters:</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;, &#39;1.0&#39;)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[motor.getName(), &#39;0&#39;]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, motor.getName(), &#39;0&#39;) # backwards compatibility - see note</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, &#39;th&#39;, 0, 100, 10, 1.0)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [[motor.getName(), 0]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, motor.getName(), 0) # backwards compatibility - see note</span>
<span class="sd">            th = self.getObj(&#39;th&#39;)</span>
<span class="sd">            self.execMacro(&#39;ascan&#39;, th, 0, 100, 10, 1.0)</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, [th, 0]])</span>
<span class="sd">            self.execMacro(&#39;mv&#39;, th, 0) # backwards compatibility - see note</span>

<span class="sd">            # a sequence of parameters:</span>
<span class="sd">            self.execMacro([&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;, &#39;1.0&#39;)</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[motor.getName(), &#39;0&#39;]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, motor.getName(), &#39;0&#39;]) # backwards compatibility - see note</span>
<span class="sd">            self.execMacro((&#39;ascan&#39;, &#39;th&#39;, 0, 100, 10, 1.0))</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[motor.getName(), 0]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, motor.getName(), 0]) # backwards compatibility - see note</span>
<span class="sd">            th = self.getObj(&#39;th&#39;)</span>
<span class="sd">            self.execMacro([&#39;ascan&#39;, th, 0, 100, 10, 1.0])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, [[th, 0]]])</span>
<span class="sd">            self.execMacro([&#39;mv&#39;, th, 0]) # backwards compatibility - see note</span>

<span class="sd">            # a space separated string of parameters (this is not compatible</span>
<span class="sd">            # with multiple or nested repeat parameters, furthermore the repeat</span>
<span class="sd">            # parameter must be the last one):</span>
<span class="sd">            self.execMacro(&#39;ascan th 0 100 10 1.0&#39;)</span>
<span class="sd">            self.execMacro(&#39;mv %s 0&#39; % motor.getName())</span>

<span class="sd">        .. note:: From Sardana 2.0 the repeat parameter values must be passed</span>
<span class="sd">            as lists of items. An item of a repeat parameter containing more</span>
<span class="sd">            than one member is a list. In case when a macro defines only one</span>
<span class="sd">            repeat parameter and it is the last parameter, for the backwards</span>
<span class="sd">            compatibility reasons, the plain list of items&#39; members is allowed.</span>

<span class="sd">        :param pars: the command parameters as explained above</span>

<span class="sd">        :return: a macro object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># obtaining macro name</span>
        <span class="n">macro_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">arg0</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">StringTypes</span><span class="p">:</span>
                <span class="c1"># dealing with sth like args = (&#39;ascan th 0 100 10 1.0&#39;,)</span>
                <span class="n">macro_name</span> <span class="o">=</span> <span class="n">arg0</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">operator</span><span class="o">.</span><span class="n">isSequenceType</span><span class="p">(</span><span class="n">arg0</span><span class="p">):</span>
                <span class="c1"># dealing with sth like args = ([&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;,</span>
                <span class="c1"># &#39;10&#39;, &#39;1.0&#39;],)</span>
                <span class="n">macro_name</span> <span class="o">=</span> <span class="n">arg0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># dealing with sth like args = (&#39;ascan&#39;, &#39;th&#39;, &#39;0&#39;, &#39;100&#39;, &#39;10&#39;,</span>
            <span class="c1"># &#39;1.0&#39;)</span>
            <span class="n">macro_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing macro: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">macro_name</span><span class="p">)</span>
        <span class="n">macro_obj</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareMacro</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macro_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">macro_obj</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># taurus helpers</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getTangoFactory"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getTangoFactory">[docs]</a>    <span class="k">def</span> <span class="nf">getTangoFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Helper method that returns the tango factory.</span>

<span class="sd">        :return: the tango factory singleton</span>
<span class="sd">        :rtype: :class:`~taurus.core.tango.TangoFactory`&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">taurus</span>
        <span class="k">return</span> <span class="n">taurus</span><span class="o">.</span><span class="n">Factory</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getDevice"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getDevice">[docs]</a>    <span class="k">def</span> <span class="nf">getDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Helper method that returns the device for the given</span>
<span class="sd">        device name</span>

<span class="sd">        :return: the taurus device for the given device name</span>
<span class="sd">        :rtype: :class:`~taurus.core.TaurusDevice`&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">taurus</span>
        <span class="k">return</span> <span class="n">taurus</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">dev_name</span><span class="p">)</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Handle parameter objects</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.setLogBlockStart"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setLogBlockStart">[docs]</a>    <span class="k">def</span> <span class="nf">setLogBlockStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Specifies the begining of a block of data. Basically</span>
<span class="sd">        it outputs the &#39;BLOCK&#39; tag&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">Macro</span><span class="o">.</span><span class="n">BlockStart</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.setLogBlockFinish"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setLogBlockFinish">[docs]</a>    <span class="k">def</span> <span class="nf">setLogBlockFinish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Specifies the end of a block of data. Basically it</span>
<span class="sd">        outputs the &#39;/BLOCK&#39; tag&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">Macro</span><span class="o">.</span><span class="n">BlockFinish</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.outputBlock"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.outputBlock">[docs]</a>    <span class="k">def</span> <span class="nf">outputBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Sends an line tagged as a block to the output</span>

<span class="sd">        :param :obj:`str` line: line to be sent&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">elif</span> <span class="n">operator</span><span class="o">.</span><span class="n">isSequenceType</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Macro</span><span class="o">.</span><span class="n">BlockStart</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">Macro</span><span class="o">.</span><span class="n">BlockFinish</span><span class="p">))</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Handle parameter objects</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getPools"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getPools">[docs]</a>    <span class="k">def</span> <span class="nf">getPools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns the list of known device pools.</span>

<span class="sd">        :return: the list of known device pools</span>
<span class="sd">        :rtype: seq&lt;Pool&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_pools</span><span class="p">()</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Handle parameter objects</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.addObj"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.addObj">[docs]</a>    <span class="k">def</span> <span class="nf">addObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Adds the given object to the list of controlled</span>
<span class="sd">        objects of this macro. In practice it means that if a stop is</span>
<span class="sd">        executed the stop method of the given object will be called.</span>

<span class="sd">        :param obj: the object to be controlled</span>
<span class="sd">        :type obj: object</span>
<span class="sd">        :param priority:</span>
<span class="sd">            wheater or not reserve with priority [default: 0 meaning no</span>
<span class="sd">            priority ]</span>
<span class="sd">        :type priority: :obj:`int`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">reserveObj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.addObjs"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.addObjs">[docs]</a>    <span class="k">def</span> <span class="nf">addObjs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Adds the given objects to the list of controlled</span>
<span class="sd">        objects of this macro. In practice it means that if a stop is</span>
<span class="sd">        executed the stop method of the given object will be called.</span>

<span class="sd">        :param obj_list: list of objects to be controlled</span>
<span class="sd">        :type obj_list: :obj:`collections.Sequence`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObj</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div>

<div class="viewcode-block" id="Macro.returnObj"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.returnObj">[docs]</a>    <span class="k">def</span> <span class="nf">returnObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the given objects to the list of controlled objects of this</span>
<span class="sd">        macro.</span>

<span class="sd">        :param obj: object to be released from the control</span>
<span class="sd">        :rtype: object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">returnObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getObj"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getObj">[docs]</a>    <span class="k">def</span> <span class="nf">getObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">reserve</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Gets the object of the given type belonging to the</span>
<span class="sd">        given pool with the given name. The object (if found) will automatically</span>
<span class="sd">        become controlled by the macro.</span>

<span class="sd">        :raises: MacroWrongParameterType if name is not a string</span>
<span class="sd">        :raises: AttributeError if more than one matching object is found</span>

<span class="sd">        :param name:</span>
<span class="sd">            string representing the name of the object. Can be a regular</span>
<span class="sd">            expression</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param type_class:</span>
<span class="sd">            the type of object [default: All]</span>
<span class="sd">        :param subtype:</span>
<span class="sd">            a string representing the subtype [default: All]</span>
<span class="sd">            Ex.: if type_class is Type.ExpChannel, subtype could be</span>
<span class="sd">            &#39;CTExpChannel&#39;</span>
<span class="sd">        :param pool:</span>
<span class="sd">            the pool to which the object should belong [default: All]</span>
<span class="sd">        :param reserve:</span>
<span class="sd">            automatically reserve the object for this macro [default: True]</span>

<span class="sd">        :return: the object or None if no compatible object is found&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buildWrongParamExp</span><span class="p">(</span><span class="s2">&quot;getObj&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                           <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">type_class</span><span class="p">,</span>
                                   <span class="n">subtype</span><span class="o">=</span><span class="n">subtype</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">and</span> <span class="n">reserve</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getObjs"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getObjs">[docs]</a>    <span class="k">def</span> <span class="nf">getObjs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">reserve</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Gets the objects of the given type belonging to the</span>
<span class="sd">           given pool with the given names. The objects (if found) will</span>
<span class="sd">           automatically become controlled by the macro.</span>

<span class="sd">           :param names: a string or a sequence of strings representing the</span>
<span class="sd">                         names of the objects. Each string can be a regular</span>
<span class="sd">                         expression</span>
<span class="sd">           :param type_class: the type of object (optional, default is All).</span>
<span class="sd">                             Example: Type.Motor, Type.ExpChannel</span>
<span class="sd">           :param subtype: a string representing the subtype (optional,</span>
<span class="sd">                           default is All)</span>
<span class="sd">                           Ex.: if type_class is Type.ExpChannel, subtype could</span>
<span class="sd">                           be &#39;CTExpChannel&#39;</span>
<span class="sd">           :param pool: the pool to which the object should belong (optional,</span>
<span class="sd">                        default is All)</span>
<span class="sd">           :param reserve: automatically reserve the object for this macro</span>
<span class="sd">                           (optional, default is True)</span>

<span class="sd">           :return: a list of objects or empty list if no compatible object is</span>
<span class="sd">                    found&quot;&quot;&quot;</span>
        <span class="n">obj_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_objects</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">type_class</span><span class="p">,</span>
                                         <span class="n">subtype</span><span class="o">=</span><span class="n">subtype</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reserve</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObjs</span><span class="p">(</span><span class="n">obj_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_list</span> <span class="ow">or</span> <span class="p">[]</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.findObjs"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.findObjs">[docs]</a>    <span class="k">def</span> <span class="nf">findObjs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">All</span><span class="p">,</span>
                 <span class="n">reserve</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Gets the objects of the given type belonging to the</span>
<span class="sd">        given pool with the given names. The objects (if found) will</span>
<span class="sd">        automatically become controlled by the macro.</span>

<span class="sd">        :param names:</span>
<span class="sd">            a string or a sequence of strings representing the names of the</span>
<span class="sd">            objects. Each string can be a regular expression</span>
<span class="sd">        :param type_class: the type of object (optional, default is All)</span>
<span class="sd">        :param subtype:</span>
<span class="sd">            a string representing the subtype [default: All]</span>
<span class="sd">            Ex.: if type_class is Type.ExpChannel, subtype could be</span>
<span class="sd">            &#39;CTExpChannel&#39;</span>
<span class="sd">        :param pool:</span>
<span class="sd">            the pool to which the object should belong [default: All]</span>
<span class="sd">        :param reserve:</span>
<span class="sd">            automatically reserve the object for this macro [default: True]</span>

<span class="sd">        :return:</span>
<span class="sd">            a list of objects or empty list if no compatible object is found&quot;&quot;&quot;</span>
        <span class="n">obj_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">type_class</span><span class="o">=</span><span class="n">type_class</span><span class="p">,</span>
                                          <span class="n">subtype</span><span class="o">=</span><span class="n">subtype</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reserve</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObjs</span><span class="p">(</span><span class="n">obj_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_list</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroNames"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroNames">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns a list of strings containing the names of all</span>
<span class="sd">        known macros</span>

<span class="sd">           :return: a sequence of macro names</span>
<span class="sd">           :rtype: seq&lt;:obj:`str`\&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_macro_names</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacros"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacros">[docs]</a>    <span class="k">def</span> <span class="nf">getMacros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns a sequence of</span>
<span class="sd">        :class:`~sardana.macroserver.msmetamacro.MacroClass`</span>
<span class="sd">        /:class:`~sardana.macroserver.msmetamacro.MacroFunction` objects for all</span>
<span class="sd">        known macros that obey the filter expression.</span>

<span class="sd">        :param filter:</span>
<span class="sd">            a regular expression for the macro name (optional, default is None</span>
<span class="sd">            meaning match all macros)</span>
<span class="sd">        :return:</span>
<span class="sd">            a sequence of :class:`~sardana.macroserver.msmetamacro.MacroClass`</span>
<span class="sd">            /:class:`~sardana.macroserver.msmetamacro.MacroFunction`</span>
<span class="sd">            objects</span>
<span class="sd">        :rtype: seq&lt;:class:`~sardana.macroserver.msmetamacro.MacroClass`</span>
<span class="sd">                /:class:`~sardana.macroserver.msmetamacro.MacroFunction`\&gt;&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_macros</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroLibraries"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroLibraries">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroLibraries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns a sequence of</span>
<span class="sd">        :class:`~sardana.macroserver.msmetamacro.MacroLibrary` objects for all</span>
<span class="sd">        known macros that obey the filter expression.</span>

<span class="sd">        :param filter:</span>
<span class="sd">            a regular expression for the macro library [default: None meaning</span>
<span class="sd">            match all macro libraries)</span>
<span class="sd">        :return:</span>
<span class="sd">            a sequence of :class:`~sardana.macroserver.msmetamacro.MacroLibrary`</span>
<span class="sd">            objects</span>
<span class="sd">        :rtype: seq&lt;:class:`~sardana.macroserver.msmetamacro.MacroLibrary`\&gt;&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_macro_libs</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroLibrary"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns a</span>
<span class="sd">        :class:`~sardana.macroserver.msmetamacro.MacroLibrary` object for the</span>
<span class="sd">        given library name.</span>

<span class="sd">        :param lib_name:</span>
<span class="sd">            library name</span>
<span class="sd">        :type lib_name: :obj:`str`</span>
<span class="sd">        :return:</span>
<span class="sd">            a macro library :class:`~sardana.macroserver.msmetamacro.MacroLibrary`</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.msmetamacro.MacroLibrary`&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_macro_lib</span><span class="p">(</span><span class="n">lib_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="n">getMacroLib</span> <span class="o">=</span> <span class="n">getMacroLibrary</span>
    <span class="n">getMacroLibs</span> <span class="o">=</span> <span class="n">getMacroLibraries</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMacroInfo"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMacroInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getMacroInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns the corresponding</span>
<span class="sd">        :class:`~sardana.macroserver.msmetamacro.MacroClass`</span>
<span class="sd">        /:class:`~sardana.macroserver.msmetamacro.MacroFunction` object.</span>

<span class="sd">        :param macro_name: a string with the desired macro name.</span>
<span class="sd">        :type macro_name: :obj:`str`</span>
<span class="sd">        :return:</span>
<span class="sd">            a :class:`~sardana.macroserver.msmetamacro.MacroClass`</span>
<span class="sd">            /:class:`~sardana.macroserver.msmetamacro.MacroFunction` object or</span>
<span class="sd">            None if the macro with the given name was not found</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.msmetamacro.MacroClass`</span>
<span class="sd">                /:class:`~sardana.macroserver.msmetamacro.MacroFunction`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_macro</span><span class="p">(</span><span class="n">macro_name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMotion"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMotion">[docs]</a>    <span class="k">def</span> <span class="nf">getMotion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">motion_source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns a new Motion object containing the given</span>
<span class="sd">        elements.</span>

<span class="sd">        :raises:</span>
<span class="sd">            Exception if no elements are defined or the elems is not recognized</span>
<span class="sd">            as valid, or an element is not found or an element appears more</span>
<span class="sd">            than once</span>

<span class="sd">        :param elems: list of moveable object names</span>
<span class="sd">        :param motion_source:</span>
<span class="sd">            obj or list of objects containing moveable elements. Usually this</span>
<span class="sd">            is a Pool object or a list of Pool objects (optional, default is</span>
<span class="sd">            None, meaning all known pools will be searched for the given</span>
<span class="sd">            moveable items</span>
<span class="sd">        :param read_only: not used. Reserved for future use</span>
<span class="sd">        :param cache: not used. Reserved for future use</span>

<span class="sd">        :return: a Motion object &quot;&quot;&quot;</span>

        <span class="n">decoupled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">decoupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnv</span><span class="p">(</span><span class="s2">&quot;MotionDecoupled&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnknownEnv</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_motion</span><span class="p">(</span><span class="n">elems</span><span class="p">,</span> <span class="n">motion_source</span><span class="o">=</span><span class="n">motion_source</span><span class="p">,</span>
                                      <span class="n">read_only</span><span class="o">=</span><span class="n">read_only</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                                      <span class="n">decoupled</span><span class="o">=</span><span class="n">decoupled</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">motion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObj</span><span class="p">(</span><span class="n">motion</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">motion</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getElementsWithInterface"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getElementsWithInterface">[docs]</a>    <span class="k">def</span> <span class="nf">getElementsWithInterface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_elements_with_interface</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getControllers"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getControllers">[docs]</a>    <span class="k">def</span> <span class="nf">getControllers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_controllers</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMoveables"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMoveables">[docs]</a>    <span class="k">def</span> <span class="nf">getMoveables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_moveables</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMotors"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMotors">[docs]</a>    <span class="k">def</span> <span class="nf">getMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_motors</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getPseudoMotors"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getPseudoMotors">[docs]</a>    <span class="k">def</span> <span class="nf">getPseudoMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_pseudo_motors</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getIORegisters"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getIORegisters">[docs]</a>    <span class="k">def</span> <span class="nf">getIORegisters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_io_registers</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMeasurementGroups"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMeasurementGroups">[docs]</a>    <span class="k">def</span> <span class="nf">getMeasurementGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_measurement_groups</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getExpChannels"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getExpChannels">[docs]</a>    <span class="k">def</span> <span class="nf">getExpChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_exp_channels</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getCounterTimers"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getCounterTimers">[docs]</a>    <span class="k">def</span> <span class="nf">getCounterTimers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_counter_timers</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.get0DExpChannels"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.get0DExpChannels">[docs]</a>    <span class="k">def</span> <span class="nf">get0DExpChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_0d_exp_channels</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.get1DExpChannels"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.get1DExpChannels">[docs]</a>    <span class="k">def</span> <span class="nf">get1DExpChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_1d_exp_channels</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.get2DExpChannels"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.get2DExpChannels">[docs]</a>    <span class="k">def</span> <span class="nf">get2DExpChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_2d_exp_channels</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getPseudoCounters"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getPseudoCounters">[docs]</a>    <span class="k">def</span> <span class="nf">getPseudoCounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_pseudo_counters</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getInstruments"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getInstruments">[docs]</a>    <span class="k">def</span> <span class="nf">getInstruments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_instruments</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getElementWithInterface"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getElementWithInterface">[docs]</a>    <span class="k">def</span> <span class="nf">getElementWithInterface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_element_with_interface</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getController"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getController">[docs]</a>    <span class="k">def</span> <span class="nf">getController</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_controller</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMoveable"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMoveable">[docs]</a>    <span class="k">def</span> <span class="nf">getMoveable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_moveable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMotor"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMotor">[docs]</a>    <span class="k">def</span> <span class="nf">getMotor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_motor</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getPseudoMotor"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getPseudoMotor">[docs]</a>    <span class="k">def</span> <span class="nf">getPseudoMotor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_pseudo_motor</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getIORegister"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getIORegister">[docs]</a>    <span class="k">def</span> <span class="nf">getIORegister</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_io_register</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getMeasurementGroup"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getMeasurementGroup">[docs]</a>    <span class="k">def</span> <span class="nf">getMeasurementGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_measurement_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getExpChannel"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getExpChannel">[docs]</a>    <span class="k">def</span> <span class="nf">getExpChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_exp_channel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getCounterTimer"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getCounterTimer">[docs]</a>    <span class="k">def</span> <span class="nf">getCounterTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_counter_timer</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.get0DExpChannel"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.get0DExpChannel">[docs]</a>    <span class="k">def</span> <span class="nf">get0DExpChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_0d_exp_channel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.get1DExpChannel"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.get1DExpChannel">[docs]</a>    <span class="k">def</span> <span class="nf">get1DExpChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_1d_exp_channel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.get2DExpChannel"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.get2DExpChannel">[docs]</a>    <span class="k">def</span> <span class="nf">get2DExpChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_2d_exp_channel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getPseudoCounter"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getPseudoCounter">[docs]</a>    <span class="k">def</span> <span class="nf">getPseudoCounter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_pseudo_counter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getInstrument"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">getInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_instrument</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Handle macro environment</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getEnv"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getEnv">[docs]</a>    <span class="k">def</span> <span class="nf">getEnv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">macro_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">door_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Gets the local environment matching the given</span>
<span class="sd">        parameters:</span>

<span class="sd">           - door_name and macro_name define the context where to look for</span>
<span class="sd">             the environment. If both are None, the global environment is</span>
<span class="sd">             used. If door name is None but macro name not, the given macro</span>
<span class="sd">             environment is used and so on...</span>
<span class="sd">           - If key is None it returns the complete environment, otherwise</span>
<span class="sd">             key must be a string containing the environment variable name.</span>

<span class="sd">        :raises: UnknownEnv</span>

<span class="sd">        :param key:</span>
<span class="sd">            environment variable name [default: None, meaning all environment]</span>
<span class="sd">        :type key: :obj:`str`</span>
<span class="sd">        :param door_name:</span>
<span class="sd">            local context for a given door [default: None, meaning no door</span>
<span class="sd">            context is used]</span>
<span class="sd">        :type door_name: :obj:`str`</span>
<span class="sd">        :param macro_name:</span>
<span class="sd">            local context for a given macro [default: None, meaning no macro</span>
<span class="sd">            context is used]</span>
<span class="sd">        :type macro_name: :obj:`str`</span>

<span class="sd">        :return: a :obj:`dict` containing the environment</span>
<span class="sd">        :rtype: :obj:`dict`&quot;&quot;&quot;</span>
        <span class="n">door_name</span> <span class="o">=</span> <span class="n">door_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDoorName</span><span class="p">()</span>
        <span class="n">macro_name</span> <span class="o">=</span> <span class="n">macro_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_server</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">macro_name</span><span class="o">=</span><span class="n">macro_name</span><span class="p">,</span>
                                         <span class="n">door_name</span><span class="o">=</span><span class="n">door_name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getGlobalEnv"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getGlobalEnv">[docs]</a>    <span class="k">def</span> <span class="nf">getGlobalEnv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns the global environment.</span>

<span class="sd">        :return: a :obj:`dict` containing the global environment</span>
<span class="sd">        :rtype: :obj:`dict`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_server</span><span class="o">.</span><span class="n">get_env</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getAllEnv"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getAllEnv">[docs]</a>    <span class="k">def</span> <span class="nf">getAllEnv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns the enviroment for the macro.</span>

<span class="sd">        :return: a :obj:`dict` containing the environment for the macro</span>
<span class="sd">        :rtype: :obj:`dict`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnv</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getAllDoorEnv"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getAllDoorEnv">[docs]</a>    <span class="k">def</span> <span class="nf">getAllDoorEnv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Returns the enviroment for the door where the macro</span>
<span class="sd">        is running.</span>

<span class="sd">        :return: a :obj:`dict` containing the environment</span>
<span class="sd">        :rtype: :obj:`dict`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_env</span><span class="p">()</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.setEnv"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setEnv">[docs]</a>    <span class="k">def</span> <span class="nf">setEnv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Sets the environment key to the new value and</span>
<span class="sd">        stores it persistently.</span>

<span class="sd">        :return: a :obj:`tuple` with the key and value objects stored</span>
<span class="sd">        :rtype: :obj:`tuple`\&lt;:obj:`str`\, object&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">set_env</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.unsetEnv"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.unsetEnv">[docs]</a>    <span class="k">def</span> <span class="nf">unsetEnv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Unsets the given environment variable.</span>

<span class="sd">        :param key: the environment variable name</span>
<span class="sd">        :type key: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_server</span><span class="o">.</span><span class="n">unset_env</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Reload API</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.reloadLibrary"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.reloadLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">reloadLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Reloads the given library(=module) names</span>

<span class="sd">        :raises: ImportError in case the reload process is not</span>
<span class="sd">                 successfull</span>

<span class="sd">        :param lib_name: library(=module) name</span>
<span class="sd">        :type lib_name: :obj:`str`</span>

<span class="sd">        :return:</span>
<span class="sd">            the reloaded python module object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">reload_lib</span><span class="p">(</span><span class="n">lib_name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.reloadMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.reloadMacro">[docs]</a>    <span class="k">def</span> <span class="nf">reloadMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Reloads the module corresponding to the given macro</span>
<span class="sd">        name</span>

<span class="sd">        :raises: MacroServerExceptionList in case the macro is unknown or the</span>
<span class="sd">                 reload process is not successfull</span>

<span class="sd">        :param macro_name: macro name</span>
<span class="sd">        :type macro_name: :obj:`str`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">reload_macro</span><span class="p">(</span><span class="n">macro_name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.reloadMacros"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.reloadMacros">[docs]</a>    <span class="k">def</span> <span class="nf">reloadMacros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Reloads the modules corresponding to the given macro</span>
<span class="sd">        names.</span>

<span class="sd">        :raises: MacroServerExceptionList in case the macro(s) are unknown or</span>
<span class="sd">                 the reload process is not successfull</span>

<span class="sd">        :param macro_names: a list of macro names</span>
<span class="sd">        :type macro_names: sequence&lt;:obj:`str`\&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reload_macros</span><span class="p">(</span><span class="n">macro_names</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.reloadMacroLibrary"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.reloadMacroLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">reloadMacroLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Reloads the given library(=module) names</span>

<span class="sd">        :raises: MacroServerExceptionList in case the reload process is not</span>
<span class="sd">                 successfull</span>

<span class="sd">        :param lib_name: library(=module) name</span>
<span class="sd">        :type lib_name: :obj:`str`</span>

<span class="sd">        :return:</span>
<span class="sd">            the :class:`~sardana.macroserver.metamacro.MacroLibrary` for the</span>
<span class="sd">            reloaded library</span>
<span class="sd">        :rtype: :class:`~sardana.macroserver.metamacro.MacroLibrary`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">reload_macro_lib</span><span class="p">(</span><span class="n">lib_name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.reloadMacroLibraries"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.reloadMacroLibraries">[docs]</a>    <span class="k">def</span> <span class="nf">reloadMacroLibraries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Macro API**. Reloads the given library(=module) names</span>

<span class="sd">        :raises: MacroServerExceptionList in case the reload process is not</span>
<span class="sd">                 successfull for at least one lib</span>

<span class="sd">        param lib_names: a list of library(=module) names</span>
<span class="sd">        :type lib_name: seq&lt;:obj:`str`\&gt;</span>

<span class="sd">        :return:</span>
<span class="sd">            a sequence of :class:`~sardana.macroserver.metamacro.MacroLibrary`</span>
<span class="sd">            objects for the reloaded libraries</span>
<span class="sd">        :rtype: seq&lt;:class:`~sardana.macroserver.metamacro.MacroLibrary`\&gt;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">reload_macro_libs</span><span class="p">(</span><span class="n">lib_names</span><span class="p">)</span></div>

    <span class="n">reloadMacroLib</span> <span class="o">=</span> <span class="n">reloadMacroLibrary</span>
    <span class="n">reloadMacroLibs</span> <span class="o">=</span> <span class="n">reloadMacroLibraries</span>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getViewOption"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getViewOption">[docs]</a>    <span class="k">def</span> <span class="nf">getViewOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getViewOption</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.getViewOptions"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getViewOptions">[docs]</a>    <span class="k">def</span> <span class="nf">getViewOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getViewOptions</span><span class="p">()</span>
        <span class="c1"># ensure that all view options known by sardana are present, in case</span>
        <span class="c1"># there were missing ones, update _ViewOptions dictionary after</span>
        <span class="c1"># initializing missing options with the default values</span>
        <span class="n">ivo</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">vo</span><span class="p">)</span>
        <span class="n">ViewOption</span><span class="o">.</span><span class="n">init_options</span><span class="p">(</span><span class="n">ivo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vo</span> <span class="o">!=</span> <span class="n">ivo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnv</span><span class="p">(</span><span class="s1">&#39;_ViewOptions&#39;</span><span class="p">,</span> <span class="n">vo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ivo</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.setViewOption"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setViewOption">[docs]</a>    <span class="k">def</span> <span class="nf">setViewOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">vo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getViewOptions</span><span class="p">()</span>
        <span class="n">vo</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnv</span><span class="p">(</span><span class="s1">&#39;_ViewOptions&#39;</span><span class="p">,</span> <span class="n">vo</span><span class="p">)</span></div>

    <span class="nd">@mAPI</span>
<div class="viewcode-block" id="Macro.resetViewOption"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.resetViewOption">[docs]</a>    <span class="k">def</span> <span class="nf">resetViewOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">vo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getViewOptions</span><span class="p">()</span>
        <span class="n">ViewOption</span><span class="o">.</span><span class="n">reset_option</span><span class="p">(</span><span class="n">vo</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnv</span><span class="p">(</span><span class="s1">&#39;_ViewOptions&#39;</span><span class="p">,</span> <span class="n">vo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="c1">#@}</span>

    <span class="c1"># @name Unofficial Macro API</span>
    <span class="c1">#    This list contains the set of methods that are &lt;b&gt;NOT&lt;/b&gt; part of the</span>
    <span class="c1">#  the macro developer knows what he is doing.</span>
    <span class="c1">#    Please check before is there is an official API that does the samething</span>
    <span class="c1">#  before executing any of these methods.</span>
    <span class="c1">#    If you see that your macro needs to execute any of these methods please</span>
    <span class="c1">#  consider informing the MacroServer developer so he may expose this in a</span>
    <span class="c1">#  safe way.</span>
    <span class="c1">#@{</span>
    <span class="k">def</span> <span class="nf">_getViewOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Gets _ViewOption dictionary. If it is not defined in the environment,</span>
<span class="sd">        sets it with the default values dictionary and returns it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnv</span><span class="p">(</span><span class="s1">&#39;_ViewOptions&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnknownEnv</span><span class="p">:</span>
            <span class="n">vo</span> <span class="o">=</span> <span class="n">ViewOption</span><span class="o">.</span><span class="n">init_options</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnv</span><span class="p">(</span><span class="s1">&#39;_ViewOptions&#39;</span><span class="p">,</span> <span class="n">vo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vo</span>

    <span class="k">def</span> <span class="nf">_getViewOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Gets _ViewOption of a given name. If it is not defined in</span>
<span class="sd">        the environment, sets it to a default value and returns it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">view_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getViewOptions</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">view_options</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">ViewOption</span><span class="o">.</span><span class="n">reset_option</span><span class="p">(</span><span class="n">view_options</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnv</span><span class="p">(</span><span class="s1">&#39;_ViewOptions&#39;</span><span class="p">,</span> <span class="n">view_options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">view_options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        If args is present, it is written to standard output without a trailing</span>
<span class="sd">        newline. The function then reads a line from input, converts it to a</span>
<span class="sd">        string (stripping a trailing newline), and returns that.</span>

<span class="sd">        Depending on which type of application you are running, some of the</span>
<span class="sd">        keywords may have no effect (ex.: spock ignores decimals when a number</span>
<span class="sd">        is asked).</span>

<span class="sd">        Recognized kwargs:</span>

<span class="sd">            - data_type : [default: Type.String] specific input type. Can also</span>
<span class="sd">              specify a sequence of strings with possible values (use</span>
<span class="sd">              allow_multiple=True to say multiple values can be selected)</span>
<span class="sd">            - key : [default: no default] variable/label to assign to this input</span>
<span class="sd">            - unit: [default: no default] units (useful for GUIs)</span>
<span class="sd">            - timeout : [default: None, meaning wait forever for input]</span>
<span class="sd">            - default_value : [default: None, meaning no default value]</span>
<span class="sd">              When given, it must be compatible with data_type</span>
<span class="sd">            - allow_multiple : [default: False] in case data_type is a</span>
<span class="sd">              sequence of values, allow multiple selection</span>
<span class="sd">            - minimum : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>
<span class="sd">            - maximum : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>
<span class="sd">            - step : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>
<span class="sd">            - decimals : [default: None] When given, must be compatible with data_type (useful for GUIs)</span>

<span class="sd">        Examples::</span>

<span class="sd">            device_name = self.input(&quot;Which device name (%s)?&quot;, &quot;tab separated&quot;)</span>

<span class="sd">            point_nb = self.input(&quot;How many points?&quot;, data_type=Type.Integer)</span>

<span class="sd">            calc_mode = self.input(&quot;Which algorithm?&quot;, data_type=[&quot;Average&quot;, &quot;Integral&quot;, &quot;Sum&quot;],</span>
<span class="sd">                                   default_value=&quot;Average&quot;, allow_multiple=False)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Non interactive macro &#39;</span><span class="si">%s</span><span class="s2">&#39; is asking for input &quot;</span>
                         <span class="s2">&quot;(please set this macro interactive to True)&quot;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_mode</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_multiple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allow_multiple&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;macro_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getID</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;macro_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;macro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDoorObj</span><span class="p">()</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;default_value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;key&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> running in non attended mode was asked &quot;</span>
                                 <span class="s2">&quot;for input without default value or key. &quot;</span>
                                 <span class="s2">&quot;Returning None&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnv</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;default_value&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;****Unofficial Macro API**.</span>
<span class="sd">        Record a log message in this object&#39;s output. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.log`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.output(&quot;this is a print for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_outputBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Sends a line tagged as a block to the output</span>

<span class="sd">        :param :obj:`str` line: line to be sent&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">elif</span> <span class="n">operator</span><span class="o">.</span><span class="n">isSequenceType</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Macro</span><span class="o">.</span><span class="n">BlockStart</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">Macro</span><span class="o">.</span><span class="n">BlockFinish</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record a log message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.log`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.debug(logging.INFO, &quot;this is a info log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param level: the record level</span>
<span class="sd">        :type level: :obj:`int`</span>
<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record a debug message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.debug`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.debug(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kw: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record an info message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.info`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.info(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@mAPI</span>
    <span class="k">def</span> <span class="nf">_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record a warning message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.warning`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.warning(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record an error message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.error`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.error(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record a critical message in this object&#39;s logger. Accepted *args* and</span>
<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.critical`.</span>
<span class="sd">        Example::</span>

<span class="sd">            self.critical(&quot;this is a log message for macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Record a trace message in this object&#39;s logger.</span>

<span class="sd">        :param msg: (str) the message to be recorded</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kw: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Logs the traceback with level TRACE on the macro logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Logs the stack with level TRACE on the macro logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Record a log message in the sardana report (if enabled) with default</span>
<span class="sd">        level **INFO**. The msg is the message format string, and the args are</span>
<span class="sd">        the arguments which are merged into msg using the string formatting</span>
<span class="sd">        operator. (Note that this means that you can use keywords in the</span>
<span class="sd">        format string, together with a single dictionary argument.)</span>

<span class="sd">        *kwargs* are the same as :meth:`logging.Logger.debug` plus an optional</span>
<span class="sd">        level kwargs which has default value **INFO**</span>

<span class="sd">        Example::</span>

<span class="sd">            self.report(&quot;this is an official report of macro %s&quot;, self.getName())</span>

<span class="sd">        :param msg: the message to be recorded</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        :param args: list of arguments</span>
<span class="sd">        :param kwargs: list of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flushOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.</span>
<span class="sd">        Flushes the output buffer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Logger</span><span class="o">.</span><span class="n">flushOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">executor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Alternative to :meth:`getExecutor` that</span>
<span class="sd">        does not throw StopException in case of a Stop. This should be</span>
<span class="sd">        called only internally&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">door</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Alternative to :meth:`getDoorObj` that</span>
<span class="sd">        does not throw StopException in case of a Stop. This should be</span>
<span class="sd">        called only internally&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">getDoor</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent_macro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Alternative to getParentMacro that does not</span>
<span class="sd">        throw StopException in case of a Stop. This should be called only</span>
<span class="sd">        internally by the *Executor*&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_macro</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Alternative to :meth:`getDescription` that</span>
<span class="sd">        does not throw StopException in case of a Stop. This should be</span>
<span class="sd">        called only internally by the *Executor*&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span>

<div class="viewcode-block" id="Macro.isAborted"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.isAborted">[docs]</a>    <span class="k">def</span> <span class="nf">isAborted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span></div>

<div class="viewcode-block" id="Macro.isStopped"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.isStopped">[docs]</a>    <span class="k">def</span> <span class="nf">isStopped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stopped</span></div>

<div class="viewcode-block" id="Macro.isPaused"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.isPaused">[docs]</a>    <span class="k">def</span> <span class="nf">isPaused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">isPaused</span><span class="p">()</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Macro.hasResult"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.hasResult">[docs]</a>    <span class="k">def</span> <span class="nf">hasResult</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Returns True if the macro should return</span>
<span class="sd">        a result or False otherwise</span>

<span class="sd">        :return: True if the macro should return a result or False otherwise</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">result_def</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Macro.getResult"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.getResult">[docs]</a>    <span class="k">def</span> <span class="nf">getResult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Returns the macro result object (if any)</span>

<span class="sd">        :return: the macro result object or None&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_pars</span></div>

<div class="viewcode-block" id="Macro.setResult"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setResult">[docs]</a>    <span class="k">def</span> <span class="nf">setResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Unofficial Macro API**. Sets the result of this macro</span>

<span class="sd">        :param result: (object) the result for this macro&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_pars</span> <span class="o">=</span> <span class="n">result</span></div>

    <span class="c1"># @name Internal methods</span>
    <span class="c1">#  This list contains the set of methods that are for INTERNAL macro usage.</span>
    <span class="c1">#  Macro developers should never call any of these methods</span>
    <span class="c1">#@{</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_buildWrongParamExp</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">found</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Macro.</span><span class="si">%s</span><span class="s2"> called with wrong parameter type in &#39;</span><span class="si">%s</span><span class="s2">&#39;. &quot;</span> \
            <span class="s2">&quot;Expected </span><span class="si">%s</span><span class="s2"> got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MacroWrongParameterType</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="nf">_getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Macro execution methods</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="k">def</span> <span class="nf">_getMacroStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**.</span>
<span class="sd">        Returns the current macro status. Macro status is a :obj:`dict` where</span>
<span class="sd">        keys are the strings:</span>

<span class="sd">            * *id* - macro ID (internal usage only)</span>
<span class="sd">            * *range* - the full progress range of a macro (usually a</span>
<span class="sd">              :obj:`tuple` of two numbers (0, 100))</span>
<span class="sd">            * *state* - the current macro state, a string which can have values</span>
<span class="sd">              *start*, *step*, *stop* and *abort*</span>
<span class="sd">            * *step* - the current step in macro. Should be a value inside the</span>
<span class="sd">              allowed macro range</span>

<span class="sd">        :return: the macro status</span>
<span class="sd">        :rtype: :obj:`dict`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_status</span>

    <span class="k">def</span> <span class="nf">_shouldRaiseStopException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isStopped</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingStop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_reserveObjs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Used to reserve a set of objects for this</span>
<span class="sd">        macro&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># isiterable</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="p">([],</span> <span class="p">())):</span>
                <span class="c1"># if not operator.isSequenceType(obj) or type(obj) in</span>
                <span class="c1"># types.StringTypes:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="p">,)</span>
            <span class="k">for</span> <span class="n">sub_obj</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_obj</span><span class="p">,</span> <span class="n">PoolElement</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addObj</span><span class="p">(</span><span class="n">sub_obj</span><span class="p">)</span>

<div class="viewcode-block" id="Macro.exec_"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.exec_">[docs]</a>    <span class="k">def</span> <span class="nf">exec_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Execute macro as an iterator&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macro_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span>
        <span class="n">macro_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMacroStatus</span><span class="p">()</span>

        <span class="c1"># make sure a 0.0 progress is sent</span>
        <span class="k">yield</span> <span class="n">macro_status</span>

        <span class="c1"># allow any macro to be paused at the beginning of its execution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pausePoint</span><span class="p">()</span>

        <span class="c1"># Run the macro or obtain a generator</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_in_pars</span><span class="p">)</span>

        <span class="c1"># If macro returns a generator then running the macro means go through</span>
        <span class="c1"># the generator steps, otherwise the macro has already ran</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">GeneratorType</span><span class="p">):</span>
            <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">operator</span><span class="o">.</span><span class="n">isMappingType</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">new_range</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">new_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_range</span>
                    <span class="n">new_step</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">new_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_step</span>
                <span class="k">elif</span> <span class="n">operator</span><span class="o">.</span><span class="n">isNumberType</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;step&#39;</span>
                <span class="k">yield</span> <span class="n">macro_status</span>
            <span class="c1"># make sure a &#39;stop&#39; progress is sent in case an exception occurs</span>
            <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stop&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_out_pars</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="n">macro_status</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;finish&#39;</span>
        <span class="k">yield</span> <span class="n">macro_status</span></div>

    <span class="k">def</span> <span class="nf">__prepareResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Decodes the given output in order to be able to</span>
<span class="sd">        send to the result channel</span>

<span class="sd">        :param out: output value</span>

<span class="sd">        :return: the output as a sequence of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">operator</span><span class="o">.</span><span class="n">isSequenceType</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">StringTypes</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">),)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_stopOnError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. The stop procedure. Calls the user &#39;on_abort&#39;</span>
<span class="sd">        protecting it against exceptions&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_stop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Error in on_stop(): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                         <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Details: &quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abortOnError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. The stop procedure. Calls the user &#39;on_abort&#39;</span>
<span class="sd">        protecting it against exceptions&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_abort</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Error in on_abort(): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                         <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Details: &quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pausePoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_pause</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>

<div class="viewcode-block" id="Macro.stop"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Activates the stop flag on this macro.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stopped</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Macro.abort"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Aborts the macro abruptly.&quot;&quot;&quot;</span>
        <span class="c1"># carefull: Inside this method never call a method that has the</span>
        <span class="c1"># mAPI decorator</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Aborting...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__resumeForAbort</span><span class="p">()</span>
            <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macro_thread</span>
            <span class="n">th_id</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">(</span><span class="n">th</span><span class="o">.</span><span class="n">ident</span><span class="p">)</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Sending AbortException to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">th</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">asyncexc</span><span class="p">(</span><span class="n">th_id</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">(</span><span class="n">AbortException</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># try again</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to abort after three tries!&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># if it returns a number greater than one, you&#39;re in trouble,</span>
                <span class="c1"># and you should call it again with exc=NULL to revert the</span>
                <span class="c1"># effect</span>
                <span class="n">asyncexc</span><span class="p">(</span><span class="n">th_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">Logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Failed to abort (unknown error code </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">ret</span><span class="p">)</span>
                <span class="k">break</span></div>

<div class="viewcode-block" id="Macro.setProcessingStop"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.setProcessingStop">[docs]</a>    <span class="k">def</span> <span class="nf">setProcessingStop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yesno</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Activates the processing stop flag on this</span>
<span class="sd">        macro&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processingStop</span> <span class="o">=</span> <span class="n">yesno</span></div>

<div class="viewcode-block" id="Macro.isProcessingStop"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.isProcessingStop">[docs]</a>    <span class="k">def</span> <span class="nf">isProcessingStop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Checks if this macro is processing stop&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processingStop</span></div>

<div class="viewcode-block" id="Macro.pause"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Pauses the macro execution. To be called by the</span>
<span class="sd">        Door running the macro to pause the current macro&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="n">cb</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span></div>

<div class="viewcode-block" id="Macro.resume"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.Macro.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;**Internal method**. Resumes the macro execution. To be called by</span>
<span class="sd">        the Door running the macro to resume the current macro&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">cb</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__resumeForAbort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called internally to resume the macro execution in case of an abort.</span>
<span class="sd">        The macro is resumed but instead of allowing the next user instruction</span>
<span class="sd">        to proceed it just waits for an ashyncronous AbortException to be</span>
<span class="sd">        thrown&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">resumeForAbort</span><span class="p">()</span>

    <span class="c1">#@}</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">door</span><span class="o">.</span><span class="n">get_macro</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnknownMacro</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> object has no attribute </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syncLog</span><span class="p">()</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">parent_macro</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
            <span class="n">eargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">eargs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execMacro</span><span class="p">(</span><span class="o">*</span><span class="n">eargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>


<div class="viewcode-block" id="iMacro"><a class="viewcode-back" href="../../../devel/api/api_macro.html#sardana.macroserver.macro.iMacro">[docs]</a><span class="k">class</span> <span class="nc">iMacro</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>

    <span class="n">interactive</span> <span class="o">=</span> <span class="kc">True</span></div>


<span class="k">class</span> <span class="nc">MacroFunc</span><span class="p">(</span><span class="n">Macro</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">function</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">function</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;as&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="o">.</span><span class="n">func_name</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">param_def</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_def</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">param_def</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">result_def</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_def</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">result_def</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">env</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">hints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">hints</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">interactive</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">interactive</span>
        <span class="n">Macro</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'2.7.3-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>